{"version":3,"file":"index.esm.js","sources":["../lib/utils.js","../lib/logger.js","../lib/schemas/config.js","../lib/validation.js","../lib/config.js","../lib/fetch.js","../lib/errors/ExportError.js","../lib/cache.js","../lib/highcharts.js","../lib/browser.js","../templates/svgExport/css.js","../templates/svgExport/svgExport.js","../lib/export.js","../lib/pool.js","../lib/sanitize.js","../lib/chart.js","../lib/timer.js","../lib/server/middlewares/error.js","../lib/server/middlewares/rateLimiting.js","../lib/server/middlewares/validation.js","../lib/server/routes/export.js","../lib/server/routes/health.js","../lib/server/routes/ui.js","../lib/server/routes/versionChange.js","../lib/server/server.js","../lib/resourceRelease.js","../lib/index.js"],"sourcesContent":["/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview The Highcharts Export Server utility module provides\r\n * a comprehensive set of helper functions and constants designed to streamline\r\n * and enhance various operations required for Highcharts export tasks.\r\n */\r\n\r\nimport { readFileSync } from 'fs';\r\nimport { isAbsolute, join } from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst MAX_BACKOFF_ATTEMPTS = 6;\r\n\r\n// The directory path\r\nexport const __dirname = fileURLToPath(new URL('../.', import.meta.url));\r\n\r\n/**\r\n * Clears and standardizes text by replacing multiple consecutive whitespace\r\n * characters with a single space and trimming any leading or trailing\r\n * whitespace.\r\n *\r\n * @function clearText\r\n *\r\n * @param {string} text - The input text to be cleared.\r\n * @param {RegExp} [rule=/\\s\\s+/g] - The regular expression rule to match\r\n * multiple consecutive whitespace characters. The default value\r\n * is the '/\\s\\s+/g' RegExp.\r\n * @param {string} [replacer=' '] - The string used to replace multiple\r\n * consecutive whitespace characters. The default value is the ' ' string.\r\n *\r\n * @returns {string} The cleared and standardized text.\r\n */\r\nexport function clearText(text, rule = /\\s\\s+/g, replacer = ' ') {\r\n  return text.replaceAll(rule, replacer).trim();\r\n}\r\n\r\n/**\r\n * Creates a deep copy of the given object or array.\r\n *\r\n * @function deepCopy\r\n *\r\n * @param {(Object|Array)} objArr - The object or array to be deeply copied.\r\n *\r\n * @returns {(Object|Array)} The deep copy of the provided object or array.\r\n */\r\nexport function deepCopy(objArr) {\r\n  // If the `objArr` is null or not of the `object` type, return it\r\n  if (objArr === null || typeof objArr !== 'object') {\r\n    return objArr;\r\n  }\r\n\r\n  // Prepare either a new array or a new object\r\n  const objArrCopy = Array.isArray(objArr) ? [] : {};\r\n\r\n  // Recursively copy each property\r\n  for (const key in objArr) {\r\n    if (Object.prototype.hasOwnProperty.call(objArr, key)) {\r\n      objArrCopy[key] = deepCopy(objArr[key]);\r\n    }\r\n  }\r\n\r\n  // Return the copied object\r\n  return objArrCopy;\r\n}\r\n\r\n/**\r\n * Implements an exponential backoff strategy for retrying a function until\r\n * a certain number of attempts are reached.\r\n *\r\n * @async\r\n * @function expBackoff\r\n *\r\n * @param {Function} fn - The function to be retried.\r\n * @param {number} [attempt=0] - The current attempt number. The default value\r\n * is `0`.\r\n * @param {...unknown} args - Arguments to be passed to the function.\r\n *\r\n * @returns {Promise<unknown>} A Promise that resolves to the result\r\n * of the function if successful.\r\n *\r\n * @throws {Error} Throws an `Error` if the maximum number of attempts\r\n * is reached.\r\n */\r\nexport async function expBackoff(fn, attempt = 0, ...args) {\r\n  try {\r\n    // Try to call the function\r\n    return await fn(...args);\r\n  } catch (error) {\r\n    // Calculate delay in ms\r\n    const delayInMs = 2 ** attempt * 1000;\r\n\r\n    // If the attempt exceeds the maximum attempts of repeat, throw an error\r\n    if (++attempt >= MAX_BACKOFF_ATTEMPTS) {\r\n      throw error;\r\n    }\r\n\r\n    // Wait given amount of time\r\n    await new Promise((response) => setTimeout(response, delayInMs));\r\n\r\n    /// TO DO: Correct\r\n    // // Information about the resource timeout\r\n    // log(\r\n    //   3,\r\n    //   `[utils] Waited ${delayInMs}ms until next call for the resource of ID: ${args[0]}.`\r\n    // );\r\n\r\n    // Try again\r\n    return expBackoff(fn, attempt, ...args);\r\n  }\r\n}\r\n\r\n/**\r\n * Adjusts the constructor name by transforming and normalizing it based\r\n * on common chart types.\r\n *\r\n * @function fixConstr\r\n *\r\n * @param {string} constr - The original constructor name to be fixed.\r\n *\r\n * @returns {string} The corrected constructor name, or 'chart' if the input\r\n * is not recognized.\r\n */\r\nexport function fixConstr(constr) {\r\n  try {\r\n    // Fix the constructor by lowering casing\r\n    const fixedConstr = `${constr.toLowerCase().replace('chart', '')}Chart`;\r\n\r\n    // Handle the case where the result is just 'Chart'\r\n    if (fixedConstr === 'Chart') {\r\n      fixedConstr.toLowerCase();\r\n    }\r\n\r\n    // Return the corrected constructor, otherwise default to 'chart'\r\n    return ['chart', 'stockChart', 'mapChart', 'ganttChart'].includes(\r\n      fixedConstr\r\n    )\r\n      ? fixedConstr\r\n      : 'chart';\r\n  } catch {\r\n    // Default to 'chart' in case of any error\r\n    return 'chart';\r\n  }\r\n}\r\n\r\n/**\r\n * Fixes the outfile based on provided type.\r\n *\r\n * @function fixOutfile\r\n *\r\n * @param {string} type - The original export type.\r\n * @param {string} outfile - The file path or name.\r\n *\r\n * @returns {string} The corrected outfile.\r\n */\r\nexport function fixOutfile(type, outfile) {\r\n  // Get the file name from the `outfile` option\r\n  const fileName = getAbsolutePath(outfile || 'chart')\r\n    .split('.')\r\n    .shift();\r\n\r\n  // Return a correct outfile\r\n  return `${fileName}.${type}`;\r\n}\r\n\r\n/**\r\n * Fixes the export type based on MIME types and file extensions.\r\n *\r\n * @function fixType\r\n *\r\n * @param {string} type - The original export type.\r\n * @param {string} [outfile=null] - The file path or name. The default value\r\n * is `null`.\r\n *\r\n * @returns {string} The corrected export type.\r\n */\r\nexport function fixType(type, outfile = null) {\r\n  // MIME types\r\n  const mimeTypes = {\r\n    'image/png': 'png',\r\n    'image/jpeg': 'jpeg',\r\n    'application/pdf': 'pdf',\r\n    'image/svg+xml': 'svg'\r\n  };\r\n\r\n  // Get formats\r\n  const formats = Object.values(mimeTypes);\r\n\r\n  // Check if type and outfile's extensions are the same\r\n  if (outfile) {\r\n    const outType = outfile.split('.').pop();\r\n\r\n    // Support the JPG type\r\n    if (outType === 'jpg') {\r\n      type = 'jpeg';\r\n    } else if (formats.includes(outType) && type !== outType) {\r\n      type = outType;\r\n    }\r\n  }\r\n\r\n  // Return a correct type\r\n  return mimeTypes[type] || formats.find((t) => t === type) || 'png';\r\n}\r\n\r\n/**\r\n * Checks if the given path is relative or absolute and returns the corrected,\r\n * absolute path.\r\n *\r\n * @function isAbsolutePath\r\n *\r\n * @param {string} path - The path to be checked on.\r\n *\r\n * @returns {string} The absolute path.\r\n */\r\nexport function getAbsolutePath(path) {\r\n  return isAbsolute(path) ? path : join(__dirname, path);\r\n}\r\n\r\n/**\r\n * Converts input data to a Base64 string based on the export type.\r\n *\r\n * @function getBase64\r\n *\r\n * @param {string} input - The input to be transformed to Base64 format.\r\n * @param {string} type - The original export type.\r\n *\r\n * @returns {string} The Base64 string representation of the input.\r\n */\r\nexport function getBase64(input, type) {\r\n  // For pdf and svg types the input must be transformed to Base64 from a buffer\r\n  if (type === 'pdf' || type == 'svg') {\r\n    return Buffer.from(input, 'utf8').toString('base64');\r\n  }\r\n\r\n  // For png and jpeg input is already a Base64 string\r\n  return input;\r\n}\r\n\r\n/**\r\n * Returns stringified date without the GMT text information.\r\n *\r\n * @function getNewDate\r\n */\r\nexport function getNewDate() {\r\n  // Get rid of the GMT text information\r\n  return new Date().toString().split('(')[0].trim();\r\n}\r\n\r\n/**\r\n * Returns the stored time value in milliseconds.\r\n *\r\n * @function getNewDateTime\r\n */\r\nexport function getNewDateTime() {\r\n  return new Date().getTime();\r\n}\r\n\r\n/**\r\n * Checks if the given item is an object.\r\n *\r\n * @function isObject\r\n *\r\n * @param {unknown} item - The item to be checked.\r\n *\r\n * @returns {boolean} True if the item is an object, false otherwise.\r\n */\r\nexport function isObject(item) {\r\n  return Object.prototype.toString.call(item) === '[object Object]';\r\n}\r\n\r\n/**\r\n * Checks if the given object is empty.\r\n *\r\n * @function isObjectEmpty\r\n *\r\n * @param {Object} item - The object to be checked.\r\n *\r\n * @returns {boolean} True if the object is empty, false otherwise.\r\n */\r\nexport function isObjectEmpty(item) {\r\n  return (\r\n    typeof item === 'object' &&\r\n    !Array.isArray(item) &&\r\n    item !== null &&\r\n    Object.keys(item).length === 0\r\n  );\r\n}\r\n\r\n/**\r\n * Checks if a private IP range URL is found in the given string.\r\n *\r\n * @function isPrivateRangeUrlFound\r\n *\r\n * @param {string} item - The string to be checked for a private IP range URL.\r\n *\r\n * @returns {boolean} True if a private IP range URL is found, false otherwise.\r\n */\r\nexport function isPrivateRangeUrlFound(item) {\r\n  const regexPatterns = [\r\n    /xlink:href=\"(?:http:\\/\\/|https:\\/\\/)?localhost\\b/,\r\n    /xlink:href=\"(?:http:\\/\\/|https:\\/\\/)?10\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b/,\r\n    /xlink:href=\"(?:http:\\/\\/|https:\\/\\/)?127\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b/,\r\n    /xlink:href=\"(?:http:\\/\\/|https:\\/\\/)?172\\.(1[6-9]|2[0-9]|3[0-1])\\.\\d{1,3}\\.\\d{1,3}\\b/,\r\n    /xlink:href=\"(?:http:\\/\\/|https:\\/\\/)?192\\.168\\.\\d{1,3}\\.\\d{1,3}\\b/\r\n  ];\r\n\r\n  return regexPatterns.some((pattern) => pattern.test(item));\r\n}\r\n\r\n/**\r\n * Utility to measure elapsed time using the Node.js `process.hrtime()` method.\r\n *\r\n * @function measureTime\r\n *\r\n * @returns {Function} A function to calculate the elapsed time in milliseconds.\r\n */\r\nexport function measureTime() {\r\n  const start = process.hrtime.bigint();\r\n  return () => Number(process.hrtime.bigint() - start) / 1000000;\r\n}\r\n\r\n/**\r\n * Rounds a number to the specified precision.\r\n *\r\n * @function roundNumber\r\n *\r\n * @param {number} value - The number to be rounded.\r\n * @param {number} precision - The number of decimal places to round to.\r\n *\r\n * @returns {number} The rounded number.\r\n */\r\nexport function roundNumber(value, precision = 1) {\r\n  const multiplier = Math.pow(10, precision || 0);\r\n  return Math.round(+value * multiplier) / multiplier;\r\n}\r\n\r\n/**\r\n * Converts a value to a boolean.\r\n *\r\n * @function toBoolean\r\n *\r\n * @param {unknown} item - The value to be converted to a boolean.\r\n *\r\n * @returns {boolean} The boolean representation of the input value.\r\n */\r\nexport function toBoolean(item) {\r\n  return ['false', 'undefined', 'null', 'NaN', '0', ''].includes(item)\r\n    ? false\r\n    : !!item;\r\n}\r\n\r\n/**\r\n * Wraps custom code to execute it safely.\r\n *\r\n * @function wrapAround\r\n *\r\n * @param {string} customCode - The custom code to be wrapped.\r\n * @param {boolean} allowFileResources - Flag to allow loading code from a file.\r\n * @param {boolean} [isCallback=false] - Flag that indicates the returned code\r\n * must be in a callback format.\r\n *\r\n * @returns {(string|null)} The wrapped custom code or null if wrapping fails.\r\n */\r\nexport function wrapAround(customCode, allowFileResources, isCallback = false) {\r\n  if (customCode && typeof customCode === 'string') {\r\n    customCode = customCode.trim();\r\n\r\n    if (customCode.endsWith('.js')) {\r\n      // Load a file if the file resources are allowed\r\n      return allowFileResources\r\n        ? wrapAround(\r\n            readFileSync(getAbsolutePath(customCode), 'utf8'),\r\n            allowFileResources,\r\n            isCallback\r\n          )\r\n        : null;\r\n    } else if (\r\n      !isCallback &&\r\n      (customCode.startsWith('function()') ||\r\n        customCode.startsWith('function ()') ||\r\n        customCode.startsWith('()=>') ||\r\n        customCode.startsWith('() =>'))\r\n    ) {\r\n      // Treat a function as a self-invoking expression\r\n      return `(${customCode})()`;\r\n    }\r\n\r\n    // Or return as a stringified code\r\n    return customCode.replace(/;$/, '');\r\n  }\r\n}\r\n\r\nexport default {\r\n  __dirname,\r\n  clearText,\r\n  deepCopy,\r\n  expBackoff,\r\n  fixConstr,\r\n  fixOutfile,\r\n  fixType,\r\n  getAbsolutePath,\r\n  getBase64,\r\n  getNewDate,\r\n  getNewDateTime,\r\n  isObject,\r\n  isObjectEmpty,\r\n  isPrivateRangeUrlFound,\r\n  measureTime,\r\n  roundNumber,\r\n  toBoolean,\r\n  wrapAround\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview A module for managing logging functionality with customizable\r\n * log levels, console and file logging options, and error handling support.\r\n * The module also ensures that file-based logs are stored in a structured\r\n * directory, creating the necessary paths automatically if they do not exist.\r\n */\r\n\r\nimport { appendFile, existsSync, mkdirSync } from 'fs';\r\nimport { join } from 'path';\r\n\r\nimport { getAbsolutePath, getNewDate } from './utils.js';\r\n\r\n// The available colors\r\nconst colors = ['red', 'yellow', 'blue', 'gray', 'green'];\r\n\r\n// The default logging config\r\nconst logging = {\r\n  // Flags for logging status\r\n  toConsole: true,\r\n  toFile: false,\r\n  pathCreated: false,\r\n  // Full path to the log file\r\n  pathToLog: '',\r\n  // Log levels\r\n  levelsDesc: [\r\n    {\r\n      title: 'error',\r\n      color: colors[0]\r\n    },\r\n    {\r\n      title: 'warning',\r\n      color: colors[1]\r\n    },\r\n    {\r\n      title: 'notice',\r\n      color: colors[2]\r\n    },\r\n    {\r\n      title: 'verbose',\r\n      color: colors[3]\r\n    },\r\n    {\r\n      title: 'benchmark',\r\n      color: colors[4]\r\n    }\r\n  ]\r\n};\r\n\r\n/**\r\n * Logs a message with a specified log level. Accepts a variable number\r\n * of arguments. The arguments after the `level` are passed to `console.log`\r\n * and/or used to construct and append messages to a log file.\r\n *\r\n * @function log\r\n *\r\n * @param {...unknown} args - An array of arguments where the first is the log\r\n * level and the remaining are strings used to build the log message.\r\n *\r\n * @returns {void} Exits the function execution if attempting to log at a level\r\n * higher than allowed.\r\n */\r\nexport function log(...args) {\r\n  const [newLevel, ...texts] = args;\r\n\r\n  // Current logging options\r\n  const { levelsDesc, level } = logging;\r\n\r\n  // Check if the log level is within a correct range or is it a benchmark log\r\n  if (\r\n    newLevel !== 5 &&\r\n    (newLevel === 0 || newLevel > level || level > levelsDesc.length)\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  // Create a message's prefix\r\n  const prefix = `${getNewDate()} [${levelsDesc[newLevel - 1].title}] -`;\r\n\r\n  // Log to file\r\n  if (logging.toFile) {\r\n    _logToFile(texts, prefix);\r\n  }\r\n\r\n  // Log to console\r\n  if (logging.toConsole) {\r\n    console.log.apply(\r\n      undefined,\r\n      [prefix.toString()[logging.levelsDesc[newLevel - 1].color]].concat(texts)\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Logs an error message along with its stack trace. Optionally, a custom message\r\n * can be provided.\r\n *\r\n * @function logWithStack\r\n *\r\n * @param {number} newLevel - The log level.\r\n * @param {Error} error - The error object containing the stack trace.\r\n * @param {string} customMessage - An optional custom message to be included\r\n * in the log alongside the error.\r\n *\r\n * @returns {void} Exits the function execution if attempting to log at a level\r\n * higher than allowed.\r\n */\r\nexport function logWithStack(newLevel, error, customMessage) {\r\n  // Get the main message\r\n  const mainMessage = customMessage || (error && error.message) || '';\r\n\r\n  // Current logging options\r\n  const { level, levelsDesc } = logging;\r\n\r\n  // Check if the log level is within a correct range\r\n  if (newLevel === 0 || newLevel > level || level > levelsDesc.length) {\r\n    return;\r\n  }\r\n\r\n  // Create a message's prefix\r\n  const prefix = `${getNewDate()} [${levelsDesc[newLevel - 1].title}] -`;\r\n\r\n  // Add the whole stack message\r\n  const stackMessage = error && error.stack;\r\n\r\n  // Combine custom message or error message with error stack message, if exists\r\n  const texts = [mainMessage];\r\n  if (stackMessage) {\r\n    texts.push('\\n', stackMessage);\r\n  }\r\n\r\n  // Log to file\r\n  if (logging.toFile) {\r\n    _logToFile(texts, prefix);\r\n  }\r\n\r\n  // Log to console\r\n  if (logging.toConsole) {\r\n    console.log.apply(\r\n      undefined,\r\n      [prefix.toString()[logging.levelsDesc[newLevel - 1].color]].concat([\r\n        texts.shift()[colors[newLevel - 1]],\r\n        ...texts\r\n      ])\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Logs an error message about Zod issues with the validation. Optionally,\r\n * a custom message can be provided.\r\n *\r\n * @function logZodIssues\r\n *\r\n * @param {number} newLevel - The log level.\r\n * @param {Error[]} issues - The array of Zod issues.\r\n * @param {string} customMessage - An optional custom message to be logged\r\n * along with the error.\r\n */\r\nexport function logZodIssues(newLevel, issues = [], customMessage) {\r\n  logWithStack(\r\n    newLevel,\r\n    null,\r\n    [\r\n      `${customMessage} - the following Zod issues occured:`,\r\n      ...issues.map((issue) => `- ${issue.message}`)\r\n    ].join('\\n')\r\n  );\r\n}\r\n\r\n/**\r\n * Initializes logging with the specified logging configuration.\r\n *\r\n * @function initLogging\r\n *\r\n * @param {Object} loggingOptions - The configuration object containing\r\n * `logging` options.\r\n */\r\nexport function initLogging(loggingOptions) {\r\n  // Get options from the `loggingOptions` object\r\n  const { level, dest, file, toConsole, toFile } = loggingOptions;\r\n\r\n  // Reset flags to the default values\r\n  logging.pathCreated = false;\r\n  logging.pathToLog = '';\r\n\r\n  // Set the logging level\r\n  setLogLevel(level);\r\n\r\n  // Set the console logging\r\n  enableConsoleLogging(toConsole);\r\n\r\n  // Set the file logging\r\n  enableFileLogging(dest, file, toFile);\r\n}\r\n\r\n/**\r\n * Sets the log level to the specified value. Log levels are (`0` = no logging,\r\n * `1` = error, `2` = warning, `3` = notice, `4` = verbose, or `5` = benchmark).\r\n *\r\n * @function setLogLevel\r\n *\r\n * @param {number} level - The log level to be set.\r\n */\r\nexport function setLogLevel(level) {\r\n  if (\r\n    Number.isInteger(level) &&\r\n    level >= 0 &&\r\n    level <= logging.levelsDesc.length\r\n  ) {\r\n    // Update the module logging's `level` option\r\n    logging.level = level;\r\n  }\r\n}\r\n\r\n/**\r\n * Enables console logging.\r\n *\r\n * @function enableConsoleLogging\r\n *\r\n * @param {boolean} toConsole - The flag for setting the logging to the console.\r\n */\r\nexport function enableConsoleLogging(toConsole) {\r\n  // Update the module logging's `toConsole` option\r\n  logging.toConsole = !!toConsole;\r\n}\r\n\r\n/**\r\n * Enables file logging with the specified destination and log file name.\r\n *\r\n * @function enableFileLogging\r\n *\r\n * @param {string} dest - The destination path where the log file should\r\n * be saved.\r\n * @param {string} file - The name of the log file.\r\n * @param {boolean} toFile - A flag indicating whether logging should\r\n * be directed to a file.\r\n */\r\nexport function enableFileLogging(dest, file, toFile) {\r\n  // Update the module logging's `toFile` option\r\n  logging.toFile = !!toFile;\r\n\r\n  // Set the `dest` and `file` options only if the file logging is enabled\r\n  if (logging.toFile) {\r\n    logging.dest = dest || '';\r\n    logging.file = file || '';\r\n  }\r\n}\r\n\r\n/**\r\n * Logs the provided texts to a file, if file logging is enabled. It creates\r\n * the necessary directory structure if not already created and appends\r\n * the content, including an optional prefix, to the specified log file.\r\n *\r\n * @function _logToFile\r\n *\r\n * @param {Array.<string>} texts - An array of texts to be logged.\r\n * @param {string} prefix - An optional prefix to be added to each log entry.\r\n */\r\nfunction _logToFile(texts, prefix) {\r\n  if (!logging.pathCreated) {\r\n    // Create if does not exist\r\n    !existsSync(getAbsolutePath(logging.dest)) &&\r\n      mkdirSync(getAbsolutePath(logging.dest));\r\n\r\n    // Create the full path\r\n    logging.pathToLog = getAbsolutePath(join(logging.dest, logging.file));\r\n\r\n    // We now assume the path is available, e.g. it's the responsibility\r\n    // of the user to create the path with the correct access rights.\r\n    logging.pathCreated = true;\r\n  }\r\n\r\n  // Add the content to a file\r\n  appendFile(\r\n    logging.pathToLog,\r\n    [prefix].concat(texts).join(' ') + '\\n',\r\n    (error) => {\r\n      if (error && logging.toFile && logging.pathCreated) {\r\n        logging.toFile = false;\r\n        logging.pathCreated = false;\r\n        logWithStack(2, error, `[logger] Unable to write to log file.`);\r\n      }\r\n    }\r\n  );\r\n}\r\n\r\nexport default {\r\n  log,\r\n  logWithStack,\r\n  logZodIssues,\r\n  initLogging,\r\n  setLogLevel,\r\n  enableConsoleLogging,\r\n  enableFileLogging\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Configuration management module for the Highcharts Export Server.\r\n * Provides default configurations that support environment variables, CLI\r\n * arguments, and interactive prompts for customization of options and features.\r\n * Additionally, it maps legacy options to modern structures, generates nested\r\n * argument mappings, and displays CLI usage information.\r\n */\r\n\r\n/**\r\n * The configuration object containing all available options, organized\r\n * by sections.\r\n *\r\n * This object includes:\r\n * - Default values for each option\r\n * - Data types for validation\r\n * - Names of corresponding environment variables\r\n * - Descriptions of each property\r\n * - Information used for prompts in interactive configuration\r\n * - [Optional] Corresponding CLI argument names for CLI usage\r\n * - [Optional] Legacy names from the previous PhantomJS-based server\r\n */\r\nexport const defaultConfig = {\r\n  puppeteer: {\r\n    args: {\r\n      value: [\r\n        '--allow-running-insecure-content',\r\n        '--ash-no-nudges',\r\n        '--autoplay-policy=user-gesture-required',\r\n        '--block-new-web-contents',\r\n        '--disable-accelerated-2d-canvas',\r\n        '--disable-background-networking',\r\n        '--disable-background-timer-throttling',\r\n        '--disable-backgrounding-occluded-windows',\r\n        '--disable-breakpad',\r\n        '--disable-checker-imaging',\r\n        '--disable-client-side-phishing-detection',\r\n        '--disable-component-extensions-with-background-pages',\r\n        '--disable-component-update',\r\n        '--disable-default-apps',\r\n        '--disable-dev-shm-usage',\r\n        '--disable-domain-reliability',\r\n        '--disable-extensions',\r\n        '--disable-features=CalculateNativeWinOcclusion,InterestFeedContentSuggestions,WebOTP',\r\n        '--disable-hang-monitor',\r\n        '--disable-ipc-flooding-protection',\r\n        '--disable-logging',\r\n        '--disable-notifications',\r\n        '--disable-offer-store-unmasked-wallet-cards',\r\n        '--disable-popup-blocking',\r\n        '--disable-print-preview',\r\n        '--disable-prompt-on-repost',\r\n        '--disable-renderer-backgrounding',\r\n        '--disable-search-engine-choice-screen',\r\n        '--disable-session-crashed-bubble',\r\n        '--disable-setuid-sandbox',\r\n        '--disable-site-isolation-trials',\r\n        '--disable-speech-api',\r\n        '--disable-sync',\r\n        '--enable-unsafe-webgpu',\r\n        '--hide-crash-restore-bubble',\r\n        '--hide-scrollbars',\r\n        '--metrics-recording-only',\r\n        '--mute-audio',\r\n        '--no-default-browser-check',\r\n        '--no-first-run',\r\n        '--no-pings',\r\n        '--no-sandbox',\r\n        '--no-startup-window',\r\n        '--no-zygote',\r\n        '--password-store=basic',\r\n        '--process-per-tab',\r\n        '--use-mock-keychain'\r\n      ],\r\n      types: ['string[]'],\r\n      envLink: 'PUPPETEER_ARGS',\r\n      cliName: 'puppeteerArgs',\r\n      description: 'Array of Puppeteer arguments',\r\n      promptOptions: {\r\n        type: 'list',\r\n        separator: ';'\r\n      }\r\n    }\r\n  },\r\n  highcharts: {\r\n    version: {\r\n      value: 'latest',\r\n      types: ['string'],\r\n      envLink: 'HIGHCHARTS_VERSION',\r\n      description: 'Highcharts version',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    cdnUrl: {\r\n      value: 'https://code.highcharts.com',\r\n      types: ['string'],\r\n      envLink: 'HIGHCHARTS_CDN_URL',\r\n      description: 'CDN URL for Highcharts scripts',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    forceFetch: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'HIGHCHARTS_FORCE_FETCH',\r\n      description: 'Flag to refetch scripts after each server rerun',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    cachePath: {\r\n      value: '.cache',\r\n      types: ['string'],\r\n      envLink: 'HIGHCHARTS_CACHE_PATH',\r\n      description: 'Directory path for cached Highcharts scripts',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    coreScripts: {\r\n      value: ['highcharts', 'highcharts-more', 'highcharts-3d'],\r\n      types: ['string[]'],\r\n      envLink: 'HIGHCHARTS_CORE_SCRIPTS',\r\n      description: 'Highcharts core scripts to fetch',\r\n      promptOptions: {\r\n        type: 'multiselect',\r\n        instructions: 'Space: Select specific, A: Select all, Enter: Confirm'\r\n      }\r\n    },\r\n    moduleScripts: {\r\n      value: [\r\n        'stock',\r\n        'map',\r\n        'gantt',\r\n        'exporting',\r\n        'parallel-coordinates',\r\n        'accessibility',\r\n        // 'annotations-advanced',\r\n        'boost-canvas',\r\n        'boost',\r\n        'data',\r\n        'data-tools',\r\n        'draggable-points',\r\n        'static-scale',\r\n        'broken-axis',\r\n        'heatmap',\r\n        'tilemap',\r\n        'tiledwebmap',\r\n        'timeline',\r\n        'treemap',\r\n        'treegraph',\r\n        'item-series',\r\n        'drilldown',\r\n        'histogram-bellcurve',\r\n        'bullet',\r\n        'funnel',\r\n        'funnel3d',\r\n        'geoheatmap',\r\n        'pyramid3d',\r\n        'networkgraph',\r\n        'overlapping-datalabels',\r\n        'pareto',\r\n        'pattern-fill',\r\n        'pictorial',\r\n        'price-indicator',\r\n        'sankey',\r\n        'arc-diagram',\r\n        'dependency-wheel',\r\n        'series-label',\r\n        'series-on-point',\r\n        'solid-gauge',\r\n        'sonification',\r\n        // 'stock-tools',\r\n        'streamgraph',\r\n        'sunburst',\r\n        'variable-pie',\r\n        'variwide',\r\n        'vector',\r\n        'venn',\r\n        'windbarb',\r\n        'wordcloud',\r\n        'xrange',\r\n        'no-data-to-display',\r\n        'drag-panes',\r\n        'debugger',\r\n        'dumbbell',\r\n        'lollipop',\r\n        'cylinder',\r\n        'organization',\r\n        'dotplot',\r\n        'marker-clusters',\r\n        'hollowcandlestick',\r\n        'heikinashi',\r\n        'flowmap',\r\n        'export-data',\r\n        'navigator',\r\n        'textpath'\r\n      ],\r\n      types: ['string[]'],\r\n      envLink: 'HIGHCHARTS_MODULE_SCRIPTS',\r\n      description: 'Highcharts module scripts to fetch',\r\n      promptOptions: {\r\n        type: 'multiselect',\r\n        instructions: 'Space: Select specific, A: Select all, Enter: Confirm'\r\n      }\r\n    },\r\n    indicatorScripts: {\r\n      value: ['indicators-all'],\r\n      types: ['string[]'],\r\n      envLink: 'HIGHCHARTS_INDICATOR_SCRIPTS',\r\n      description: 'Highcharts indicator scripts to fetch',\r\n      promptOptions: {\r\n        type: 'multiselect',\r\n        instructions: 'Space: Select specific, A: Select all, Enter: Confirm'\r\n      }\r\n    },\r\n    customScripts: {\r\n      value: [\r\n        'https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js',\r\n        'https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.45/moment-timezone-with-data.min.js'\r\n      ],\r\n      types: ['string[]'],\r\n      envLink: 'HIGHCHARTS_CUSTOM_SCRIPTS',\r\n      description: 'Additional custom scripts or dependencies to fetch',\r\n      promptOptions: {\r\n        type: 'list',\r\n        separator: ';'\r\n      }\r\n    }\r\n  },\r\n  export: {\r\n    infile: {\r\n      value: null,\r\n      types: ['string', 'null'],\r\n      envLink: 'EXPORT_INFILE',\r\n      description:\r\n        'Input filename with type, formatted correctly as JSON or SVG',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    instr: {\r\n      value: null,\r\n      types: ['Object', 'string', 'null'],\r\n      envLink: 'EXPORT_INSTR',\r\n      description:\r\n        'Overrides the `infile` with JSON, stringified JSON, or SVG input',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    options: {\r\n      value: null,\r\n      types: ['Object', 'string', 'null'],\r\n      envLink: 'EXPORT_OPTIONS',\r\n      description: 'Alias for the `instr` option',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    svg: {\r\n      value: null,\r\n      types: ['string', 'null'],\r\n      envLink: 'EXPORT_SVG',\r\n      description: 'SVG string representation of the chart to render',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    batch: {\r\n      value: null,\r\n      types: ['string', 'null'],\r\n      envLink: 'EXPORT_BATCH',\r\n      description:\r\n        'Batch job string with input/output pairs: \"in=out;in=out;...\"',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    outfile: {\r\n      value: null,\r\n      types: ['string', 'null'],\r\n      envLink: 'EXPORT_OUTFILE',\r\n      description:\r\n        'Output filename with type. Can be jpeg, png, pdf, or svg and ignores `type` option',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    type: {\r\n      value: 'png',\r\n      types: ['string'],\r\n      envLink: 'EXPORT_TYPE',\r\n      description: 'File export format. Can be jpeg, png, pdf, or svg',\r\n      promptOptions: {\r\n        type: 'select',\r\n        hint: 'Default: png',\r\n        choices: ['png', 'jpeg', 'pdf', 'svg']\r\n      }\r\n    },\r\n    constr: {\r\n      value: 'chart',\r\n      types: ['string'],\r\n      envLink: 'EXPORT_CONSTR',\r\n      description:\r\n        'Chart constructor. Can be chart, stockChart, mapChart, or ganttChart',\r\n      promptOptions: {\r\n        type: 'select',\r\n        hint: 'Default: chart',\r\n        choices: ['chart', 'stockChart', 'mapChart', 'ganttChart']\r\n      }\r\n    },\r\n    b64: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'EXPORT_B64',\r\n      description:\r\n        'Whether or not to the chart should be received in Base64 format instead of binary',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    noDownload: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'EXPORT_NO_DOWNLOAD',\r\n      description:\r\n        'Whether or not to include or exclude attachment headers in the response',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    height: {\r\n      value: null,\r\n      types: ['number', 'null'],\r\n      envLink: 'EXPORT_HEIGHT',\r\n      description: 'Height of the exported chart, overrides chart settings',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    width: {\r\n      value: null,\r\n      types: ['number', 'null'],\r\n      envLink: 'EXPORT_WIDTH',\r\n      description: 'Width of the exported chart, overrides chart settings',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    scale: {\r\n      value: null,\r\n      types: ['number', 'null'],\r\n      envLink: 'EXPORT_SCALE',\r\n      description:\r\n        'Scale of the exported chart, overrides chart settings. Ranges from 0.1 to 5.0',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    defaultHeight: {\r\n      value: 400,\r\n      types: ['number'],\r\n      envLink: 'EXPORT_DEFAULT_HEIGHT',\r\n      description: 'Default height of the exported chart if not set',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    defaultWidth: {\r\n      value: 600,\r\n      types: ['number'],\r\n      envLink: 'EXPORT_DEFAULT_WIDTH',\r\n      description: 'Default width of the exported chart if not set',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    defaultScale: {\r\n      value: 1,\r\n      types: ['number'],\r\n      envLink: 'EXPORT_DEFAULT_SCALE',\r\n      description:\r\n        'Default scale of the exported chart if not set. Ranges from 0.1 to 5.0',\r\n      promptOptions: {\r\n        type: 'number',\r\n        min: 0.1,\r\n        max: 5\r\n      }\r\n    },\r\n    globalOptions: {\r\n      value: null,\r\n      types: ['Object', 'string', 'null'],\r\n      envLink: 'EXPORT_GLOBAL_OPTIONS',\r\n      description:\r\n        'JSON, stringified JSON or filename with global options for Highcharts.setOptions',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    themeOptions: {\r\n      value: null,\r\n      types: ['Object', 'string', 'null'],\r\n      envLink: 'EXPORT_THEME_OPTIONS',\r\n      description:\r\n        'JSON, stringified JSON or filename with theme options for Highcharts.setOptions',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    rasterizationTimeout: {\r\n      value: 1500,\r\n      types: ['number'],\r\n      envLink: 'EXPORT_RASTERIZATION_TIMEOUT',\r\n      description: 'Milliseconds to wait for webpage rendering',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    }\r\n  },\r\n  customLogic: {\r\n    allowCodeExecution: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'CUSTOM_LOGIC_ALLOW_CODE_EXECUTION',\r\n      description:\r\n        'Allows or disallows execution of arbitrary code during exporting',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    allowFileResources: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'CUSTOM_LOGIC_ALLOW_FILE_RESOURCES',\r\n      description:\r\n        'Allows or disallows injection of filesystem resources (disabled in server mode)',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    customCode: {\r\n      value: null,\r\n      types: ['string', 'null'],\r\n      envLink: 'CUSTOM_LOGIC_CUSTOM_CODE',\r\n      description:\r\n        'Custom code to execute before chart initialization. Can be a function, code wrapped in a function, or a .js filename',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    callback: {\r\n      value: null,\r\n      types: ['string', 'null'],\r\n      envLink: 'CUSTOM_LOGIC_CALLBACK',\r\n      description:\r\n        'JavaScript code to run during construction. Can be a function or a .js filename',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    resources: {\r\n      value: null,\r\n      types: ['Object', 'string', 'null'],\r\n      envLink: 'CUSTOM_LOGIC_RESOURCES',\r\n      description:\r\n        'Additional resources as JSON, stringified JSON, or filename, containing files, js, and css sections',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    loadConfig: {\r\n      value: null,\r\n      types: ['string', 'null'],\r\n      envLink: 'CUSTOM_LOGIC_LOAD_CONFIG',\r\n      legacyName: 'fromFile',\r\n      description: 'File with a pre-defined configuration to use',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    createConfig: {\r\n      value: null,\r\n      types: ['string', 'null'],\r\n      envLink: 'CUSTOM_LOGIC_CREATE_CONFIG',\r\n      description:\r\n        'Prompt-based option setting, saved to a provided config file',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    }\r\n  },\r\n  server: {\r\n    enable: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'SERVER_ENABLE',\r\n      cliName: 'enableServer',\r\n      description: 'Starts the server when true',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    host: {\r\n      value: '0.0.0.0',\r\n      types: ['string'],\r\n      envLink: 'SERVER_HOST',\r\n      description: 'Hostname of the server',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    port: {\r\n      value: 7801,\r\n      types: ['number'],\r\n      envLink: 'SERVER_PORT',\r\n      description: 'Port number for the server',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    uploadLimit: {\r\n      value: 3,\r\n      types: ['number'],\r\n      envLink: 'SERVER_UPLOAD_LIMIT',\r\n      description: 'Maximum request body size in MB',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    benchmarking: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'SERVER_BENCHMARKING',\r\n      cliName: 'serverBenchmarking',\r\n      description:\r\n        'Displays or not action durations in milliseconds during server requests',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    proxy: {\r\n      host: {\r\n        value: null,\r\n        types: ['string', 'null'],\r\n        envLink: 'SERVER_PROXY_HOST',\r\n        cliName: 'proxyHost',\r\n        description: 'Host of the proxy server, if applicable',\r\n        promptOptions: {\r\n          type: 'text'\r\n        }\r\n      },\r\n      port: {\r\n        value: null,\r\n        types: ['number', 'null'],\r\n        envLink: 'SERVER_PROXY_PORT',\r\n        cliName: 'proxyPort',\r\n        description: 'Port of the proxy server, if applicable',\r\n        promptOptions: {\r\n          type: 'number'\r\n        }\r\n      },\r\n      timeout: {\r\n        value: 5000,\r\n        types: ['number'],\r\n        envLink: 'SERVER_PROXY_TIMEOUT',\r\n        cliName: 'proxyTimeout',\r\n        description:\r\n          'Timeout in milliseconds for the proxy server, if applicable',\r\n        promptOptions: {\r\n          type: 'number'\r\n        }\r\n      }\r\n    },\r\n    rateLimiting: {\r\n      enable: {\r\n        value: false,\r\n        types: ['boolean'],\r\n        envLink: 'SERVER_RATE_LIMITING_ENABLE',\r\n        cliName: 'enableRateLimiting',\r\n        description: 'Enables or disables rate limiting on the server',\r\n        promptOptions: {\r\n          type: 'toggle'\r\n        }\r\n      },\r\n      maxRequests: {\r\n        value: 10,\r\n        types: ['number'],\r\n        envLink: 'SERVER_RATE_LIMITING_MAX_REQUESTS',\r\n        legacyName: 'rateLimit',\r\n        description: 'Maximum number of requests allowed per minute',\r\n        promptOptions: {\r\n          type: 'number'\r\n        }\r\n      },\r\n      window: {\r\n        value: 1,\r\n        types: ['number'],\r\n        envLink: 'SERVER_RATE_LIMITING_WINDOW',\r\n        description: 'Time window in minutes for rate limiting',\r\n        promptOptions: {\r\n          type: 'number'\r\n        }\r\n      },\r\n      delay: {\r\n        value: 0,\r\n        types: ['number'],\r\n        envLink: 'SERVER_RATE_LIMITING_DELAY',\r\n        description:\r\n          'Delay duration between successive requests before reaching the limit',\r\n        promptOptions: {\r\n          type: 'number'\r\n        }\r\n      },\r\n      trustProxy: {\r\n        value: false,\r\n        types: ['boolean'],\r\n        envLink: 'SERVER_RATE_LIMITING_TRUST_PROXY',\r\n        description: 'Set to true if the server is behind a load balancer',\r\n        promptOptions: {\r\n          type: 'toggle'\r\n        }\r\n      },\r\n      skipKey: {\r\n        value: null,\r\n        types: ['string', 'null'],\r\n        envLink: 'SERVER_RATE_LIMITING_SKIP_KEY',\r\n        description: 'Key to bypass the rate limiter, used with `skipToken`',\r\n        promptOptions: {\r\n          type: 'text'\r\n        }\r\n      },\r\n      skipToken: {\r\n        value: null,\r\n        types: ['string', 'null'],\r\n        envLink: 'SERVER_RATE_LIMITING_SKIP_TOKEN',\r\n        description: 'Token to bypass the rate limiter, used with `skipKey`',\r\n        promptOptions: {\r\n          type: 'text'\r\n        }\r\n      }\r\n    },\r\n    ssl: {\r\n      enable: {\r\n        value: false,\r\n        types: ['boolean'],\r\n        envLink: 'SERVER_SSL_ENABLE',\r\n        cliName: 'enableSsl',\r\n        description: 'Enables or disables SSL protocol',\r\n        promptOptions: {\r\n          type: 'toggle'\r\n        }\r\n      },\r\n      force: {\r\n        value: false,\r\n        types: ['boolean'],\r\n        envLink: 'SERVER_SSL_FORCE',\r\n        cliName: 'sslForce',\r\n        legacyName: 'sslOnly',\r\n        description: 'Forces the server to use HTTPS only when true',\r\n        promptOptions: {\r\n          type: 'toggle'\r\n        }\r\n      },\r\n      port: {\r\n        value: 443,\r\n        types: ['number'],\r\n        envLink: 'SERVER_SSL_PORT',\r\n        cliName: 'sslPort',\r\n        description: 'Port for the SSL server',\r\n        promptOptions: {\r\n          type: 'number'\r\n        }\r\n      },\r\n      certPath: {\r\n        value: null,\r\n        types: ['string', 'null'],\r\n        envLink: 'SERVER_SSL_CERT_PATH',\r\n        cliName: 'sslCertPath',\r\n        legacyName: 'sslPath',\r\n        description: 'Path to the SSL certificate/key file',\r\n        promptOptions: {\r\n          type: 'text'\r\n        }\r\n      }\r\n    }\r\n  },\r\n  pool: {\r\n    minWorkers: {\r\n      value: 4,\r\n      types: ['number'],\r\n      envLink: 'POOL_MIN_WORKERS',\r\n      description: 'Minimum and initial number of pool workers to spawn',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    maxWorkers: {\r\n      value: 8,\r\n      types: ['number'],\r\n      envLink: 'POOL_MAX_WORKERS',\r\n      legacyName: 'workers',\r\n      description: 'Maximum number of pool workers to spawn',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    workLimit: {\r\n      value: 40,\r\n      types: ['number'],\r\n      envLink: 'POOL_WORK_LIMIT',\r\n      description: 'Number of tasks a worker can handle before restarting',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    acquireTimeout: {\r\n      value: 5000,\r\n      types: ['number'],\r\n      envLink: 'POOL_ACQUIRE_TIMEOUT',\r\n      description: 'Timeout in milliseconds for acquiring a resource',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    createTimeout: {\r\n      value: 5000,\r\n      types: ['number'],\r\n      envLink: 'POOL_CREATE_TIMEOUT',\r\n      description: 'Timeout in milliseconds for creating a resource',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    destroyTimeout: {\r\n      value: 5000,\r\n      types: ['number'],\r\n      envLink: 'POOL_DESTROY_TIMEOUT',\r\n      description: 'Timeout in milliseconds for destroying a resource',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    idleTimeout: {\r\n      value: 30000,\r\n      types: ['number'],\r\n      envLink: 'POOL_IDLE_TIMEOUT',\r\n      description: 'Timeout in milliseconds for destroying idle resources',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    createRetryInterval: {\r\n      value: 200,\r\n      types: ['number'],\r\n      envLink: 'POOL_CREATE_RETRY_INTERVAL',\r\n      description:\r\n        'Interval in milliseconds before retrying resource creation on failure',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    reaperInterval: {\r\n      value: 1000,\r\n      types: ['number'],\r\n      envLink: 'POOL_REAPER_INTERVAL',\r\n      description:\r\n        'Interval in milliseconds to check and destroy idle resources',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    benchmarking: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'POOL_BENCHMARKING',\r\n      cliName: 'poolBenchmarking',\r\n      description: 'Shows statistics for the pool of resources',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    }\r\n  },\r\n  logging: {\r\n    level: {\r\n      value: 4,\r\n      types: ['number'],\r\n      envLink: 'LOGGING_LEVEL',\r\n      cliName: 'logLevel',\r\n      description: 'Logging verbosity level',\r\n      promptOptions: {\r\n        type: 'number',\r\n        round: 0,\r\n        min: 0,\r\n        max: 5\r\n      }\r\n    },\r\n    file: {\r\n      value: 'highcharts-export-server.log',\r\n      types: ['string'],\r\n      envLink: 'LOGGING_FILE',\r\n      cliName: 'logFile',\r\n      description:\r\n        'Log file name. Requires `logToFile` and `logDest` to be set',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    dest: {\r\n      value: 'log',\r\n      types: ['string'],\r\n      envLink: 'LOGGING_DEST',\r\n      cliName: 'logDest',\r\n      description: 'Path to store log files. Requires `logToFile` to be set',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    toConsole: {\r\n      value: true,\r\n      types: ['boolean'],\r\n      envLink: 'LOGGING_TO_CONSOLE',\r\n      cliName: 'logToConsole',\r\n      description: 'Enables or disables console logging',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    toFile: {\r\n      value: true,\r\n      types: ['boolean'],\r\n      envLink: 'LOGGING_TO_FILE',\r\n      cliName: 'logToFile',\r\n      description: 'Enables or disables logging to a file',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    }\r\n  },\r\n  ui: {\r\n    enable: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'UI_ENABLE',\r\n      cliName: 'enableUi',\r\n      description: 'Enables or disables the UI for the export server',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    route: {\r\n      value: '/',\r\n      types: ['string'],\r\n      envLink: 'UI_ROUTE',\r\n      cliName: 'uiRoute',\r\n      description: 'The endpoint route for the UI',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    }\r\n  },\r\n  other: {\r\n    nodeEnv: {\r\n      value: 'production',\r\n      types: ['string'],\r\n      envLink: 'OTHER_NODE_ENV',\r\n      description: 'The Node.js environment type',\r\n      promptOptions: {\r\n        type: 'text'\r\n      }\r\n    },\r\n    listenToProcessExits: {\r\n      value: true,\r\n      types: ['boolean'],\r\n      envLink: 'OTHER_LISTEN_TO_PROCESS_EXITS',\r\n      description: 'Whether or not to attach process.exit handlers',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    noLogo: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'OTHER_NO_LOGO',\r\n      description: 'Display or skip printing the logo on startup',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    hardResetPage: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'OTHER_HARD_RESET_PAGE',\r\n      description: 'Whether or not to reset the page content entirely',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    browserShellMode: {\r\n      value: true,\r\n      types: ['boolean'],\r\n      envLink: 'OTHER_BROWSER_SHELL_MODE',\r\n      description: 'Whether or not to set the browser to run in shell mode',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    }\r\n  },\r\n  debug: {\r\n    enable: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'DEBUG_ENABLE',\r\n      cliName: 'enableDebug',\r\n      description: 'Enables or disables debug mode for the underlying browser',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    headless: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'DEBUG_HEADLESS',\r\n      description:\r\n        'Whether or not to set the browser to run in headless mode during debugging',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    devtools: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'DEBUG_DEVTOOLS',\r\n      description: 'Enables or disables DevTools in headful mode',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    listenToConsole: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'DEBUG_LISTEN_TO_CONSOLE',\r\n      description:\r\n        'Enables or disables listening to console messages from the browser',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    dumpio: {\r\n      value: false,\r\n      types: ['boolean'],\r\n      envLink: 'DEBUG_DUMPIO',\r\n      description:\r\n        'Redirects or not browser stdout and stderr to process.stdout and process.stderr',\r\n      promptOptions: {\r\n        type: 'toggle'\r\n      }\r\n    },\r\n    slowMo: {\r\n      value: 0,\r\n      types: ['number'],\r\n      envLink: 'DEBUG_SLOW_MO',\r\n      description: 'Delays Puppeteer operations by the specified milliseconds',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    },\r\n    debuggingPort: {\r\n      value: 9222,\r\n      types: ['number'],\r\n      envLink: 'DEBUG_DEBUGGING_PORT',\r\n      description: 'Port used for debugging',\r\n      promptOptions: {\r\n        type: 'number'\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n// Properties nesting level of all options\r\nexport const nestedProps = _createNestedProps(defaultConfig);\r\n\r\n// Properties names that should not be recursively merged\r\nexport const absoluteProps = _createAbsoluteProps(defaultConfig);\r\n\r\n/**\r\n * Recursively generates a mapping of nested argument chains from a nested\r\n * config object. This function traverses a nested object and creates a mapping\r\n * where each key is an argument name (either from `cliName`, `legacyName`,\r\n * or the original key) and each value is a string representing the chain\r\n * of nested properties leading to that argument.\r\n *\r\n * @function _createNestedProps\r\n *\r\n * @param {Object} config - The configuration object.\r\n * @param {Object} [nestedProps={}] - The accumulator object for storing\r\n * the resulting arguments chains.  The default value is an empty object.\r\n * @param {string} [propChain=''] - The current chain of nested properties,\r\n * used internally during recursion.  The default value is an empty string.\r\n *\r\n * @returns {Object} An object mapping argument names to their corresponding\r\n * nested property chains.\r\n */\r\nfunction _createNestedProps(config, nestedProps = {}, propChain = '') {\r\n  Object.keys(config).forEach((key) => {\r\n    // Get the specific section\r\n    const entry = config[key];\r\n\r\n    // Check if there is still more depth to traverse\r\n    if (typeof entry.value === 'undefined') {\r\n      // Recurse into deeper levels of nested arguments\r\n      _createNestedProps(entry, nestedProps, `${propChain}.${key}`);\r\n    } else {\r\n      // Create the chain of nested arguments\r\n      nestedProps[entry.cliName || key] = `${propChain}.${key}`.substring(1);\r\n\r\n      // Support for the legacy, PhantomJS properties names\r\n      if (entry.legacyName !== undefined) {\r\n        nestedProps[entry.legacyName] = `${propChain}.${key}`.substring(1);\r\n      }\r\n    }\r\n  });\r\n\r\n  // Return the object with nested argument chains\r\n  return nestedProps;\r\n}\r\n\r\n/**\r\n * Recursively gathers the names of properties from a configuration object that\r\n * can be treated as absolute properties. These properties have values that\r\n * are objects and do not contain further nested depth when merging an object\r\n * containing these options.\r\n *\r\n * @function _createAbsoluteProps\r\n *\r\n * @param {Object} config - The configuration object.\r\n * @param {Array.<string>} [absoluteProps=[]] - An array to collect the names\r\n * of absolute properties. The default value is an empty array.\r\n *\r\n * @returns {Array.<string>} An array containing the names of absolute\r\n * properties.\r\n */\r\nfunction _createAbsoluteProps(config, absoluteProps = []) {\r\n  Object.keys(config).forEach((key) => {\r\n    // Get the specific section\r\n    const entry = config[key];\r\n\r\n    // Check if there is still more depth to traverse\r\n    if (typeof entry.types === 'undefined') {\r\n      // Recurse into deeper levels\r\n      _createAbsoluteProps(entry, absoluteProps);\r\n    } else {\r\n      // If the option can be an object, save its type in the array\r\n      if (entry.types.includes('Object')) {\r\n        absoluteProps.push(key);\r\n      }\r\n    }\r\n  });\r\n\r\n  // Return the array with the names of absolute properties\r\n  return absoluteProps;\r\n}\r\n\r\nexport default {\r\n  defaultConfig,\r\n  nestedProps,\r\n  absoluteProps\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview This file handles parsing and validating options from multiple\r\n * sources (the config file, custom JSON, environment variables, CLI arguments,\r\n * and request payload) using the 'zod' library.\r\n *\r\n * Environment variables are parsed and validated only once at application\r\n * startup, and the validated results are exported as `envs` for use throughout\r\n * the application.\r\n *\r\n * Options from other sources, however, are parsed and validated on demand,\r\n * each time an export is attempted.\r\n */\r\n\r\nimport dotenv from 'dotenv';\r\nimport { z } from 'zod';\r\n\r\nimport { defaultConfig } from './schemas/config.js';\r\n\r\n// Load the .env into environment variables\r\ndotenv.config();\r\n\r\n// Get scripts names of each category from the default config\r\nconst { coreScripts, moduleScripts, indicatorScripts } =\r\n  defaultConfig.highcharts;\r\n\r\n// Sets the custom error map globally\r\nz.setErrorMap(_customErrorMap);\r\n\r\n/**\r\n * Object containing custom general validators and parsers to avoid repetition\r\n * in schema objects. All validators apply to values from various sources,\r\n * including the default config file, a custom JSON file loaded with the option\r\n * called `loadConfig`, the .env file, CLI arguments, and the request payload.\r\n * The `strictCheck` flag enables stricter validation and parsing rules. This\r\n * flag is set to false for values that come from the .env file or CLI arguments\r\n * because they are provided as strings and need to be parsed accordingly first.\r\n */\r\nconst v = {\r\n  /**\r\n   * The `boolean` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept values are true\r\n   * and false and the schema will validate against the default boolean\r\n   * validator.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept values are true,\r\n   * false, null, 'true', 'false', 'undefined', 'null', and ''. The strings\r\n   * 'undefined', 'null', and '' will be transformed to null, the string 'true'\r\n   * will be transformed to the boolean value true, and 'false' will\r\n   * be transformed to the boolean value false.\r\n   *\r\n   * @function boolean\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating boolean values.\r\n   */\r\n  boolean(strictCheck) {\r\n    return strictCheck\r\n      ? z.boolean()\r\n      : z\r\n          .union([\r\n            z\r\n              .enum(['true', 'false', 'undefined', 'null', ''])\r\n              .transform((value) =>\r\n                !['undefined', 'null', ''].includes(value)\r\n                  ? value === 'true'\r\n                  : null\r\n              ),\r\n            z.boolean()\r\n          ])\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `string` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept trimmed strings except\r\n   * the forbidden values: 'false', 'undefined', 'null', and ''.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept trimmed strings\r\n   * and null. The forbidden values: 'false', 'undefined', 'null', and '' will\r\n   * be transformed to null.\r\n   *\r\n   * @function string\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating string values.\r\n   */\r\n  string(strictCheck) {\r\n    return strictCheck\r\n      ? z\r\n          .string()\r\n          .trim()\r\n          .refine(\r\n            (value) => !['false', 'undefined', 'null', ''].includes(value),\r\n            {\r\n              params: {\r\n                errorMessage: `The string contains a forbidden value`\r\n              }\r\n            }\r\n          )\r\n      : z\r\n          .string()\r\n          .trim()\r\n          .transform((value) =>\r\n            !['false', 'undefined', 'null', ''].includes(value) ? value : null\r\n          )\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `enum` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The schema will validate against the provided `values` array.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will validate against the `values`\r\n   * array with the default enum validator.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept also null,\r\n   * 'undefined', 'null', and '', which will be transformed to null.\r\n   *\r\n   * @function enum\r\n   *\r\n   * @param {Array.<string>} values - An array of valid string values\r\n   * for the enum.\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating enum values.\r\n   */\r\n  enum(values, strictCheck) {\r\n    return strictCheck\r\n      ? z.enum([...values])\r\n      : z\r\n          .enum([...values, 'undefined', 'null', ''])\r\n          .transform((value) =>\r\n            !['undefined', 'null', ''].includes(value) ? value : null\r\n          )\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `stringArray` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept an array of trimmed\r\n   * string values filtered by the logic provided through the `filterCallback`.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept null and trimmed\r\n   * string values which will be splitted into an array of strings and filtered\r\n   * from the '[' and ']' characters and by the logic provided through\r\n   * the `filterCallback`. If the array is empty, it will be transformed\r\n   * to null.\r\n   *\r\n   * @function stringArray\r\n   *\r\n   * @param {function} filterCallback - The filter callback.\r\n   * @param {string} separator - The separator for spliting a string.\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating array of string\r\n   * values.\r\n   */\r\n  stringArray(filterCallback, separator, strictCheck) {\r\n    const arraySchema = z.string().trim().array();\r\n    const stringSchema = z\r\n      .string()\r\n      .trim()\r\n      .transform((value) => {\r\n        if (value.startsWith('[')) {\r\n          value = value.slice(1);\r\n        }\r\n        if (value.endsWith(']')) {\r\n          value = value.slice(0, -1);\r\n        }\r\n        return value.split(separator);\r\n      });\r\n\r\n    const transformCallback = (value) =>\r\n      value.map((value) => value.trim()).filter(filterCallback);\r\n\r\n    return strictCheck\r\n      ? arraySchema.transform(transformCallback)\r\n      : z\r\n          .union([stringSchema, arraySchema])\r\n          .transform(transformCallback)\r\n          .transform((value) => (value.length ? value : null))\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `positiveNum` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept positive number values\r\n   * and validate against the default positive number validator.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept positive number\r\n   * values, null, and trimmed string values that can either be 'undefined',\r\n   * 'null', '', or represent a positive number. It will transform the string\r\n   * to a positive number, or to null if it is 'undefined', 'null', or ''.\r\n   *\r\n   * @function positiveNum\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating positive number\r\n   * values.\r\n   */\r\n  positiveNum(strictCheck) {\r\n    return strictCheck\r\n      ? z.number().positive()\r\n      : z\r\n          .union([\r\n            z\r\n              .string()\r\n              .trim()\r\n              .refine(\r\n                (value) =>\r\n                  (!isNaN(Number(value)) && Number(value) > 0) ||\r\n                  ['undefined', 'null', ''].includes(value),\r\n                {\r\n                  params: {\r\n                    errorMessage: `The value must be numeric and positive`\r\n                  }\r\n                }\r\n              )\r\n              .transform((value) =>\r\n                !['undefined', 'null', ''].includes(value)\r\n                  ? Number(value)\r\n                  : null\r\n              ),\r\n            z.number().positive()\r\n          ])\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `nonNegativeNum` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept non-negative number\r\n   * values and validate against the default non-negative number validator.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept non-negative number\r\n   * values, null, and trimmed string values that can either be 'undefined',\r\n   * 'null', '', or represent a non-negative number. It will transform\r\n   * the string to a non-negative number, or to null if it is 'undefined',\r\n   * 'null', or ''.\r\n   *\r\n   * @function nonNegativeNum\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating non-negative\r\n   * number values.\r\n   */\r\n  nonNegativeNum(strictCheck) {\r\n    return strictCheck\r\n      ? z.number().nonnegative()\r\n      : z\r\n          .union([\r\n            z\r\n              .string()\r\n              .trim()\r\n              .refine(\r\n                (value) =>\r\n                  (!isNaN(Number(value)) && Number(value) >= 0) ||\r\n                  ['undefined', 'null', ''].includes(value),\r\n                {\r\n                  params: {\r\n                    errorMessage: `The value must be numeric and non-negative`\r\n                  }\r\n                }\r\n              )\r\n              .transform((value) =>\r\n                !['undefined', 'null', ''].includes(value)\r\n                  ? Number(value)\r\n                  : null\r\n              ),\r\n            z.number().nonnegative()\r\n          ])\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `startsWith` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The schema will validate against the provided `prefixes` array to check\r\n   * whether a string value starts with any of the values provided\r\n   * in the `prefixes` array.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept trimmed string values\r\n   * that start with values from the prefixes array.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept trimmed string values\r\n   * that start with values from the prefixes array, null, 'undefined', 'null',\r\n   * and '' where the schema will transform them to null.\r\n   *\r\n   * @function startsWith\r\n   *\r\n   * @param {Array.<string>} prefixes - An array of prefixes to validate\r\n   * the string against.\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating strings that\r\n   * starts with values.\r\n   */\r\n  startsWith(prefixes, strictCheck) {\r\n    return strictCheck\r\n      ? z\r\n          .string()\r\n          .trim()\r\n          .refine(\r\n            (value) => prefixes.some((prefix) => value.startsWith(prefix)),\r\n            {\r\n              params: {\r\n                errorMessage: `The value must be a string that starts with ${prefixes.join(', ')}`\r\n              }\r\n            }\r\n          )\r\n      : z\r\n          .string()\r\n          .trim()\r\n          .refine(\r\n            (value) =>\r\n              prefixes.some((prefix) => value.startsWith(prefix)) ||\r\n              ['undefined', 'null', ''].includes(value),\r\n            {\r\n              params: {\r\n                errorMessage: `The value must be a string that starts with ${prefixes.join(', ')}`\r\n              }\r\n            }\r\n          )\r\n          .transform((value) =>\r\n            !['undefined', 'null', ''].includes(value) ? value : null\r\n          )\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `chartConfig` validator that returns a Zod schema.\r\n   *\r\n   * The validation schema ensures that the schema will accept object values\r\n   * or trimmed string values that contain '<svg' or '<?xml' elements, start\r\n   * with the '{' and end with the '}', and null. The 'undefined', 'null',\r\n   * and '' values will be transformed to null.\r\n   *\r\n   * @function chartConfig\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating chart\r\n   * configuration value.\r\n   */\r\n  chartConfig() {\r\n    return z\r\n      .union([\r\n        z\r\n          .string()\r\n          .trim()\r\n          .refine(\r\n            (value) =>\r\n              value.indexOf('<svg') >= 0 ||\r\n              value.indexOf('<?xml') >= 0 ||\r\n              (value.startsWith('{') && value.endsWith('}')) ||\r\n              ['undefined', 'null', ''].includes(value),\r\n            {\r\n              params: {\r\n                errorMessage: `The value must be a string that contains '<svg' or '<?xml' or starts with '{' and ends with '}'`\r\n              }\r\n            }\r\n          )\r\n          .transform((value) =>\r\n            !['undefined', 'null', ''].includes(value) ? value : null\r\n          ),\r\n        z.object({}).passthrough()\r\n      ])\r\n      .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `additionalOptions` validator that returns a Zod schema.\r\n   *\r\n   * The validation schema ensures that the schema will accept object values\r\n   * or trimmed string values that end with '.json' and are at least one\r\n   * character long excluding the extension, start with the '{' and end\r\n   * with the '}', and null. The 'undefined', 'null', and '' values will\r\n   * be transformed to null.\r\n   *\r\n   * @function additionalOptions\r\n   *\r\n   * @returns {z.ZodSchema}  A Zod schema object for validating additional chart\r\n   * options value.\r\n   */\r\n  additionalOptions() {\r\n    return z\r\n      .union([\r\n        z\r\n          .string()\r\n          .trim()\r\n          .refine(\r\n            (value) =>\r\n              (value.length >= 6 && value.endsWith('.json')) ||\r\n              (value.startsWith('{') && value.endsWith('}')) ||\r\n              ['undefined', 'null', ''].includes(value),\r\n            {\r\n              params: {\r\n                errorMessage: `The value must be a string that ends with '.json' or starts with '{' and ends with '}'`\r\n              }\r\n            }\r\n          )\r\n          .transform((value) =>\r\n            !['undefined', 'null', ''].includes(value) ? value : null\r\n          ),\r\n        z.object({}).passthrough()\r\n      ])\r\n      .nullable();\r\n  }\r\n};\r\n\r\n/**\r\n * Object containing custom config validators and parsers to avoid repetition\r\n * in schema objects. All validators apply to values from various sources,\r\n * including the default config file, a custom JSON file loaded with the option\r\n * called `loadConfig`, the .env file, CLI arguments, and the request payload.\r\n * The `strictCheck` flag enables stricter validation and parsing rules. This\r\n * flag is set to false for values that come from the .env file or CLI arguments\r\n * because they are provided as strings and need to be parsed accordingly first.\r\n */\r\nconst config = {\r\n  /**\r\n   * The `args` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `stringArray` validator.\r\n   *\r\n   * @function args\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `args`\r\n   * option.\r\n   */\r\n  args(strictCheck) {\r\n    return v.stringArray(\r\n      (value) => !['false', 'undefined', 'null', ''].includes(value),\r\n      ';',\r\n      strictCheck\r\n    );\r\n  },\r\n\r\n  /**\r\n   * The `version` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept trimmed string values\r\n   * that are a RegExp-based that allows to be 'latest', or in the format XX,\r\n   * XX.YY, or XX.YY.ZZ, where XX, YY, and ZZ are numeric for the Highcharts\r\n   * version option.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept also null,\r\n   * 'undefined', 'null', or '' and in all cases the schema will transform them\r\n   * to null.\r\n   *\r\n   * @function version\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `version`\r\n   * option.\r\n   */\r\n  version(strictCheck) {\r\n    return strictCheck\r\n      ? z\r\n          .string()\r\n          .trim()\r\n          .refine((value) => /^(latest|\\d{1,2}(\\.\\d{1,2}){0,2})$/.test(value), {\r\n            params: {\r\n              errorMessage:\r\n                \"The value must be 'latest', a major version, or in the form XX.YY.ZZ\"\r\n            }\r\n          })\r\n      : z\r\n          .string()\r\n          .trim()\r\n          .refine(\r\n            (value) =>\r\n              /^(latest|\\d{1,2}(\\.\\d{1,2}){0,2})$/.test(value) ||\r\n              ['undefined', 'null', ''].includes(value),\r\n            {\r\n              params: {\r\n                errorMessage:\r\n                  \"The value must be 'latest', a major version, or in the form XX.YY.ZZ\"\r\n              }\r\n            }\r\n          )\r\n          .transform((value) =>\r\n            !['undefined', 'null', ''].includes(value) ? value : null\r\n          )\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `cdnUrl` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `startsWith` validator.\r\n   *\r\n   * @function cdnUrl\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `cdnUrl`\r\n   * option.\r\n   */\r\n  cdnUrl(strictCheck) {\r\n    return v.startsWith(['http://', 'https://'], strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `forceFetch` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function forceFetch\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `forceFetch`\r\n   * option.\r\n   */\r\n  forceFetch(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `cachePath` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function cachePath\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `cachePath`\r\n   * option.\r\n   */\r\n  cachePath(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `adminToken` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function adminToken\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `adminToken`\r\n   * option.\r\n   */\r\n  adminToken(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `coreScripts` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `stringArray` validator.\r\n   *\r\n   * @function coreScripts\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `coreScripts`\r\n   * option.\r\n   */\r\n  coreScripts(strictCheck) {\r\n    return v.stringArray(\r\n      (value) => coreScripts.value.includes(value),\r\n      ',',\r\n      strictCheck\r\n    );\r\n  },\r\n\r\n  /**\r\n   * The `moduleScripts` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `stringArray` validator.\r\n   *\r\n   * @function moduleScripts\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `moduleScripts` option.\r\n   */\r\n  moduleScripts(strictCheck) {\r\n    return v.stringArray(\r\n      (value) => moduleScripts.value.includes(value),\r\n      ',',\r\n      strictCheck\r\n    );\r\n  },\r\n\r\n  /**\r\n   * The `indicatorScripts` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `stringArray` validator.\r\n   *\r\n   * @function indicatorScripts\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `indicatorScripts` option.\r\n   */\r\n  indicatorScripts(strictCheck) {\r\n    return v.stringArray(\r\n      (value) => indicatorScripts.value.includes(value),\r\n      ',',\r\n      strictCheck\r\n    );\r\n  },\r\n\r\n  /**\r\n   * The `customScripts` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `stringArray` validator.\r\n   *\r\n   * @function customScripts\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `customScripts` option.\r\n   */\r\n  customScripts(strictCheck) {\r\n    return v.stringArray(\r\n      (value) => value.startsWith('https://') || value.startsWith('http://'),\r\n      ',',\r\n      strictCheck\r\n    );\r\n  },\r\n\r\n  /**\r\n   * The `infile` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept trimmed string values\r\n   * that end with '.json' or '.svg', are at least one character long excluding\r\n   * the extension, or null.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept trimmed string values\r\n   * that end with '.json' or '.svg', are at least one character long excluding\r\n   * the extension and will be null if the provided value is null, 'undefined',\r\n   * 'null', or ''.\r\n   *\r\n   * @function infile\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `infile`\r\n   * option.\r\n   */\r\n  infile(strictCheck) {\r\n    return strictCheck\r\n      ? z\r\n          .string()\r\n          .trim()\r\n          .refine(\r\n            (value) =>\r\n              (value.length >= 6 && value.endsWith('.json')) ||\r\n              (value.length >= 5 && value.endsWith('.svg')),\r\n            {\r\n              params: {\r\n                errorMessage: `The value must be a string that ends with .json or .svg`\r\n              }\r\n            }\r\n          )\r\n          .nullable()\r\n      : z\r\n          .string()\r\n          .trim()\r\n          .refine(\r\n            (value) =>\r\n              (value.length >= 6 && value.endsWith('.json')) ||\r\n              (value.length >= 5 && value.endsWith('.svg')) ||\r\n              ['undefined', 'null', ''].includes(value),\r\n            {\r\n              params: {\r\n                errorMessage: `The value must be a string that ends with .json or .svg`\r\n              }\r\n            }\r\n          )\r\n          .transform((value) =>\r\n            !['undefined', 'null', ''].includes(value) ? value : null\r\n          )\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `instr` validator that returns a Zod schema.\r\n   *\r\n   * The validation schema ensures the same work as the `options` validator.\r\n   *\r\n   * @function instr\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `instr`\r\n   * option.\r\n   */\r\n  instr() {\r\n    return v.chartConfig();\r\n  },\r\n\r\n  /**\r\n   * The `options` validator that returns a Zod schema.\r\n   *\r\n   * The validation schema ensures the same work as the `options` validator.\r\n   *\r\n   * @function options\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `options`\r\n   * option.\r\n   */\r\n  options() {\r\n    return v.chartConfig();\r\n  },\r\n\r\n  /**\r\n   * The `svg` validator that returns a Zod schema.\r\n   *\r\n   * The validation schema ensures that the schema will accept object values\r\n   * or trimmed string values that contain '<svg' or '<?xml' elements and null.\r\n   * The 'undefined', 'null', and '' values will be transformed to null.\r\n   *\r\n   * @function svg\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `svg` option.\r\n   */\r\n  svg() {\r\n    return z\r\n      .string()\r\n      .trim()\r\n      .refine(\r\n        (value) =>\r\n          value.indexOf('<svg') >= 0 ||\r\n          value.indexOf('<?xml') >= 0 ||\r\n          ['false', 'undefined', 'null', ''].includes(value),\r\n        {\r\n          params: {\r\n            errorMessage: `The value must be a string that contains '<svg' or '<?xml'`\r\n          }\r\n        }\r\n      )\r\n      .transform((value) =>\r\n        !['false', 'undefined', 'null', ''].includes(value) ? value : null\r\n      )\r\n      .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `outfile` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept trimmed string values\r\n   * that end with '.jpeg', '.jpg', '.png', '.pdf', or '.svg', are at least one\r\n   * character long excluding the extension, or null.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept trimmed string values\r\n   * that end with '.jpeg', '.jpg', '.png', '.pdf', or '.svg', are at least one\r\n   * character long excluding the extension and will be null if the provided\r\n   * value is null, 'undefined', 'null', or ''.\r\n   *\r\n   * @function outfile\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `outfile`\r\n   * option.\r\n   */\r\n  outfile(strictCheck) {\r\n    return strictCheck\r\n      ? z\r\n          .string()\r\n          .trim()\r\n          .refine(\r\n            (value) =>\r\n              (value.length >= 6 && value.endsWith('.jpeg')) ||\r\n              (value.length >= 5 &&\r\n                (value.endsWith('.jpg') ||\r\n                  value.endsWith('.png') ||\r\n                  value.endsWith('.pdf') ||\r\n                  value.endsWith('.svg'))),\r\n            {\r\n              params: {\r\n                errorMessage: `The value must be a string that ends with .jpeg, .jpg, .png, .pdf, or .svg`\r\n              }\r\n            }\r\n          )\r\n          .nullable()\r\n      : z\r\n          .string()\r\n          .trim()\r\n          .refine(\r\n            (value) =>\r\n              (value.length >= 6 && value.endsWith('.jpeg')) ||\r\n              (value.length >= 5 &&\r\n                (value.endsWith('.jpg') ||\r\n                  value.endsWith('.png') ||\r\n                  value.endsWith('.pdf') ||\r\n                  value.endsWith('.svg'))) ||\r\n              ['undefined', 'null', ''].includes(value),\r\n            {\r\n              params: {\r\n                errorMessage: `The value must be a string that ends with .jpeg, .jpg, .png, .pdf, or .svg`\r\n              }\r\n            }\r\n          )\r\n          .transform((value) =>\r\n            !['undefined', 'null', ''].includes(value) ? value : null\r\n          )\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `type` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `enum` validator.\r\n   *\r\n   * @function type\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `type`\r\n   * option.\r\n   */\r\n  type(strictCheck) {\r\n    return v.enum(['jpeg', 'jpg', 'png', 'pdf', 'svg'], strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `constr` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `enum` validator.\r\n   *\r\n   * @function constr\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `constr`\r\n   * option.\r\n   */\r\n  constr(strictCheck) {\r\n    return v.enum(\r\n      ['chart', 'stockChart', 'mapChart', 'ganttChart'],\r\n      strictCheck\r\n    );\r\n  },\r\n\r\n  /**\r\n   * The `b64` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function b64\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `b64` option.\r\n   */\r\n  b64(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `noDownload` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function noDownload\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `noDownload`\r\n   * option.\r\n   */\r\n  noDownload(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `defaultHeight` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `positiveNum` validator.\r\n   *\r\n   * @function defaultHeight\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `defaultHeight` option.\r\n   */\r\n  defaultHeight(strictCheck) {\r\n    return v.positiveNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `defaultWidth` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `positiveNum` validator.\r\n   *\r\n   * @function defaultWidth\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `defaultWidth` option.\r\n   */\r\n  defaultWidth(strictCheck) {\r\n    return v.positiveNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `defaultScale` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept number values that\r\n   * are between 0.1 and 5 (inclusive).\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept number values\r\n   * and stringified number values that are between 0.1 and 5 (inclusive), null,\r\n   * 'undefined', 'null', and '' which will be transformed to null.\r\n   *\r\n   * @function defaultScale\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `defaultScale` option.\r\n   */\r\n  defaultScale(strictCheck) {\r\n    return strictCheck\r\n      ? z.number().gte(0.1).lte(5)\r\n      : z\r\n          .union([\r\n            z\r\n              .string()\r\n              .trim()\r\n              .refine(\r\n                (value) =>\r\n                  (!isNaN(Number(value)) &&\r\n                    value !== true &&\r\n                    !value.startsWith('[') &&\r\n                    Number(value) >= 0.1 &&\r\n                    Number(value) <= 5) ||\r\n                  ['undefined', 'null', ''].includes(value),\r\n                {\r\n                  params: {\r\n                    errorMessage: 'The value must be within a 0.1 and 5.0 range'\r\n                  }\r\n                }\r\n              )\r\n              .transform((value) =>\r\n                !['undefined', 'null', ''].includes(value)\r\n                  ? Number(value)\r\n                  : null\r\n              ),\r\n            z.number().gte(0.1).lte(5)\r\n          ])\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `height` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as a nullable `defaultHeight`\r\n   * validator.\r\n   *\r\n   * @function height\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `height`\r\n   * option.\r\n   */\r\n  height(strictCheck) {\r\n    return this.defaultHeight(strictCheck).nullable();\r\n  },\r\n\r\n  /**\r\n   * The `width` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as a nullable `defaultWidth`\r\n   * validator.\r\n   *\r\n   * @function width\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `width`\r\n   * option.\r\n   */\r\n  width(strictCheck) {\r\n    return this.defaultWidth(strictCheck).nullable();\r\n  },\r\n\r\n  /**\r\n   * The `scale` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as a nullable `defaultScale`\r\n   * validator.\r\n   *\r\n   * @function scale\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `scale`\r\n   * option.\r\n   */\r\n  scale(strictCheck) {\r\n    return this.defaultScale(strictCheck).nullable();\r\n  },\r\n\r\n  /**\r\n   * The `globalOptions` validator that returns a Zod schema.\r\n   *\r\n   * The validation schema ensures the same work as the `additionalOptions`\r\n   * validator.\r\n   *\r\n   * @function globalOptions\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `globalOptions` option.\r\n   */\r\n  globalOptions() {\r\n    return v.additionalOptions();\r\n  },\r\n\r\n  /**\r\n   * The `themeOptions` validator that returns a Zod schema.\r\n   *\r\n   * The validation schema ensures the same work as the `additionalOptions`\r\n   * validator.\r\n   *\r\n   * @function themeOptions\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `themeOptions` option.\r\n   */\r\n  themeOptions() {\r\n    return v.additionalOptions();\r\n  },\r\n\r\n  /**\r\n   * The `batch` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function batch\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `batch`\r\n   * option.\r\n   */\r\n  batch(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `rasterizationTimeout` validator that returns a Zod schema with\r\n   * an optional stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function rasterizationTimeout\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `rasterizationTimeout` option.\r\n   */\r\n  rasterizationTimeout(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `allowCodeExecution` validator that returns a Zod schema with\r\n   * an optional stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function allowCodeExecution\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `allowCodeExecution` option.\r\n   */\r\n  allowCodeExecution(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `allowFileResources` validator that returns a Zod schema with\r\n   * an optional stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function allowFileResources\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `allowFileResources` option.\r\n   */\r\n  allowFileResources(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `customCode` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function customCode\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `customCode`\r\n   * option.\r\n   */\r\n  customCode(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `callback` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function callback\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `callback`\r\n   * option.\r\n   */\r\n  callback(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `resources` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept a partial object\r\n   * with allowed properties `js`, `css`, and `files` where each of the allowed\r\n   * properties can be null, stringified version of the object, string that ends\r\n   * with the '.json', and null.\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept a stringified version\r\n   * of a partial object with allowed properties `js`, `css`, and `files` where\r\n   * each of the allowed properties can be null, string that ends with the\r\n   * '.json', and will be null if the provided value is 'undefined', 'null'\r\n   * or ''.\r\n   *\r\n   * @function resources\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `resources`\r\n   * option.\r\n   */\r\n  resources(strictCheck) {\r\n    const objectSchema = z\r\n      .object({\r\n        js: v.string(false),\r\n        css: v.string(false),\r\n        files: v\r\n          .stringArray(\r\n            (value) => !['undefined', 'null', ''].includes(value),\r\n            ',',\r\n            true\r\n          )\r\n          .nullable()\r\n      })\r\n      .partial();\r\n\r\n    const stringSchema1 = z\r\n      .string()\r\n      .trim()\r\n      .refine(\r\n        (value) =>\r\n          (value.startsWith('{') && value.endsWith('}')) ||\r\n          (value.length >= 6 && value.endsWith('.json')),\r\n        {\r\n          params: {\r\n            errorMessage: `The value must be a string that starts with '{' and ends with '}`\r\n          }\r\n        }\r\n      );\r\n\r\n    const stringSchema2 = z\r\n      .string()\r\n      .trim()\r\n      .refine(\r\n        (value) =>\r\n          (value.startsWith('{') && value.endsWith('}')) ||\r\n          (value.length >= 6 && value.endsWith('.json')) ||\r\n          ['undefined', 'null', ''].includes(value),\r\n        {\r\n          params: {\r\n            errorMessage: `The value must be a string that ends with '.json'`\r\n          }\r\n        }\r\n      )\r\n      .transform((value) =>\r\n        !['undefined', 'null', ''].includes(value) ? value : null\r\n      );\r\n\r\n    return strictCheck\r\n      ? z.union([objectSchema, stringSchema1]).nullable()\r\n      : z.union([objectSchema, stringSchema2]).nullable();\r\n  },\r\n\r\n  /**\r\n   * The `loadConfig` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   * Additionally, it must be a string that ends with '.json'.\r\n   *\r\n   * @function loadConfig\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `loadConfig`\r\n   * option.\r\n   */\r\n  loadConfig(strictCheck) {\r\n    return v\r\n      .string(strictCheck)\r\n      .refine(\r\n        (value) =>\r\n          value === null || (value.length >= 6 && value.endsWith('.json')),\r\n        {\r\n          params: {\r\n            errorMessage: `The value must be a string that ends with .json `\r\n          }\r\n        }\r\n      );\r\n  },\r\n\r\n  /**\r\n   * The `createConfig` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `loadConfig` validator.\r\n   *\r\n   * @function createConfig\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `createConfig` option.\r\n   */\r\n  createConfig(strictCheck) {\r\n    return this.loadConfig(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `enableServer` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function enableServer\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `enableServer` option.\r\n   */\r\n  enableServer(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `host` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function host\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `host`\r\n   * option.\r\n   */\r\n  host(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `port` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function port\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `port`\r\n   * option.\r\n   */\r\n  port(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `uploadLimit` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `positiveNum` validator.\r\n   *\r\n   * @function uploadLimit\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `uploadLimit`\r\n   * option.\r\n   */\r\n  uploadLimit(strictCheck) {\r\n    return v.positiveNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `serverBenchmarking` validator that returns a Zod schema with\r\n   * an optional stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function serverBenchmarking\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `serverBenchmarking` option.\r\n   */\r\n  serverBenchmarking(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `proxyHost` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function proxyHost\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `proxyHost`\r\n   * option.\r\n   */\r\n  proxyHost(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `proxyPort` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as a nullable `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function proxyPort\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `proxyPort`\r\n   * option.\r\n   */\r\n  proxyPort(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck).nullable();\r\n  },\r\n\r\n  /**\r\n   * The `proxyTimeout` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function proxyTimeout\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `proxyTimeout` option.\r\n   */\r\n  proxyTimeout(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `enableRateLimiting` validator that returns a Zod schema with\r\n   * an optional stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function enableRateLimiting\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `enableRateLimiting` option.\r\n   */\r\n  enableRateLimiting(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `maxRequests` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function maxRequests\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `maxRequests`\r\n   * option.\r\n   */\r\n  maxRequests(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `window` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function window\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `window`\r\n   * option.\r\n   */\r\n  window(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `delay` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function delay\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `delay`\r\n   * option.\r\n   */\r\n  delay(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `trustProxy` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function trustProxy\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `trustProxy`\r\n   * option.\r\n   */\r\n  trustProxy(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `skipKey` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function skipKey\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `skipKey`\r\n   * option.\r\n   */\r\n  skipKey(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `skipToken` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function skipToken\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `skipToken`\r\n   * option.\r\n   */\r\n  skipToken(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `enableSsl` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function enableSsl\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `enableSsl`\r\n   * option.\r\n   */\r\n  enableSsl(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `sslForce` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function sslForce\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `sslForce`\r\n   * option.\r\n   */\r\n  sslForce(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `sslPort` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function sslPort\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `sslPort`\r\n   * option.\r\n   */\r\n  sslPort(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `sslCertPath` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function sslCertPath\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `sslCertPath`\r\n   * option.\r\n   */\r\n  sslCertPath(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `minWorkers` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `positiveNum` validator.\r\n   *\r\n   * @function minWorkers\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `minWorkers`\r\n   * option.\r\n   */\r\n  minWorkers(strictCheck) {\r\n    return v.positiveNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `maxWorkers` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `positiveNum` validator.\r\n   *\r\n   * @function maxWorkers\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `maxWorkers`\r\n   * option.\r\n   */\r\n  maxWorkers(strictCheck) {\r\n    return v.positiveNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `workLimit` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `positiveNum` validator.\r\n   *\r\n   * @function workLimit\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `workLimit`\r\n   * option.\r\n   */\r\n  workLimit(strictCheck) {\r\n    return v.positiveNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `acquireTimeout` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function acquireTimeout\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `acquireTimeout` option.\r\n   */\r\n  acquireTimeout(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `createTimeout` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function createTimeout\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `createTimeout` option.\r\n   */\r\n  createTimeout(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `destroyTimeout` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function destroyTimeout\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `destroyTimeout` option.\r\n   */\r\n  destroyTimeout(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `idleTimeout` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function idleTimeout\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `idleTimeout` option.\r\n   */\r\n  idleTimeout(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `createRetryInterval` validator that returns a Zod schema with\r\n   * an optional stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function createRetryInterval\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `createRetryInterval` option.\r\n   */\r\n  createRetryInterval(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `reaperInterval` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function reaperInterval\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `reaperInterval` option.\r\n   */\r\n  reaperInterval(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `poolBenchmarking` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function poolBenchmarking\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `poolBenchmarking` option.\r\n   */\r\n  poolBenchmarking(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `resourcesInterval` validator that returns a Zod schema with\r\n   * an optional stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function resourcesInterval\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `resourcesInterval` option.\r\n   */\r\n  resourcesInterval(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `logLevel` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures that:\r\n   *\r\n   * - When `strictCheck` is true, the schema will accept integer number values\r\n   * that are between 0 and 5 (inclusive).\r\n   *\r\n   * - When `strictCheck` is false, the schema will accept integer number values\r\n   * and stringified integer number values that are between 1 and 5 (inclusive),\r\n   * null, 'undefined', 'null', and '' which will be transformed to null.\r\n   *\r\n   * @function logLevel\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `logLevel`\r\n   * option.\r\n   */\r\n  logLevel(strictCheck) {\r\n    return strictCheck\r\n      ? z.number().int().gte(0).lte(5)\r\n      : z\r\n          .union([\r\n            z\r\n              .string()\r\n              .trim()\r\n              .refine(\r\n                (value) =>\r\n                  (!isNaN(Number(value)) &&\r\n                    value !== true &&\r\n                    !value.startsWith('[') &&\r\n                    Number.isInteger(Number(value)) &&\r\n                    Number(value) >= 0 &&\r\n                    Number(value) <= 5) ||\r\n                  ['undefined', 'null', ''].includes(value),\r\n                {\r\n                  params: {\r\n                    errorMessage: 'The value must be within a 0 and 5 range'\r\n                  }\r\n                }\r\n              )\r\n              .transform((value) =>\r\n                !['undefined', 'null', ''].includes(value)\r\n                  ? Number(value)\r\n                  : null\r\n              ),\r\n            z.number().int().gte(0).lte(5)\r\n          ])\r\n          .nullable();\r\n  },\r\n\r\n  /**\r\n   * The `logFile` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   * Additionally, it must be a string that ends with '.log'.\r\n   *\r\n   * @function logFile\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `logFile`\r\n   * option.\r\n   */\r\n  logFile(strictCheck) {\r\n    return v\r\n      .string(strictCheck)\r\n      .refine(\r\n        (value) =>\r\n          value === null || (value.length >= 5 && value.endsWith('.log')),\r\n        {\r\n          params: {\r\n            errorMessage: `The value must be a string that ends with '.log'`\r\n          }\r\n        }\r\n      );\r\n  },\r\n\r\n  /**\r\n   * The `logDest` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   *\r\n   * @function logDest\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `logDest`\r\n   * option.\r\n   */\r\n  logDest(strictCheck) {\r\n    return v.string(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `logToConsole` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function logToConsole\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `logToConsole` option.\r\n   */\r\n  logToConsole(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `logToFile` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function logToFile\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `logToFile`\r\n   * option.\r\n   */\r\n  logToFile(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `enableUi` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function enableUi\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `enableUi`\r\n   * option.\r\n   */\r\n  enableUi(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `uiRoute` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `startsWith` validator.\r\n   *\r\n   * @function uiRoute\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `uiRoute`\r\n   * option.\r\n   */\r\n  uiRoute(strictCheck) {\r\n    return v.startsWith(['/'], strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `nodeEnv` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `enum` validator.\r\n   *\r\n   * @function nodeEnv\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `nodeEnv`\r\n   * option.\r\n   */\r\n  nodeEnv(strictCheck) {\r\n    return v.enum(['development', 'production', 'test'], strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `listenToProcessExits` validator that returns a Zod schema with\r\n   * an optional stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function listenToProcessExits\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `listenToProcessExits` option.\r\n   */\r\n  listenToProcessExits(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `noLogo` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function noLogo\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `noLogo`\r\n   * option.\r\n   */\r\n  noLogo(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `hardResetPage` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function hardResetPage\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `hardResetPage` option.\r\n   */\r\n  hardResetPage(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `browserShellMode` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function browserShellMode\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `browserShellMode` option.\r\n   */\r\n  browserShellMode(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `enableDebug` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function enableDebug\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `enableDebug`\r\n   * option.\r\n   */\r\n  enableDebug(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `headless` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function headless\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `headless`\r\n   * option.\r\n   */\r\n  headless(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `devtools` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function devtools\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `devtools`\r\n   * option.\r\n   */\r\n  devtools(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `listenToConsole` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function listenToConsole\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `listenToConsole` option.\r\n   */\r\n  listenToConsole(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `dumpio` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `boolean` validator.\r\n   *\r\n   * @function dumpio\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `dumpio`\r\n   * option.\r\n   */\r\n  dumpio(strictCheck) {\r\n    return v.boolean(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `slowMo` validator that returns a Zod schema with an optional stricter\r\n   * check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function slowMo\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `slowMo`\r\n   * option.\r\n   */\r\n  slowMo(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `debuggingPort` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `nonNegativeNum`\r\n   * validator.\r\n   *\r\n   * @function debuggingPort\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating\r\n   * the `debuggingPort` option.\r\n   */\r\n  debuggingPort(strictCheck) {\r\n    return v.nonNegativeNum(strictCheck);\r\n  },\r\n\r\n  /**\r\n   * The `requestId` validator that returns a Zod schema with an optional\r\n   * stricter check based on the `strictCheck` parameter.\r\n   *\r\n   * The validation schema ensures the same work as the `string` validator.\r\n   * Additionally, it must be a stringified UUID or can be null.\r\n   *\r\n   * @function requestId\r\n   *\r\n   * @param {boolean} strictCheck - Determines if stricter validation should\r\n   * be applied.\r\n   *\r\n   * @returns {z.ZodSchema} A Zod schema object for validating the `requestId`\r\n   * option.\r\n   */\r\n  requestId() {\r\n    return (\r\n      z\r\n        .string()\r\n        /// TO DO: Correct\r\n        .uuid({ message: 'The value must be a stringified UUID' })\r\n        .nullable()\r\n    );\r\n  }\r\n};\r\n\r\n// Schema for the puppeteer section of options\r\nconst PuppeteerSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      args: config.args(strictCheck)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the highcharts section of options\r\nconst HighchartsSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      version: config.version(strictCheck),\r\n      cdnUrl: config.cdnUrl(strictCheck),\r\n      forceFetch: config.forceFetch(strictCheck),\r\n      cachePath: config.cachePath(strictCheck),\r\n      coreScripts: config.coreScripts(strictCheck),\r\n      moduleScripts: config.moduleScripts(strictCheck),\r\n      indicatorScripts: config.indicatorScripts(strictCheck),\r\n      customScripts: config.customScripts(strictCheck)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the export section of options\r\nconst ExportSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      infile: config.infile(strictCheck),\r\n      instr: config.instr(),\r\n      options: config.options(),\r\n      svg: config.svg(),\r\n      outfile: config.outfile(strictCheck),\r\n      type: config.type(strictCheck),\r\n      constr: config.constr(strictCheck),\r\n      b64: config.b64(strictCheck),\r\n      noDownload: config.noDownload(strictCheck),\r\n      defaultHeight: config.defaultHeight(strictCheck),\r\n      defaultWidth: config.defaultWidth(strictCheck),\r\n      defaultScale: config.defaultScale(strictCheck),\r\n      height: config.height(strictCheck),\r\n      width: config.width(strictCheck),\r\n      scale: config.scale(strictCheck),\r\n      globalOptions: config.globalOptions(),\r\n      themeOptions: config.themeOptions(),\r\n      batch: config.batch(false),\r\n      rasterizationTimeout: config.rasterizationTimeout(strictCheck)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the customLogic section of options\r\nconst CustomLogicSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      allowCodeExecution: config.allowCodeExecution(strictCheck),\r\n      allowFileResources: config.allowFileResources(strictCheck),\r\n      customCode: config.customCode(false),\r\n      callback: config.callback(false),\r\n      resources: config.resources(strictCheck),\r\n      loadConfig: config.loadConfig(false),\r\n      createConfig: config.createConfig(false)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the server.proxy section of options\r\nconst ProxySchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      host: config.proxyHost(false),\r\n      port: config.proxyPort(strictCheck),\r\n      timeout: config.proxyTimeout(strictCheck)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the server.rateLimiting section of options\r\nconst RateLimitingSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      enable: config.enableRateLimiting(strictCheck),\r\n      maxRequests: config.maxRequests(strictCheck),\r\n      window: config.window(strictCheck),\r\n      delay: config.delay(strictCheck),\r\n      trustProxy: config.trustProxy(strictCheck),\r\n      skipKey: config.skipKey(false),\r\n      skipToken: config.skipToken(false)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the server.ssl section of options\r\nconst SslSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      enable: config.enableSsl(strictCheck),\r\n      force: config.sslForce(strictCheck),\r\n      port: config.sslPort(strictCheck),\r\n      certPath: config.sslCertPath(false)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the server section of options\r\nconst ServerSchema = (strictCheck) =>\r\n  z.object({\r\n    enable: config.enableServer(strictCheck).optional(),\r\n    host: config.host(strictCheck).optional(),\r\n    port: config.port(strictCheck).optional(),\r\n    benchmarking: config.serverBenchmarking(strictCheck).optional(),\r\n    proxy: ProxySchema(strictCheck).optional(),\r\n    rateLimiting: RateLimitingSchema(strictCheck).optional(),\r\n    ssl: SslSchema(strictCheck).optional()\r\n  });\r\n\r\n// Schema for the pool section of options\r\nconst PoolSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      minWorkers: config.minWorkers(strictCheck),\r\n      maxWorkers: config.maxWorkers(strictCheck),\r\n      workLimit: config.workLimit(strictCheck),\r\n      acquireTimeout: config.acquireTimeout(strictCheck),\r\n      createTimeout: config.createTimeout(strictCheck),\r\n      destroyTimeout: config.destroyTimeout(strictCheck),\r\n      idleTimeout: config.idleTimeout(strictCheck),\r\n      createRetryInterval: config.createRetryInterval(strictCheck),\r\n      reaperInterval: config.reaperInterval(strictCheck),\r\n      benchmarking: config.poolBenchmarking(strictCheck)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the logging section of options\r\nconst LoggingSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      level: config.logLevel(strictCheck),\r\n      file: config.logFile(strictCheck),\r\n      dest: config.logDest(strictCheck),\r\n      toConsole: config.logToConsole(strictCheck),\r\n      toFile: config.logToFile(strictCheck)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the ui section of options\r\nconst UiSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      enable: config.enableUi(strictCheck),\r\n      route: config.uiRoute(strictCheck)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the other section of options\r\nconst OtherSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      nodeEnv: config.nodeEnv(strictCheck),\r\n      listenToProcessExits: config.listenToProcessExits(strictCheck),\r\n      noLogo: config.noLogo(strictCheck),\r\n      hardResetPage: config.hardResetPage(strictCheck),\r\n      browserShellMode: config.browserShellMode(strictCheck)\r\n    })\r\n    .partial();\r\n\r\n// Schema for the debug section of options\r\nconst DebugSchema = (strictCheck) =>\r\n  z\r\n    .object({\r\n      enable: config.enableDebug(strictCheck),\r\n      headless: config.headless(strictCheck),\r\n      devtools: config.devtools(strictCheck),\r\n      listenToConsole: config.listenToConsole(strictCheck),\r\n      dumpio: config.dumpio(strictCheck),\r\n      slowMo: config.slowMo(strictCheck),\r\n      debuggingPort: config.debuggingPort(strictCheck)\r\n    })\r\n    .partial();\r\n\r\n////\r\n// // Schema for the payload section of options\r\n// const PayloadSchema = () =>\r\n//   z\r\n//     .object({\r\n//       requestId: config.requestId()\r\n//     })\r\n//     .partial();\r\n////\r\n\r\n// Strict schema for the config\r\nexport const StrictConfigSchema = z.object({\r\n  puppeteer: PuppeteerSchema(true),\r\n  highcharts: HighchartsSchema(true),\r\n  export: ExportSchema(true),\r\n  customLogic: CustomLogicSchema(true),\r\n  server: ServerSchema(true),\r\n  pool: PoolSchema(true),\r\n  logging: LoggingSchema(true),\r\n  ui: UiSchema(true),\r\n  other: OtherSchema(true),\r\n  debug: DebugSchema(true)\r\n  //// payload: PayloadSchema()\r\n});\r\n\r\n// Loose schema for the config\r\nexport const LooseConfigSchema = z.object({\r\n  puppeteer: PuppeteerSchema(false),\r\n  highcharts: HighchartsSchema(false),\r\n  export: ExportSchema(false),\r\n  customLogic: CustomLogicSchema(false),\r\n  server: ServerSchema(false),\r\n  pool: PoolSchema(false),\r\n  logging: LoggingSchema(false),\r\n  ui: UiSchema(false),\r\n  other: OtherSchema(false),\r\n  debug: DebugSchema(false)\r\n  //// payload: PayloadSchema()\r\n});\r\n\r\n// Schema for the environment variables config\r\nexport const EnvSchema = z.object({\r\n  // puppeteer\r\n  PUPPETEER_ARGS: config.args(false),\r\n\r\n  // highcharts\r\n  HIGHCHARTS_VERSION: config.version(false),\r\n  HIGHCHARTS_CDN_URL: config.cdnUrl(false),\r\n  HIGHCHARTS_FORCE_FETCH: config.forceFetch(false),\r\n  HIGHCHARTS_CACHE_PATH: config.cachePath(false),\r\n  HIGHCHARTS_ADMIN_TOKEN: config.adminToken(false),\r\n  HIGHCHARTS_CORE_SCRIPTS: config.coreScripts(false),\r\n  HIGHCHARTS_MODULE_SCRIPTS: config.moduleScripts(false),\r\n  HIGHCHARTS_INDICATOR_SCRIPTS: config.indicatorScripts(false),\r\n  HIGHCHARTS_CUSTOM_SCRIPTS: config.customScripts(false),\r\n\r\n  // export\r\n  EXPORT_INFILE: config.infile(false),\r\n  EXPORT_INSTR: config.instr(),\r\n  EXPORT_OPTIONS: config.options(),\r\n  EXPORT_SVG: config.svg(),\r\n  EXPORT_BATCH: config.batch(false),\r\n  EXPORT_OUTFILE: config.outfile(false),\r\n  EXPORT_TYPE: config.type(false),\r\n  EXPORT_CONSTR: config.constr(false),\r\n  EXPORT_B64: config.b64(false),\r\n  EXPORT_NO_DOWNLOAD: config.noDownload(false),\r\n  EXPORT_HEIGHT: config.height(false),\r\n  EXPORT_WIDTH: config.width(false),\r\n  EXPORT_SCALE: config.scale(false),\r\n  EXPORT_DEFAULT_HEIGHT: config.defaultHeight(false),\r\n  EXPORT_DEFAULT_WIDTH: config.defaultWidth(false),\r\n  EXPORT_DEFAULT_SCALE: config.defaultScale(false),\r\n  EXPORT_GLOBAL_OPTIONS: config.globalOptions(),\r\n  EXPORT_THEME_OPTIONS: config.themeOptions(),\r\n  EXPORT_RASTERIZATION_TIMEOUT: config.rasterizationTimeout(false),\r\n\r\n  // custom\r\n  CUSTOM_LOGIC_ALLOW_CODE_EXECUTION: config.allowCodeExecution(false),\r\n  CUSTOM_LOGIC_ALLOW_FILE_RESOURCES: config.allowFileResources(false),\r\n  CUSTOM_LOGIC_CUSTOM_CODE: config.customCode(false),\r\n  CUSTOM_LOGIC_CALLBACK: config.callback(false),\r\n  CUSTOM_LOGIC_RESOURCES: config.resources(false),\r\n  CUSTOM_LOGIC_LOAD_CONFIG: config.loadConfig(false),\r\n  CUSTOM_LOGIC_CREATE_CONFIG: config.createConfig(false),\r\n\r\n  // server\r\n  SERVER_ENABLE: config.enableServer(false),\r\n  SERVER_HOST: config.host(false),\r\n  SERVER_PORT: config.port(false),\r\n  SERVER_UPLOAD_LIMIT: config.uploadLimit(false),\r\n  SERVER_BENCHMARKING: config.serverBenchmarking(false),\r\n\r\n  // server proxy\r\n  SERVER_PROXY_HOST: config.proxyHost(false),\r\n  SERVER_PROXY_PORT: config.proxyPort(false),\r\n  SERVER_PROXY_TIMEOUT: config.proxyTimeout(false),\r\n\r\n  // server rate limiting\r\n  SERVER_RATE_LIMITING_ENABLE: config.enableRateLimiting(false),\r\n  SERVER_RATE_LIMITING_MAX_REQUESTS: config.maxRequests(false),\r\n  SERVER_RATE_LIMITING_WINDOW: config.window(false),\r\n  SERVER_RATE_LIMITING_DELAY: config.delay(false),\r\n  SERVER_RATE_LIMITING_TRUST_PROXY: config.trustProxy(false),\r\n  SERVER_RATE_LIMITING_SKIP_KEY: config.skipKey(false),\r\n  SERVER_RATE_LIMITING_SKIP_TOKEN: config.skipToken(false),\r\n\r\n  // server ssl\r\n  SERVER_SSL_ENABLE: config.enableSsl(false),\r\n  SERVER_SSL_FORCE: config.sslForce(false),\r\n  SERVER_SSL_PORT: config.sslPort(false),\r\n  SERVER_SSL_CERT_PATH: config.sslCertPath(false),\r\n\r\n  // pool\r\n  POOL_MIN_WORKERS: config.minWorkers(false),\r\n  POOL_MAX_WORKERS: config.maxWorkers(false),\r\n  POOL_WORK_LIMIT: config.workLimit(false),\r\n  POOL_ACQUIRE_TIMEOUT: config.acquireTimeout(false),\r\n  POOL_CREATE_TIMEOUT: config.createTimeout(false),\r\n  POOL_DESTROY_TIMEOUT: config.destroyTimeout(false),\r\n  POOL_IDLE_TIMEOUT: config.idleTimeout(false),\r\n  POOL_CREATE_RETRY_INTERVAL: config.createRetryInterval(false),\r\n  POOL_REAPER_INTERVAL: config.reaperInterval(false),\r\n  POOL_BENCHMARKING: config.poolBenchmarking(false),\r\n\r\n  // logging\r\n  LOGGING_LEVEL: config.logLevel(false),\r\n  LOGGING_FILE: config.logFile(false),\r\n  LOGGING_DEST: config.logDest(false),\r\n  LOGGING_TO_CONSOLE: config.logToConsole(false),\r\n  LOGGING_TO_FILE: config.logToFile(false),\r\n\r\n  // ui\r\n  UI_ENABLE: config.enableUi(false),\r\n  UI_ROUTE: config.uiRoute(false),\r\n\r\n  // other\r\n  OTHER_NODE_ENV: config.nodeEnv(false),\r\n  OTHER_LISTEN_TO_PROCESS_EXITS: config.listenToProcessExits(false),\r\n  OTHER_NO_LOGO: config.noLogo(false),\r\n  OTHER_HARD_RESET_PAGE: config.hardResetPage(false),\r\n  OTHER_BROWSER_SHELL_MODE: config.browserShellMode(false),\r\n\r\n  // debugger\r\n  DEBUG_ENABLE: config.enableDebug(false),\r\n  DEBUG_HEADLESS: config.headless(false),\r\n  DEBUG_DEVTOOLS: config.devtools(false),\r\n  DEBUG_LISTEN_TO_CONSOLE: config.listenToConsole(false),\r\n  DEBUG_DUMPIO: config.dumpio(false),\r\n  DEBUG_SLOW_MO: config.slowMo(false),\r\n  DEBUG_DEBUGGING_PORT: config.debuggingPort(false)\r\n});\r\n\r\n/**\r\n * Validates the environment variables options using the EnvSchema.\r\n *\r\n * @param {Object} process.env - The configuration options from environment\r\n * variables file to validate.\r\n *\r\n * @returns {Object} The parsed and validated environment variables.\r\n */\r\nexport const envs = EnvSchema.partial().parse(process.env);\r\n\r\n/**\r\n * Validates the configuration options using the `StrictConfigSchema`.\r\n *\r\n * @function strictValidate\r\n *\r\n * @param {Object} configOptions - The configuration options to validate.\r\n *\r\n * @returns {Object} The parsed and validated configuration options.\r\n */\r\nexport function strictValidate(configOptions) {\r\n  return StrictConfigSchema.partial().parse(configOptions);\r\n}\r\n\r\n/**\r\n * Validates the configuration options using the `LooseConfigSchema`.\r\n *\r\n * @function looseValidate\r\n *\r\n * @param {Object} configOptions - The configuration options to validate.\r\n *\r\n * @returns {Object} The parsed and validated configuration options.\r\n */\r\nexport function looseValidate(configOptions) {\r\n  return LooseConfigSchema.partial().parse(configOptions);\r\n}\r\n\r\n/**\r\n * Validates a provided option using the specific validator from the config\r\n * object.\r\n *\r\n * @function validateOption\r\n *\r\n * @param {string} name - The name of an option to validate.\r\n * @param {any} option - The option to validate.\r\n * @param {boolean} strictCheck - Determines if stricter validation should\r\n * be applied.\r\n *\r\n * @returns {any} The parsed and validated option value.\r\n */\r\nexport function validateOption(name, option, strictCheck) {\r\n  return config[name](strictCheck).parse(option);\r\n}\r\n\r\n/**\r\n * Custom error mapping function for Zod schema validation.\r\n *\r\n * This function customizes the error messages produced by Zod schema\r\n * validation, providing more specific and user-friendly feedback based on the\r\n * issue type and context.\r\n *\r\n * The function modifies the error messages as follows:\r\n *\r\n * - For missing required values (undefined), it returns a message indicating\r\n * that no value was provided for the specific property.\r\n *\r\n * - For custom validation errors, if a custom error message is provided in the\r\n * issue parameters, it includes this message along with the invalid data\r\n * received.\r\n *\r\n * - For all other errors, it appends property-specific information to the\r\n * default error message provided by Zod.\r\n *\r\n * @function _customErrorMap\r\n *\r\n * @param {z.ZodIssue} issue - The issue object representing the validation\r\n * error.\r\n * @param {Object} context - The context object providing additional information\r\n * about the validation error.\r\n *\r\n * @returns {Object} An object containing the customized error message.\r\n */\r\nfunction _customErrorMap(issue, context) {\r\n  // Get the chain of properties which error directly refers to\r\n  const propertyName = issue.path.join('.');\r\n\r\n  // Create the first part of the message about the property information\r\n  const propertyInfo = `Invalid value for the ${propertyName}`;\r\n\r\n  // Modified message for the invalid type\r\n  if (issue.code === z.ZodIssueCode.invalid_type) {\r\n    // Modified message for the required values\r\n    if (issue.received === z.ZodParsedType.undefined) {\r\n      return {\r\n        message: `${propertyInfo} - No value was provided.`\r\n      };\r\n    }\r\n\r\n    // Modified message for the specific invalid type when values exist\r\n    return {\r\n      message: `${propertyInfo} - Invalid type. ${context.defaultError}.`\r\n    };\r\n  }\r\n\r\n  // Modified message for the custom validation\r\n  if (issue.code === z.ZodIssueCode.custom) {\r\n    // If the custom message for error exist, include it\r\n    if (issue.params?.errorMessage) {\r\n      return {\r\n        message: `${propertyInfo} - ${issue.params?.errorMessage}, received '${context.data}'.`\r\n      };\r\n    }\r\n  }\r\n\r\n  // Modified message for the invalid union error\r\n  if (issue.code === z.ZodIssueCode.invalid_union) {\r\n    // Create the first part of the message about the multiple errors\r\n    let message = `Multiple errors occurred for the ${propertyName}:\\n`;\r\n\r\n    // Cycle through all errors and create a correct message\r\n    issue.unionErrors.forEach((value) => {\r\n      const index = value.issues[0].message.indexOf('-');\r\n      message +=\r\n        index !== -1\r\n          ? `${value.issues[0].message}\\n`.substring(index)\r\n          : `${value.issues[0].message}\\n`;\r\n    });\r\n\r\n    // Return the final message for the invalid union error\r\n    return {\r\n      message\r\n    };\r\n  }\r\n\r\n  // Return the default error message, extended by the info about the property\r\n  return {\r\n    message: `${propertyInfo} - ${context.defaultError}.`\r\n  };\r\n}\r\n\r\nexport default {\r\n  StrictConfigSchema,\r\n  LooseConfigSchema,\r\n  EnvSchema,\r\n  envs,\r\n  strictValidate,\r\n  looseValidate,\r\n  validateOption\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Manages configuration for the Highcharts Export Server by loading\r\n * and merging options from multiple sources, such as default settings,\r\n * environment variables, user-provided options, and command-line arguments.\r\n * Ensures the global options are up-to-date with the highest priority values.\r\n * Provides functions for accessing and updating configuration.\r\n */\r\n\r\nimport { readFileSync } from 'fs';\r\nimport { join } from 'path';\r\n\r\nimport { log, logWithStack, logZodIssues } from './logger.js';\r\nimport { __dirname, isObject, deepCopy, getAbsolutePath } from './utils.js';\r\nimport { envs, looseValidate, strictValidate } from './validation.js';\r\nimport { defaultConfig, nestedProps, absoluteProps } from './schemas/config.js';\r\n\r\n// Sets the global options with initial values from the default config\r\nconst globalOptions = _initGlobalOptions(defaultConfig);\r\n\r\n// An object for the instance options, created each time the `initExport` occurs\r\nconst instanceOptions = deepCopy(globalOptions);\r\n\r\n/**\r\n * Retrieves a reference to the options object. Depending on the `getInstance`\r\n * parameter, it returns either the global options or the instance-specific\r\n * options object.\r\n *\r\n * @function getOptions\r\n *\r\n * @param {boolean} [getInstance=true] - Optional parameter that decides whether\r\n * to return the instance-specific options (when `true`) or the global options\r\n * (when `false`). The default value is `true`.\r\n *\r\n * @returns {Object} A reference to either the global options\r\n * or the instance-specific options, based on the `getInstance` parameter.\r\n */\r\nexport function getOptions(getInstance = true) {\r\n  return getInstance ? instanceOptions : globalOptions;\r\n}\r\n\r\n/**\r\n * Sets the global options of the export server, keeping the principle\r\n * of the options load priority from all available sources. It accepts optional\r\n * `customOptions` object and `cliArgs` array with arguments from the CLI. These\r\n * options will be validated and applied if provided.\r\n *\r\n * The priority order of setting values is:\r\n *\r\n * 1. Options from the `lib/schemas/config.js` file (default values).\r\n * 2. Options from a custom JSON file (loaded by the `loadConfig` option).\r\n * 3. Options from the environment variables (the `.env` file).\r\n * 4. Options from the command line interface (CLI).\r\n * 5. Options from the first parameter (the `customOptions` is by default\r\n * an empty object).\r\n *\r\n * @function setGlobalOptions\r\n *\r\n * @param {Object} [customOptions={}] - Optional custom options for additional\r\n * configuration. The default value is an empty object.\r\n * @param {Array.<string>} [cliArgs=[]] - Optional command line arguments\r\n * for additional configuration. The default value is an empty array.\r\n *\r\n * @returns {Object} The updated global options object, reflecting the merged\r\n * configuration from all available sources.\r\n */\r\nexport function setGlobalOptions(customOptions = {}, cliArgs = []) {\r\n  // Object for options loaded via the `loadConfig` option\r\n  let configOptions = {};\r\n\r\n  // Object for options from the CLI\r\n  let cliOptions = {};\r\n\r\n  // Only for the CLI usage\r\n  if (cliArgs.length) {\r\n    try {\r\n      // Validate options from the custom JSON loaded via the `loadConfig`\r\n      configOptions = strictValidate(_loadConfigFile(cliArgs));\r\n    } catch (error) {\r\n      logZodIssues(\r\n        1,\r\n        error.issues,\r\n        '[config] Custom JSON options validation error'\r\n      );\r\n    }\r\n  }\r\n\r\n  // Apply custom options if there are any\r\n  if (customOptions && Object.keys(customOptions).length !== 0) {\r\n    try {\r\n      // Validate custom options provided by the user\r\n      customOptions = strictValidate(customOptions);\r\n    } catch (error) {\r\n      logZodIssues(1, error.issues, '[config] Custom options validation error');\r\n    }\r\n  }\r\n\r\n  // Only for the CLI usage\r\n  if (cliArgs.length) {\r\n    try {\r\n      // Validate options from the CLI\r\n      cliOptions = looseValidate(_pairArgumentValue(nestedProps, cliArgs));\r\n    } catch (error) {\r\n      logZodIssues(1, error.issues, '[config] CLI options validation error');\r\n    }\r\n  }\r\n\r\n  // Update values of the global options with values from each source possible\r\n  _updateGlobalOptions(\r\n    defaultConfig,\r\n    globalOptions,\r\n    configOptions,\r\n    cliOptions,\r\n    customOptions\r\n  );\r\n\r\n  // Return updated global options\r\n  return globalOptions;\r\n}\r\n\r\n/**\r\n * Updates the instance options with additional options. It optionally allows\r\n * to reinitialize the instance options with the values of a current global\r\n * options object.\r\n *\r\n * @param {Object} updateOptions - The update options to merge into the instance\r\n * options.\r\n * @param {boolean} [newInstance=false] - A flag to indicate whether to init\r\n * options for a new instance. If `true`, the existing instance options will\r\n * be cleared and reinitialized based on the global options.\r\n *\r\n * @returns {Object} - The updated instance options.\r\n */\r\nexport function updateOptions(updateOptions, newInstance = false) {\r\n  // Check if options need to be created for a new instance\r\n  if (newInstance) {\r\n    // Get rid of the old instance options\r\n    Object.keys(instanceOptions).forEach((key) => {\r\n      delete instanceOptions[key];\r\n    });\r\n\r\n    // Init the new instance options based on the global options\r\n    mergeOptions(instanceOptions, deepCopy(globalOptions));\r\n  }\r\n\r\n  // Merge additional options to the instance options\r\n  mergeOptions(instanceOptions, updateOptions);\r\n\r\n  // Return the reference to the instance options object\r\n  return instanceOptions;\r\n}\r\n\r\n/**\r\n * Merges two sets of configuration options, considering absolute properties.\r\n *\r\n * @function mergeOptions\r\n *\r\n * @param {Object} originalOptions - Original configuration options.\r\n * @param {Object} newOptions - New configuration options to be merged.\r\n *\r\n * @returns {Object} Merged configuration options.\r\n */\r\nexport function mergeOptions(originalOptions, newOptions) {\r\n  // Check if the `originalOptions` and `newOptions` are correct objects\r\n  if (isObject(originalOptions) && isObject(newOptions)) {\r\n    for (const [key, value] of Object.entries(newOptions)) {\r\n      originalOptions[key] =\r\n        isObject(value) &&\r\n        !absoluteProps.includes(key) &&\r\n        originalOptions[key] !== undefined\r\n          ? mergeOptions(originalOptions[key], value)\r\n          : value !== undefined\r\n            ? value\r\n            : originalOptions[key] || null;\r\n    }\r\n  }\r\n\r\n  // Return the original (modified or not) options\r\n  return originalOptions;\r\n}\r\n\r\n/**\r\n * Maps old-structured configuration options (PhantomJS) to a new format\r\n * (Puppeteer). This function converts flat, old-structured options into\r\n * a new, nested configuration format based on a predefined mapping\r\n * (`nestedProps`). The new format is used for Puppeteer, while the old format\r\n * was used for PhantomJS.\r\n *\r\n * @function mapToNewOptions\r\n *\r\n * @param {Object} oldOptions - The old, flat configuration options\r\n * to be converted.\r\n *\r\n * @returns {Object} A new object containing options structured according\r\n * to the mapping defined in `nestedProps` or an empty object if the provided\r\n * `oldOptions` is not a correct object.\r\n */\r\nexport function mapToNewOptions(oldOptions) {\r\n  // An object for the new structured options\r\n  const newOptions = {};\r\n\r\n  // Check if provided value is a correct object\r\n  if (isObject(oldOptions)) {\r\n    // Iterate over each key-value pair in the old-structured options\r\n    for (const [key, value] of Object.entries(oldOptions)) {\r\n      // If there is a nested mapping, split it into a properties chain\r\n      const propertiesChain = nestedProps[key]\r\n        ? nestedProps[key].split('.')\r\n        : [];\r\n\r\n      // If it is the last property in the chain, assign the value, otherwise,\r\n      // create or reuse the nested object\r\n      propertiesChain.reduce(\r\n        (obj, prop, index) =>\r\n          (obj[prop] =\r\n            propertiesChain.length - 1 === index ? value : obj[prop] || {}),\r\n        newOptions\r\n      );\r\n    }\r\n  } else {\r\n    log(\r\n      2,\r\n      '[config] No correct object with options was provided. Returning an empty array.'\r\n    );\r\n  }\r\n\r\n  // Return the new, structured options object\r\n  return newOptions;\r\n}\r\n\r\n/**\r\n * Validates, parses, and checks if the provided config is allowed set\r\n * of options.\r\n *\r\n * @function isAllowedConfig\r\n *\r\n * @param {unknown} config - The config to be validated and parsed as a set\r\n * of options. Must be either an object or a string.\r\n * @param {boolean} [toString=false] - Whether to return a stringified version\r\n * of the parsed config. The default value is `false`.\r\n * @param {boolean} [allowFunctions=false] - Whether to allow functions\r\n * in the parsed config. If true, functions are preserved. Otherwise, when\r\n * a function is found, null is returned. The default value is `false`.\r\n *\r\n * @returns {(Object|string|null)} Returns a parsed set of options object,\r\n * a stringified set of options object if the `toString` is true, and null\r\n * if the config is not a valid set of options or parsing fails.\r\n */\r\nexport function isAllowedConfig(\r\n  config,\r\n  toString = false,\r\n  allowFunctions = false\r\n) {\r\n  try {\r\n    // Accept only objects and strings\r\n    if (!isObject(config) && typeof config !== 'string') {\r\n      // Return null if any other type\r\n      return null;\r\n    }\r\n\r\n    // Get the object representation of the original config\r\n    const objectConfig =\r\n      typeof config === 'string'\r\n        ? allowFunctions\r\n          ? eval(`(${config})`)\r\n          : JSON.parse(config)\r\n        : config;\r\n\r\n    // Preserve or remove potential functions based on the `allowFunctions` flag\r\n    const stringifiedOptions = _optionsStringify(\r\n      objectConfig,\r\n      allowFunctions,\r\n      false\r\n    );\r\n\r\n    // Parse the config to check if it is valid set of options\r\n    const parsedOptions = allowFunctions\r\n      ? JSON.parse(\r\n          _optionsStringify(objectConfig, allowFunctions, true),\r\n          (_, value) =>\r\n            typeof value === 'string' && value.startsWith('function')\r\n              ? eval(`(${value})`)\r\n              : value\r\n        )\r\n      : JSON.parse(stringifiedOptions);\r\n\r\n    // Return stringified or object options based on the `toString` flag\r\n    return toString ? stringifiedOptions : parsedOptions;\r\n  } catch (error) {\r\n    // Return null if parsing fails\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Prints the Highcharts Export Server logo, version, and license information.\r\n *\r\n * @function printLicense\r\n */\r\nexport function printLicense() {\r\n  // Print the logo and version information\r\n  printVersion();\r\n\r\n  // Print the license information\r\n  console.log(\r\n    'This software requires a valid Highcharts license for commercial use.\\n'\r\n      .yellow,\r\n    '\\nFor a full list of CLI options, type:',\r\n    '\\nhighcharts-export-server --help\\n'.green,\r\n    '\\nIf you do not have a license, one can be obtained here:',\r\n    '\\nhttps://shop.highsoft.com/\\n'.green,\r\n    '\\nTo customize your installation, please refer to the README file at:',\r\n    '\\nhttps://github.com/highcharts/node-export-server#readme\\n'.green\r\n  );\r\n}\r\n\r\n/**\r\n * Prints usage information for CLI arguments, displaying available options\r\n * and their descriptions. It can list properties recursively if categories\r\n * contain nested options.\r\n *\r\n * @function printUsage\r\n */\r\nexport function printUsage() {\r\n  // Display README and general usage information\r\n  console.log(\r\n    '\\nUsage of CLI arguments:'.bold,\r\n    '\\n-----------------------',\r\n    `\\nFor more detailed information, visit the README file at: ${'https://github.com/highcharts/node-export-server#readme'.green}.\\n`\r\n  );\r\n\r\n  // Iterate through each category in the `defaultConfig` and display usage info\r\n  Object.keys(defaultConfig).forEach((category) => {\r\n    console.log(`${category.toUpperCase()}`.bold.red);\r\n    _cycleCategories(defaultConfig[category]);\r\n    console.log('');\r\n  });\r\n}\r\n\r\n/**\r\n * Prints the Highcharts Export Server logo or text with the version\r\n * information.\r\n *\r\n * @function printVersion\r\n *\r\n * @param {boolean} [noLogo=false] - If true, only prints text with the version\r\n * information, without the logo. The default value is `false`.\r\n */\r\nexport function printVersion(noLogo = false) {\r\n  // Get package version either from `.env` or from `package.json`\r\n  const packageVersion = JSON.parse(\r\n    readFileSync(join(__dirname, 'package.json'), 'utf8')\r\n  ).version;\r\n\r\n  // Print text only\r\n  if (noLogo) {\r\n    console.log(`Highcharts Export Server v${packageVersion}`);\r\n  } else {\r\n    // Print the logo\r\n    console.log(\r\n      readFileSync(join(__dirname, 'msg', 'startup.msg'), 'utf8').toString()\r\n        .bold.yellow,\r\n      `v${packageVersion}\\n`.bold\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Initializes and returns global options object based on provided\r\n * configuration, setting values from nested properties recursively.\r\n *\r\n * @function _initGlobalOptions\r\n *\r\n * @param {Object} config - The configuration object to be used for initializing\r\n * options.\r\n *\r\n * @returns {Object} Initialized options object.\r\n */\r\nfunction _initGlobalOptions(config) {\r\n  const options = {};\r\n\r\n  // Start initializing the `options` object recursively\r\n  for (const [name, item] of Object.entries(config)) {\r\n    if (Object.prototype.hasOwnProperty.call(item, 'value')) {\r\n      // If a value from environment variables exists, it takes precedence\r\n      const envVal = envs[item.envLink];\r\n      if (envVal !== undefined && envVal !== null) {\r\n        options[name] = envVal;\r\n      } else {\r\n        options[name] = item.value;\r\n      }\r\n    } else {\r\n      options[name] = _initGlobalOptions(item);\r\n    }\r\n  }\r\n\r\n  // Return the created `options` object\r\n  return options;\r\n}\r\n\r\n/**\r\n * Updates global options object with values from various sources, following\r\n * a specific prioritization order. The function checks for values in the order\r\n * of precedence: the `loadConfig` configuration options, environment variables,\r\n * custom options, and CLI options.\r\n *\r\n * @function _updateGlobalOptions\r\n *\r\n * @param {Object} config - The configuration object, which includes the initial\r\n * settings and metadata for each option. This object is used to determine\r\n * the structure and default values for the options.\r\n * @param {Object} options - The global options object that will be updated\r\n * with values from other sources.\r\n * @param {Object} configOpt - The configuration options object, loaded with\r\n * the `loadConfig` option, which may provide values to override defaults.\r\n * @param {Object} cliOpt - The CLI options object, which may include values\r\n * provided through command-line arguments and may override configuration\r\n * options.\r\n * @param {Object} customOpt - The custom options object, typically containing\r\n * additional and user-defined values, which has the highest precedence among\r\n * options.\r\n */\r\nfunction _updateGlobalOptions(config, options, configOpt, cliOpt, customOpt) {\r\n  Object.keys(config).forEach((key) => {\r\n    // Get the config entry of a specific option\r\n    const entry = config[key];\r\n\r\n    // Gather values for the options from every possible source, if exists\r\n    const configVal = configOpt && configOpt[key];\r\n    const cliVal = cliOpt && cliOpt[key];\r\n    const customVal = customOpt && customOpt[key];\r\n\r\n    // If the value not found, need to go deeper\r\n    if (typeof entry.value === 'undefined') {\r\n      _updateGlobalOptions(entry, options[key], configVal, cliVal, customVal);\r\n    } else {\r\n      // If a value from custom JSON options exists, it takes precedence\r\n      if (configVal !== undefined && configVal !== null) {\r\n        options[key] = configVal;\r\n      }\r\n\r\n      // If a value from environment variables exists, it takes precedence\r\n      const envVal = envs[entry.envLink];\r\n      if (entry.envLink in envs && envVal !== undefined && envVal !== null) {\r\n        options[key] = envVal;\r\n      }\r\n\r\n      // If a value from CLI options exists, it takes precedence\r\n      if (cliVal !== undefined && cliVal !== null) {\r\n        options[key] = cliVal;\r\n      }\r\n\r\n      // If a value from user options exists, it takes precedence\r\n      if (customVal !== undefined && customVal !== null) {\r\n        options[key] = customVal;\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Converts the provided options object to a JSON-formatted string\r\n * with the option to preserve functions. In order for a function\r\n * to be preserved, it needs to follow the format `function (...) {...}`.\r\n * Such a function can also be stringified.\r\n *\r\n * @function _optionsStringify\r\n *\r\n * @param {Object} options - The options object to be converted to a string.\r\n * @param {boolean} allowFunctions - If set to true, functions are preserved\r\n * in the output. Otherwise an error is thrown.\r\n * @param {boolean} stringifyFunctions - If set to true, functions are saved\r\n * as strings. The `allowFunctions` must be set to true as well for this to take\r\n * an effect.\r\n *\r\n * @returns {string} The JSON-formatted string representing the options.\r\n *\r\n * @throws {Error} Throws an `Error` when functions are not allowed but are\r\n * found in provided options object.\r\n */\r\nexport function _optionsStringify(options, allowFunctions, stringifyFunctions) {\r\n  const replacerCallback = (_, value) => {\r\n    // Trim string values\r\n    if (typeof value === 'string') {\r\n      value = value.trim();\r\n    }\r\n\r\n    // If value is a function or stringified function\r\n    if (\r\n      typeof value === 'function' ||\r\n      (typeof value === 'string' &&\r\n        value.startsWith('function') &&\r\n        value.endsWith('}'))\r\n    ) {\r\n      // If allowFunctions is set to true, preserve functions\r\n      if (allowFunctions) {\r\n        // Based on the `stringifyFunctions` options, set function values\r\n        return stringifyFunctions\r\n          ? // As stringified functions\r\n            `\"EXP_FUN${(value + '').replaceAll(/\\s+/g, ' ')}EXP_FUN\"`\r\n          : // As functions\r\n            `EXP_FUN${(value + '').replaceAll(/\\s+/g, ' ')}EXP_FUN`;\r\n      } else {\r\n        // Throw an error otherwise\r\n        throw new Error();\r\n      }\r\n    }\r\n\r\n    // In all other cases, simply return the value\r\n    return value;\r\n  };\r\n\r\n  // Stringify options and if required, replace special functions marks\r\n  return JSON.stringify(options, replacerCallback).replaceAll(\r\n    stringifyFunctions ? /\\\\\"EXP_FUN|EXP_FUN\\\\\"/g : /\"EXP_FUN|EXP_FUN\"/g,\r\n    ''\r\n  );\r\n}\r\n\r\n/**\r\n * Loads additional configuration from a specified file provided via\r\n * the `loadConfig` option in the command-line arguments.\r\n *\r\n * @function _loadConfigFile\r\n *\r\n * @param {Array.<string>} cliArgs - Command-line arguments to search\r\n * for the `loadConfig` option and the corresponding file path.\r\n * @param {Object} customLogicOptions - The configuration object containing\r\n * `customLogic` options.\r\n *\r\n * @returns {Object} The additional configuration loaded from the specified\r\n * file, or an empty object if the file is not found, invalid, or an error\r\n * occurs.\r\n */\r\nfunction _loadConfigFile(cliArgs, customLogicOptions) {\r\n  // Check if the `loadConfig` option was used\r\n  const configIndex = cliArgs.findIndex(\r\n    (arg) => arg.replace(/-/g, '') === 'loadConfig'\r\n  );\r\n\r\n  // Get the `loadConfig` option value\r\n  const configFileName = configIndex > -1 && cliArgs[configIndex + 1];\r\n\r\n  // Check if the `loadConfig` is present and has a correct value\r\n  if (configFileName && customLogicOptions.allowFileResources) {\r\n    try {\r\n      // Load an optional custom JSON config file\r\n      return isAllowedConfig(\r\n        readFileSync(getAbsolutePath(configFileName), 'utf8'),\r\n        false,\r\n        customLogicOptions.allowCodeExecution\r\n      );\r\n    } catch (error) {\r\n      logWithStack(\r\n        2,\r\n        error,\r\n        `[config] Unable to load the configuration from the ${configFileName} file.`\r\n      );\r\n    }\r\n  }\r\n\r\n  // No additional options to return\r\n  return {};\r\n}\r\n\r\n/**\r\n * Parses command-line arguments and pairs each argument with its corresponding\r\n * option in the configuration. The values are structured into a nested options\r\n * object, based on predefined mappings.\r\n *\r\n * @function _pairArgumentValue\r\n *\r\n * @param {Array.<string>} nestedProps - An array of nesting level for all\r\n * options.\r\n * @param {Array.<string>} cliArgs - An array of command-line arguments\r\n * containing options and their associated values.\r\n *\r\n * @returns {Object} An updated options object where each option from\r\n * the command-line is paired with its value, structured into nested objects\r\n * as defined.\r\n */\r\nfunction _pairArgumentValue(nestedProps, cliArgs) {\r\n  // An empty object to collect and structurize data from the args\r\n  const cliOptions = {};\r\n\r\n  // Cycle through all CLI args and filter them\r\n  for (let i = 0; i < cliArgs.length; i++) {\r\n    const option = cliArgs[i].replace(/-/g, '');\r\n\r\n    // Find the right place for property's value\r\n    const propertiesChain = nestedProps[option]\r\n      ? nestedProps[option].split('.')\r\n      : [];\r\n\r\n    // Create options object with values from CLI for later parsing and merging\r\n    propertiesChain.reduce((obj, prop, index) => {\r\n      if (propertiesChain.length - 1 === index) {\r\n        const value = cliArgs[++i];\r\n        if (!value) {\r\n          log(\r\n            2,\r\n            `[config] Missing value for the CLI '--${option}' argument. Using the default value.`\r\n          );\r\n        }\r\n        obj[prop] = value || null;\r\n      } else if (obj[prop] === undefined) {\r\n        obj[prop] = {};\r\n      }\r\n      return obj[prop];\r\n    }, cliOptions);\r\n  }\r\n\r\n  // Return parsed CLI options\r\n  return cliOptions;\r\n}\r\n\r\n/**\r\n * Recursively traverses the options object to print the usage information\r\n * for each option category and individual option.\r\n *\r\n * @function _cycleCategories\r\n *\r\n * @param {Object} options - The options object containing CLI options. It may\r\n * include nested categories and individual options.\r\n */\r\nfunction _cycleCategories(options) {\r\n  for (const [name, option] of Object.entries(options)) {\r\n    // If the current entry is a category and not a leaf option, recurse into it\r\n    if (!Object.prototype.hasOwnProperty.call(option, 'value')) {\r\n      _cycleCategories(option);\r\n    } else {\r\n      // Prepare description\r\n      const descName = ` --${option.cliName || name}`;\r\n\r\n      // Get the value\r\n      let optionValue = option.value;\r\n\r\n      // Prepare value for option that is not null and is array of strings\r\n      if (optionValue !== null && option.types.includes('string[]')) {\r\n        optionValue =\r\n          '[' + optionValue.map((item) => `'${item}'`).join(', ') + ']';\r\n      }\r\n\r\n      // Prepare value for option that is not null and is a string\r\n      if (optionValue !== null && option.types.includes('string')) {\r\n        optionValue = `'${optionValue}'`;\r\n      }\r\n\r\n      // Display correctly aligned messages\r\n      console.log(\r\n        descName.green,\r\n        `${('<' + option.types.join('|') + '>').yellow}`,\r\n        `${String(optionValue).bold}`.blue,\r\n        `- ${option.description}.`\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default {\r\n  getOptions,\r\n  setGlobalOptions,\r\n  updateOptions,\r\n  mergeOptions,\r\n  mapToNewOptions,\r\n  isAllowedConfig,\r\n  printLicense,\r\n  printUsage,\r\n  printVersion\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview HTTP utility module for fetching and posting data. Supports both\r\n * HTTP and HTTPS protocols, providing methods to make GET and POST requests\r\n * with customizable options. Includes protocol determination based on URL\r\n * and augments response objects with a 'text' property for easier data access.\r\n */\r\n\r\nimport http from 'http';\r\nimport https from 'https';\r\n\r\n/**\r\n * Fetches data from the specified URL using either HTTP or HTTPS protocol.\r\n *\r\n * @async\r\n * @function fetch\r\n *\r\n * @param {string} url - The URL to fetch data from.\r\n * @param {Object} [requestOptions={}] - Options for the HTTP/HTTPS request.\r\n * The default value is an empty object.\r\n *\r\n * @returns {Promise<Object>} A Promise that resolves to the HTTP/HTTPS response\r\n * object with added 'text' property or rejecting with an error.\r\n */\r\nexport async function fetch(url, requestOptions = {}) {\r\n  return new Promise((resolve, reject) => {\r\n    _getProtocolModule(url)\r\n      .get(url, requestOptions, (response) => {\r\n        let responseData = '';\r\n\r\n        // A chunk of data has been received\r\n        response.on('data', (chunk) => {\r\n          responseData += chunk;\r\n        });\r\n\r\n        // The whole response has been received\r\n        response.on('end', () => {\r\n          if (!responseData) {\r\n            reject('Nothing was fetched from the URL.');\r\n          }\r\n          response.text = responseData;\r\n          resolve(response);\r\n        });\r\n      })\r\n      .on('error', (error) => {\r\n        reject(error);\r\n      });\r\n  });\r\n}\r\n\r\n/**\r\n * Sends a POST request to the specified URL with the provided JSON body using\r\n * either HTTP or HTTPS protocol.\r\n *\r\n * @async\r\n * @function post\r\n *\r\n * @param {string} url - The URL to send the POST request to.\r\n * @param {Object} [body={}] - The JSON body to include in the POST request.\r\n * The default value is an empty object.\r\n * @param {Object} [requestOptions={}] - Options for the HTTP/HTTPS request.\r\n * The default value is an empty object.\r\n *\r\n * @returns {Promise<Object>} A Promise that resolves to the HTTP/HTTPS response\r\n * object with added 'text' property or rejecting with an error.\r\n */\r\nexport async function post(url, body = {}, requestOptions = {}) {\r\n  return new Promise((resolve, reject) => {\r\n    const data = JSON.stringify(body);\r\n\r\n    // Set default headers and merge with requestOptions\r\n    const options = Object.assign(\r\n      {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Content-Length': data.length\r\n        }\r\n      },\r\n      requestOptions\r\n    );\r\n\r\n    const request = _getProtocolModule(url)\r\n      .request(url, options, (response) => {\r\n        let responseData = '';\r\n\r\n        // A chunk of data has been received\r\n        response.on('data', (chunk) => {\r\n          responseData += chunk;\r\n        });\r\n\r\n        // The whole response has been received\r\n        response.on('end', () => {\r\n          try {\r\n            response.text = responseData;\r\n            resolve(response);\r\n          } catch (error) {\r\n            reject(error);\r\n          }\r\n        });\r\n      })\r\n      .on('error', (error) => {\r\n        reject(error);\r\n      });\r\n\r\n    // Write the request body and end the request\r\n    request.write(data);\r\n    request.end();\r\n  });\r\n}\r\n\r\n/**\r\n * Returns the HTTP or HTTPS protocol module based on the provided URL.\r\n *\r\n * @function _getProtocolModule\r\n *\r\n * @param {string} url - The URL to determine the protocol.\r\n *\r\n * @returns {Object} The HTTP or HTTPS protocol module (http or https).\r\n */\r\nfunction _getProtocolModule(url) {\r\n  return url.startsWith('https') ? https : http;\r\n}\r\n\r\nexport default {\r\n  fetch,\r\n  post\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * A custom error class for handling export-related errors. Extends the native\r\n * `Error` class to include additional properties like status code and stack\r\n * trace details.\r\n */\r\nclass ExportError extends Error {\r\n  /**\r\n   * Creates an instance of the `ExportError`.\r\n   *\r\n   * @param {string} message - The error message to be displayed.\r\n   * @param {number} statusCode - Optional HTTP status code associated\r\n   * with the error (e.g., 400, 500).\r\n   */\r\n  constructor(message, statusCode) {\r\n    super();\r\n\r\n    this.message = message;\r\n    this.stackMessage = message;\r\n\r\n    if (statusCode) {\r\n      this.statusCode = statusCode;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Sets or updates the HTTP status code for the error.\r\n   *\r\n   * @param {number} statusCode - The HTTP status code to assign to the error.\r\n   *\r\n   * @returns {ExportError} The updated instance of the `ExportError` class.\r\n   */\r\n  setStatus(statusCode) {\r\n    this.statusCode = statusCode;\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Sets additional error details based on an existing error object.\r\n   *\r\n   * @param {Error} error - An error object containing details to populate\r\n   * the `ExportError` instance.\r\n   *\r\n   * @returns {ExportError} The updated instance of the `ExportError` class.\r\n   */\r\n  setError(error) {\r\n    this.error = error;\r\n\r\n    if (error.name) {\r\n      this.name = error.name;\r\n    }\r\n\r\n    if (error.statusCode) {\r\n      this.statusCode = error.statusCode;\r\n    }\r\n\r\n    if (error.stack) {\r\n      this.stackMessage = error.message;\r\n      this.stack = error.stack;\r\n    }\r\n\r\n    return this;\r\n  }\r\n}\r\n\r\nexport default ExportError;\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview The cache manager is responsible for handling and managing\r\n * the Highcharts library along with its dependencies. It ensures that these\r\n * resources are stored and retrieved efficiently to optimize performance\r\n * and reduce redundant network requests. The cache is stored in the `.cache`\r\n * directory by default, which serves as a dedicated folder for keeping cached\r\n * files.\r\n */\r\n\r\nimport { existsSync, mkdirSync, readFileSync, writeFileSync } from 'fs';\r\nimport { join } from 'path';\r\n\r\nimport { HttpsProxyAgent } from 'https-proxy-agent';\r\n\r\nimport { getOptions } from './config.js';\r\nimport { fetch } from './fetch.js';\r\nimport { log } from './logger.js';\r\nimport { __dirname, getAbsolutePath } from './utils.js';\r\n\r\nimport ExportError from './errors/ExportError.js';\r\n\r\n// The initial cache template\r\nconst cache = {\r\n  cdnUrl: 'https://code.highcharts.com',\r\n  activeManifest: {},\r\n  sources: '',\r\n  hcVersion: ''\r\n};\r\n\r\n/**\r\n * Checks the cache for Highcharts dependencies, updates the cache if needed,\r\n * and loads the sources.\r\n *\r\n * @async\r\n * @function checkAndUpdateCache\r\n *\r\n * @param {Object} highchartsOptions - The configuration object containing\r\n * `highcharts` options.\r\n * @param {Object} serverProxyOptions- The configuration object containing\r\n * `server.proxy` options.\r\n */\r\nexport async function checkAndUpdateCache(\r\n  highchartsOptions,\r\n  serverProxyOptions\r\n) {\r\n  try {\r\n    let fetchedModules;\r\n\r\n    // Get the cache path\r\n    const cachePath = getCachePath();\r\n\r\n    // Prepare paths to manifest and sources from the cache folder\r\n    const manifestPath = join(cachePath, 'manifest.json');\r\n    const sourcePath = join(cachePath, 'sources.js');\r\n\r\n    // Create the cache destination if it doesn't exist already\r\n    !existsSync(cachePath) && mkdirSync(cachePath, { recursive: true });\r\n\r\n    // Fetch all the scripts either if the `manifest.json` does not exist\r\n    // or if the `forceFetch` option is enabled\r\n    if (!existsSync(manifestPath) || highchartsOptions.forceFetch) {\r\n      log(3, '[cache] Fetching and caching Highcharts dependencies.');\r\n      fetchedModules = await _updateCache(\r\n        highchartsOptions,\r\n        serverProxyOptions,\r\n        sourcePath\r\n      );\r\n    } else {\r\n      let requestUpdate = false;\r\n\r\n      // Read the manifest JSON\r\n      const manifest = JSON.parse(readFileSync(manifestPath), 'utf8');\r\n\r\n      // Check if the modules is an array, if so, we rewrite it to a map to make\r\n      // it easier to resolve modules.\r\n      if (manifest.modules && Array.isArray(manifest.modules)) {\r\n        const moduleMap = {};\r\n        manifest.modules.forEach((m) => (moduleMap[m] = 1));\r\n        manifest.modules = moduleMap;\r\n      }\r\n\r\n      // Get the actual number of scripts to be fetched\r\n      const { coreScripts, moduleScripts, indicatorScripts } =\r\n        highchartsOptions;\r\n      const numberOfModules =\r\n        coreScripts.length + moduleScripts.length + indicatorScripts.length;\r\n\r\n      // Compare the loaded highcharts config with the contents in cache.\r\n      // If there are changes, fetch requested modules and products,\r\n      // and bake them into a giant blob. Save the blob.\r\n      if (manifest.version !== highchartsOptions.version) {\r\n        log(\r\n          2,\r\n          '[cache] A Highcharts version mismatch in the cache, need to re-fetch.'\r\n        );\r\n        requestUpdate = true;\r\n      } else if (\r\n        Object.keys(manifest.modules || {}).length !== numberOfModules\r\n      ) {\r\n        log(\r\n          2,\r\n          '[cache] The cache and the requested modules do not match, need to re-fetch.'\r\n        );\r\n        requestUpdate = true;\r\n      } else {\r\n        // Check each module, if anything is missing refetch everything\r\n        requestUpdate = (moduleScripts || []).some((moduleName) => {\r\n          if (!manifest.modules[moduleName]) {\r\n            log(\r\n              2,\r\n              `[cache] The ${moduleName} is missing in the cache, need to re-fetch.`\r\n            );\r\n            return true;\r\n          }\r\n        });\r\n      }\r\n\r\n      // Update cache if needed\r\n      if (requestUpdate) {\r\n        fetchedModules = await _updateCache(\r\n          highchartsOptions,\r\n          serverProxyOptions,\r\n          sourcePath\r\n        );\r\n      } else {\r\n        log(3, '[cache] Dependency cache is up to date, proceeding.');\r\n\r\n        // Load the sources\r\n        cache.sources = readFileSync(sourcePath, 'utf8');\r\n\r\n        // Get current modules map\r\n        fetchedModules = manifest.modules;\r\n\r\n        // Extract and save version of currently used Highcharts\r\n        cache.hcVersion = extractVersion(cache.sources);\r\n      }\r\n    }\r\n\r\n    // Finally, save the new manifest, which is basically our current config\r\n    // in a slightly different format\r\n    await _saveConfigToManifest(highchartsOptions, fetchedModules);\r\n  } catch (error) {\r\n    throw new ExportError(\r\n      '[cache] Could not configure cache and create or update the config manifest.',\r\n      500\r\n    ).setError(error);\r\n  }\r\n}\r\n\r\n/**\r\n * Gets the version of Highcharts from the cache.\r\n *\r\n * @function getHighchartsVersion\r\n *\r\n * @returns {string} The cached Highcharts version.\r\n */\r\nexport function getHighchartsVersion() {\r\n  return cache.hcVersion;\r\n}\r\n\r\n/**\r\n * Updates the Highcharts version in the applied configuration and checks\r\n * the cache for the new version.\r\n *\r\n * @async\r\n * @function updateHighchartsVersion\r\n *\r\n * @param {string} newVersion - The new Highcharts version to be applied.\r\n */\r\nexport async function updateHighchartsVersion(newVersion) {\r\n  // Get the reference to the global options to update to the new version\r\n  const options = getOptions();\r\n\r\n  // Set to the new version\r\n  options.highcharts.version = newVersion;\r\n\r\n  // Check if cache needs to be updated\r\n  await checkAndUpdateCache(options.highcharts, options.server.proxy);\r\n}\r\n\r\n/**\r\n * Extracts Highcharts version from the cache's sources string.\r\n *\r\n * @function extractVersion\r\n *\r\n * @param {Object} cacheSources - The cache sources object.\r\n *\r\n * @returns {string} The extracted Highcharts version.\r\n */\r\nexport function extractVersion(cacheSources) {\r\n  return cacheSources\r\n    .substring(0, cacheSources.indexOf('*/'))\r\n    .replace('/*', '')\r\n    .replace('*/', '')\r\n    .replace(/\\n/g, '')\r\n    .trim();\r\n}\r\n\r\n/**\r\n * Extracts the Highcharts module name based on the scriptPath.\r\n *\r\n * @function extractModuleName\r\n *\r\n * @param {string} scriptPath - The path of the script from which the module\r\n * name will be extracted.\r\n *\r\n * @returns {string} The extracted module name.\r\n */\r\nexport function extractModuleName(scriptPath) {\r\n  return scriptPath.replace(\r\n    /(.*)\\/|(.*)modules\\/|stock\\/(.*)indicators\\/|maps\\/(.*)modules\\//gi,\r\n    ''\r\n  );\r\n}\r\n\r\n/**\r\n * Retrieves the current cache object.\r\n *\r\n * @function getCache\r\n *\r\n * @returns {Object} The cache object containing various cached data.\r\n */\r\nexport function getCache() {\r\n  return cache;\r\n}\r\n\r\n/**\r\n * Gets the cache path for Highcharts.\r\n *\r\n * @function getCachePath\r\n *\r\n * @returns {string} The absolute path to the cache directory for Highcharts.\r\n */\r\nexport function getCachePath() {\r\n  return getAbsolutePath(getOptions().highcharts.cachePath, 'utf8'); // #562\r\n}\r\n\r\n/**\r\n * Fetches a single script and updates the `fetchedModules` accordingly.\r\n *\r\n * @async\r\n * @function _fetchAndProcessScript\r\n *\r\n * @param {string} script - A path to script to get.\r\n * @param {Object} requestOptions - Additional options for the proxy agent\r\n * to use for a request.\r\n * @param {Object} fetchedModules - An object which tracks which Highcharts\r\n * modules have been fetched.\r\n * @param {boolean} [shouldThrowError=false] - A flag to indicate if the error\r\n * should be thrown. This should be used only for the core scripts. The default\r\n * value is `false`.\r\n *\r\n * @returns {Promise<string>} A Promise that resolves to the text representation\r\n * of the fetched script.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if there is a problem\r\n * with fetching the script.\r\n */\r\nasync function _fetchAndProcessScript(\r\n  script,\r\n  requestOptions,\r\n  fetchedModules,\r\n  shouldThrowError = false\r\n) {\r\n  // Get rid of the .js from the custom strings\r\n  if (script.endsWith('.js')) {\r\n    script = script.substring(0, script.length - 3);\r\n  }\r\n  log(4, `[cache] Fetching script - ${script}.js`);\r\n\r\n  // Fetch the script\r\n  const response = await fetch(`${script}.js`, requestOptions);\r\n\r\n  // If OK, return its text representation\r\n  if (response.statusCode === 200 && typeof response.text == 'string') {\r\n    if (fetchedModules) {\r\n      const moduleName = extractModuleName(script);\r\n      fetchedModules[moduleName] = 1;\r\n    }\r\n    return response.text;\r\n  }\r\n\r\n  // Based on the `shouldThrowError` flag, decide how to serve error message\r\n  if (shouldThrowError) {\r\n    throw new ExportError(\r\n      `[cache] Could not fetch the ${script}.js. The script might not exist in the requested version (status code: ${response.statusCode}).`,\r\n      404\r\n    ).setError(response);\r\n  } else {\r\n    log(\r\n      2,\r\n      `[cache] Could not fetch the ${script}.js. The script might not exist in the requested version.`\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Saves the provided configuration and fetched modules to the cache manifest\r\n * file.\r\n *\r\n * @async\r\n * @function _saveConfigToManifest\r\n *\r\n * @param {Object} highchartsOptions - The configuration object containing\r\n * `highcharts` options.\r\n * @param {Object} [fetchedModules={}] - An object which tracks which Highcharts\r\n * modules have been fetched. The default value is an empty object.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if an error occurs while\r\n * writing the cache manifest.\r\n */\r\nasync function _saveConfigToManifest(highchartsOptions, fetchedModules = {}) {\r\n  const newManifest = {\r\n    version: highchartsOptions.version,\r\n    modules: fetchedModules\r\n  };\r\n\r\n  // Update cache object with the current modules\r\n  cache.activeManifest = newManifest;\r\n\r\n  log(3, '[cache] Writing a new manifest.');\r\n  try {\r\n    writeFileSync(\r\n      join(getCachePath(), 'manifest.json'),\r\n      JSON.stringify(newManifest),\r\n      'utf8'\r\n    );\r\n  } catch (error) {\r\n    throw new ExportError(\r\n      '[cache] Error writing the cache manifest.',\r\n      500\r\n    ).setError(error);\r\n  }\r\n}\r\n\r\n/**\r\n * Fetches Highcharts `scripts` and `customScripts` from the given CDNs.\r\n *\r\n * @async\r\n * @function _fetchScripts\r\n *\r\n * @param {Array.<string>} coreScripts - Highcharts core scripts to fetch.\r\n * @param {Array.<string>} moduleScripts - Highcharts modules to fetch.\r\n * @param {Array.<string>} customScripts - Custom script paths to fetch (full\r\n * URLs).\r\n * @param {Object} serverProxyOptions - The configuration object containing\r\n * `server.proxy` options.\r\n * @param {Object} fetchedModules - An object which tracks which Highcharts\r\n * modules have been fetched.\r\n *\r\n * @returns {Promise<string>} A Promise that resolves to the fetched scripts\r\n * content joined.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if an error occurs while\r\n * setting an HTTP Agent for proxy.\r\n */\r\nasync function _fetchScripts(\r\n  coreScripts,\r\n  moduleScripts,\r\n  customScripts,\r\n  serverProxyOptions,\r\n  fetchedModules\r\n) {\r\n  // Configure proxy if exists\r\n  let proxyAgent;\r\n  const proxyHost = serverProxyOptions.host;\r\n  const proxyPort = serverProxyOptions.port;\r\n\r\n  // Try to create a Proxy Agent\r\n  if (proxyHost && proxyPort) {\r\n    try {\r\n      proxyAgent = new HttpsProxyAgent({\r\n        host: proxyHost,\r\n        port: proxyPort\r\n      });\r\n    } catch (error) {\r\n      throw new ExportError(\r\n        '[cache] Could not create a Proxy Agent.',\r\n        500\r\n      ).setError(error);\r\n    }\r\n  }\r\n\r\n  // If exists, add proxy agent to request options\r\n  const requestOptions = proxyAgent\r\n    ? {\r\n        agent: proxyAgent,\r\n        timeout: serverProxyOptions.timeout\r\n      }\r\n    : {};\r\n\r\n  const allFetchPromises = [\r\n    ...coreScripts.map((script) =>\r\n      _fetchAndProcessScript(`${script}`, requestOptions, fetchedModules, true)\r\n    ),\r\n    ...moduleScripts.map((script) =>\r\n      _fetchAndProcessScript(`${script}`, requestOptions, fetchedModules)\r\n    ),\r\n    ...customScripts.map((script) =>\r\n      _fetchAndProcessScript(`${script}`, requestOptions)\r\n    )\r\n  ];\r\n\r\n  const fetchedScripts = await Promise.all(allFetchPromises);\r\n  return fetchedScripts.join(';\\n');\r\n}\r\n\r\n/**\r\n * Updates the local cache with Highcharts scripts and their versions.\r\n *\r\n * @async\r\n * @function _updateCache\r\n *\r\n * @param {Object} highchartsOptions - The configuration object containing\r\n * `highcharts` options.\r\n * @param {Object} serverProxyOptions - The configuration object containing\r\n * `server.proxy` options.\r\n * @param {string} sourcePath - The path to the source file in the cache.\r\n *\r\n * @returns {Promise<Object>} A Promise that resolves to an object representing\r\n * the fetched modules.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if there is an issue updating\r\n * the local Highcharts cache.\r\n */\r\nasync function _updateCache(highchartsOptions, serverProxyOptions, sourcePath) {\r\n  // Get Highcharts version for scripts\r\n  const hcVersion =\r\n    highchartsOptions.version === 'latest'\r\n      ? null\r\n      : `${highchartsOptions.version}`;\r\n\r\n  // Get the CDN url for scripts\r\n  const cdnUrl = highchartsOptions.cdnUrl || cache.cdnUrl;\r\n\r\n  try {\r\n    const fetchedModules = {};\r\n\r\n    log(\r\n      3,\r\n      `[cache] Updating cache version to Highcharts: ${hcVersion || 'latest'}.`\r\n    );\r\n\r\n    cache.sources = await _fetchScripts(\r\n      [\r\n        ...highchartsOptions.coreScripts.map((c) =>\r\n          hcVersion ? `${cdnUrl}/${hcVersion}/${c}` : `${cdnUrl}/${c}`\r\n        )\r\n      ],\r\n      [\r\n        ...highchartsOptions.moduleScripts.map((m) =>\r\n          m === 'map'\r\n            ? hcVersion\r\n              ? `${cdnUrl}/maps/${hcVersion}/modules/${m}`\r\n              : `${cdnUrl}/maps/modules/${m}`\r\n            : hcVersion\r\n              ? `${cdnUrl}/${hcVersion}/modules/${m}`\r\n              : `${cdnUrl}/modules/${m}`\r\n        ),\r\n        ...highchartsOptions.indicatorScripts.map((i) =>\r\n          hcVersion\r\n            ? `${cdnUrl}/stock/${hcVersion}/indicators/${i}`\r\n            : `${cdnUrl}/stock/indicators/${i}`\r\n        )\r\n      ],\r\n      highchartsOptions.customScripts,\r\n      serverProxyOptions,\r\n      fetchedModules\r\n    );\r\n\r\n    // Extract and save version of currently used Highcharts\r\n    cache.hcVersion = extractVersion(cache.sources);\r\n\r\n    // Save the fetched modules into caches' source JSON\r\n    writeFileSync(sourcePath, cache.sources);\r\n    return fetchedModules;\r\n  } catch (error) {\r\n    throw new ExportError(\r\n      '[cache] Unable to update the local Highcharts cache.',\r\n      500\r\n    ).setError(error);\r\n  }\r\n}\r\n\r\nexport default {\r\n  checkAndUpdateCache,\r\n  getHighchartsVersion,\r\n  updateHighchartsVersion,\r\n  extractVersion,\r\n  extractModuleName,\r\n  getCache,\r\n  getCachePath\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Provides methods for initializing Highcharts with customized\r\n * animation settings and triggering the creation of Highcharts charts with\r\n * export-specific configurations in the page context. Supports dynamic option\r\n * merging, custom logic injection, and control over rendering behaviors. Used\r\n * by the Puppeteer page.\r\n */\r\n\r\n/* eslint-disable no-undef */\r\n\r\n/**\r\n * Setting the `Highcharts.animObject` function. Called when initing the page.\r\n *\r\n * @function setupHighcharts\r\n */\r\nexport function setupHighcharts() {\r\n  Highcharts.animObject = function () {\r\n    return { duration: 0 };\r\n  };\r\n}\r\n\r\n/**\r\n * Creates the actual Highcharts chart on a page.\r\n *\r\n * @async\r\n * @function createChart\r\n *\r\n * @param {Object} exportOptions - The configuration object containing `export`\r\n * options.\r\n * @param {Object} customLogicOptions - The configuration object containing\r\n * `customLogic` options.\r\n *\r\n */\r\nexport async function createChart(exportOptions, customLogicOptions) {\r\n  // Get required functions\r\n  const { getOptions, setOptions, merge, wrap } = Highcharts;\r\n\r\n  // Create a separate object for a potential `setOptions` usages in order\r\n  // to prevent from polluting other exports that can happen on the same page\r\n  Highcharts.setOptionsObj = merge(false, {}, getOptions());\r\n\r\n  // NOTE: Is this used for anything useful?\r\n  window.isRenderComplete = false;\r\n  wrap(Highcharts.Chart.prototype, 'init', function (proceed, userOptions, cb) {\r\n    // Override the `userOptions` with image friendly options\r\n    userOptions = merge(userOptions, {\r\n      exporting: {\r\n        enabled: false\r\n      },\r\n      plotOptions: {\r\n        series: {\r\n          label: {\r\n            enabled: false\r\n          }\r\n        }\r\n      },\r\n      /* Expects tooltip in the `userOptions` when `forExport` is true.\r\n        https://github.com/highcharts/highcharts/blob/3ad430a353b8056b9e764aa4e5cd6828aa479db2/js/parts/Chart.js#L241\r\n        */\r\n      tooltip: {}\r\n    });\r\n\r\n    (userOptions.series || []).forEach(function (series) {\r\n      series.animation = false;\r\n    });\r\n\r\n    // Add flag to know if chart render has been called.\r\n    if (!window.onHighchartsRender) {\r\n      window.onHighchartsRender = Highcharts.addEvent(this, 'render', () => {\r\n        window.isRenderComplete = true;\r\n      });\r\n    }\r\n\r\n    proceed.apply(this, [userOptions, cb]);\r\n  });\r\n\r\n  wrap(Highcharts.Series.prototype, 'init', function (proceed, chart, options) {\r\n    proceed.apply(this, [chart, options]);\r\n  });\r\n\r\n  // Some mandatory additional `chart` and `exporting` options\r\n  const additionalOptions = {\r\n    chart: {\r\n      // By default animation is disabled\r\n      animation: false,\r\n      // Get the right size values\r\n      height: exportOptions.height,\r\n      width: exportOptions.width\r\n    },\r\n    exporting: {\r\n      // No need for the exporting button\r\n      enabled: false\r\n    }\r\n  };\r\n\r\n  // Get the input to export from the `instr` option\r\n  const userOptions = new Function(`return ${exportOptions.instr}`)();\r\n\r\n  // Get the `themeOptions` option\r\n  const themeOptions = new Function(`return ${exportOptions.themeOptions}`)();\r\n\r\n  // Get the `globalOptions` option\r\n  const globalOptions = new Function(`return ${exportOptions.globalOptions}`)();\r\n\r\n  // Merge the following options objects to create final options\r\n  const finalOptions = merge(\r\n    false,\r\n    themeOptions,\r\n    userOptions,\r\n    // Placed it here instead in the init because of the size issues\r\n    additionalOptions\r\n  );\r\n\r\n  // Prepare the `callback` option\r\n  const finalCallback = customLogicOptions.callback\r\n    ? new Function(`return ${customLogicOptions.callback}`)()\r\n    : null;\r\n\r\n  // Trigger the `customCode` option\r\n  if (customLogicOptions.customCode) {\r\n    new Function('options', customLogicOptions.customCode)(userOptions);\r\n  }\r\n\r\n  // Set the global options if exist\r\n  if (globalOptions) {\r\n    setOptions(globalOptions);\r\n  }\r\n\r\n  // Call the chart creation\r\n  Highcharts[exportOptions.constr]('container', finalOptions, finalCallback);\r\n\r\n  // Get the current global options\r\n  const defaultOptions = getOptions();\r\n\r\n  // Clear it just in case (e.g. the `setOptions` was used in the `customCode`)\r\n  for (const prop in defaultOptions) {\r\n    if (typeof defaultOptions[prop] !== 'function') {\r\n      delete defaultOptions[prop];\r\n    }\r\n  }\r\n\r\n  // Set the default options back\r\n  setOptions(Highcharts.setOptionsObj);\r\n\r\n  // Empty the custom global options object\r\n  Highcharts.setOptionsObj = {};\r\n}\r\n\r\nexport default {\r\n  setupHighcharts,\r\n  createChart\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview This module provides functions for managing Puppeteer browser\r\n * instance, creating and clearing pages, injecting custom resources,\r\n * and setting up Highcharts for server-side rendering. The module ensures\r\n * that resources are correctly managed and can handle failures during\r\n * operations like launching the browser or creating new pages.\r\n */\r\n\r\nimport { readFileSync } from 'fs';\r\nimport { join } from 'path';\r\n\r\nimport puppeteer from 'puppeteer';\r\n\r\nimport { getCachePath } from './cache.js';\r\nimport { getOptions } from './config.js';\r\nimport { setupHighcharts } from './highcharts.js';\r\nimport { log, logWithStack } from './logger.js';\r\nimport { __dirname, getAbsolutePath } from './utils.js';\r\n\r\nimport ExportError from './errors/ExportError.js';\r\n\r\n// Get the template for pages\r\nconst template = readFileSync(\r\n  join(__dirname, 'templates', 'template.html'),\r\n  'utf8'\r\n);\r\n\r\n// To save the browser\r\nlet browser = null;\r\n\r\n/**\r\n * Retrieves the existing Puppeteer browser instance.\r\n *\r\n * @function getBrowser\r\n *\r\n * @returns {Object} The Puppeteer browser instance.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if no valid browser\r\n * has been created.\r\n */\r\nexport function getBrowser() {\r\n  if (!browser) {\r\n    throw new ExportError('[browser] No valid browser has been created.', 500);\r\n  }\r\n  return browser;\r\n}\r\n\r\n/**\r\n * Creates a Puppeteer browser instance with the specified arguments.\r\n *\r\n * @async\r\n * @function createBrowser\r\n *\r\n * @param {Array.<string>} puppeteerArgs - Additional arguments for Puppeteer\r\n * launch.\r\n *\r\n * @returns {Promise<Object>} A Promise that resolves to the created Puppeteer\r\n * browser instance.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if max retries to open\r\n * a browser instance are reached, or if no browser instance is found after\r\n * retries.\r\n */\r\nexport async function createBrowser(puppeteerArgs) {\r\n  // Get `debug` and `other` options\r\n  const { debug, other } = getOptions();\r\n\r\n  // Get the `debug` options\r\n  const { enable: enabledDebug, ...debugOptions } = debug;\r\n\r\n  // Launch options for the browser instance\r\n  const launchOptions = {\r\n    headless: other.browserShellMode ? 'shell' : true,\r\n    userDataDir: 'tmp',\r\n    args: puppeteerArgs || [],\r\n    handleSIGINT: false,\r\n    handleSIGTERM: false,\r\n    handleSIGHUP: false,\r\n    waitForInitialPage: false,\r\n    defaultViewport: null,\r\n    ...(enabledDebug && debugOptions)\r\n  };\r\n\r\n  // Create a browser\r\n  if (!browser) {\r\n    // A counter for the browser's launch retries\r\n    let tryCount = 0;\r\n\r\n    const open = async () => {\r\n      try {\r\n        log(\r\n          3,\r\n          `[browser] Attempting to get a browser instance (try ${++tryCount}).`\r\n        );\r\n\r\n        // Launch the browser\r\n        browser = await puppeteer.launch(launchOptions);\r\n      } catch (error) {\r\n        logWithStack(\r\n          1,\r\n          error,\r\n          '[browser] Failed to launch a browser instance.'\r\n        );\r\n\r\n        // Retry to launch browser until reaching max attempts\r\n        if (tryCount < 25) {\r\n          log(3, `[browser] Retry to open a browser (${tryCount} out of 25).`);\r\n\r\n          // Wait for a 4 seconds before trying again\r\n          await new Promise((response) => setTimeout(response, 4000));\r\n          await open();\r\n        } else {\r\n          throw error;\r\n        }\r\n      }\r\n    };\r\n\r\n    try {\r\n      await open();\r\n\r\n      // Shell mode inform\r\n      if (launchOptions.headless === 'shell') {\r\n        log(3, `[browser] Launched browser in shell mode.`);\r\n      }\r\n\r\n      // Debug mode inform\r\n      if (enabledDebug) {\r\n        log(3, `[browser] Launched browser in debug mode.`);\r\n      }\r\n    } catch (error) {\r\n      throw new ExportError(\r\n        '[browser] Maximum retries to open a browser instance reached.',\r\n        500\r\n      ).setError(error);\r\n    }\r\n\r\n    if (!browser) {\r\n      throw new ExportError('[browser] Cannot find a browser to open.', 500);\r\n    }\r\n  }\r\n\r\n  // Return a browser instance\r\n  return browser;\r\n}\r\n\r\n/**\r\n * Closes the Puppeteer browser instance if it is connected.\r\n *\r\n * @async\r\n * @function closeBrowser\r\n */\r\nexport async function closeBrowser() {\r\n  // Close the browser when connected\r\n  if (browser && browser.connected) {\r\n    await browser.close();\r\n  }\r\n  browser = null;\r\n  log(4, '[browser] Closed the browser.');\r\n}\r\n\r\n/**\r\n * Creates a new Puppeteer page within an existing browser instance.\r\n * The function creates a new page, disables caching, sets content using\r\n * the `_setPageContent()`, and returns the created Puppeteer page.\r\n *\r\n * @async\r\n * @function newPage\r\n *\r\n * @param {Object} poolResource - The pool resource that contains `id`,\r\n * `workCount`, and `page`.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if no valid browser\r\n * has been connected or if a page is invalid or closed.\r\n */\r\nexport async function newPage(poolResource) {\r\n  // Error in case of no connected browser\r\n  if (!browser || !browser.connected) {\r\n    throw new ExportError(`[browser] Browser is not yet connected.`, 500);\r\n  }\r\n\r\n  // Create a page\r\n  poolResource.page = await browser.newPage();\r\n\r\n  // Disable cache\r\n  await poolResource.page.setCacheEnabled(false);\r\n\r\n  // Set the content\r\n  await _setPageContent(poolResource.page);\r\n\r\n  // Set page events\r\n  _setPageEvents(poolResource.page);\r\n\r\n  // Check if the page is correctly created\r\n  if (!poolResource.page || poolResource.page.isClosed()) {\r\n    throw new ExportError('[browser] The page is invalid or closed.', 400);\r\n  }\r\n}\r\n\r\n/**\r\n * Clears the content of a Puppeteer Page based on the specified mode. Logs\r\n * thrown error if clearing of a page's content fails.\r\n *\r\n * @async\r\n * @function clearPage\r\n *\r\n * @param {Object} poolResource - The pool resource that contains page and id.\r\n * @param {boolean} [hardReset=false] - A flag indicating the type of clearing\r\n * to be performed. If true, navigates to `about:blank` and resets content\r\n * and scripts. If false, clears the body content by setting a predefined HTML\r\n * structure. The default value is `false`.\r\n *\r\n * @returns {Promise<boolean>} A Promise that resolves to true when page\r\n * is correctly cleared and false when it is not.\r\n */\r\nexport async function clearPage(poolResource, hardReset = false) {\r\n  try {\r\n    if (poolResource.page && !poolResource.page.isClosed()) {\r\n      if (hardReset) {\r\n        // Navigate to `about:blank`\r\n        await poolResource.page.goto('about:blank', {\r\n          waitUntil: 'domcontentloaded'\r\n        });\r\n\r\n        // Set the content and and scripts again\r\n        await _setPageContent(poolResource.page);\r\n      } else {\r\n        // Clear body content\r\n        await poolResource.page.evaluate(() => {\r\n          document.body.innerHTML =\r\n            '<div id=\"chart-container\"><div id=\"container\"></div></div>';\r\n        });\r\n      }\r\n      return true;\r\n    }\r\n  } catch (error) {\r\n    logWithStack(\r\n      2,\r\n      error,\r\n      `[pool] Pool resource [${poolResource.id}] - Content of the page could not be cleared.`\r\n    );\r\n\r\n    // Set the `workLimit` to exceeded in order to recreate the resource\r\n    poolResource.workCount = getOptions().pool.workLimit + 1;\r\n  }\r\n  return false;\r\n}\r\n\r\n/**\r\n * Adds custom JS and CSS resources to a Puppeteer Page based on the specified\r\n * options.\r\n *\r\n * @async\r\n * @function addPageResources\r\n *\r\n * @param {Object} page - The Puppeteer page object to which resources will\r\n * be added.\r\n * @param {Object} customLogicOptions - The configuration object containing\r\n * `customLogic` options.\r\n *\r\n * @returns {Promise<Array.<Object>>} A Promise that resolves to an array\r\n * of injected resources.\r\n */\r\nexport async function addPageResources(page, customLogicOptions) {\r\n  // Injected resources array\r\n  const injectedResources = [];\r\n\r\n  // Use resources\r\n  const resources = customLogicOptions.resources;\r\n  if (resources) {\r\n    const injectedJs = [];\r\n\r\n    // Load custom JS code\r\n    if (resources.js) {\r\n      injectedJs.push({\r\n        content: resources.js\r\n      });\r\n    }\r\n\r\n    // Load scripts from all custom files\r\n    if (resources.files) {\r\n      for (const file of resources.files) {\r\n        const isLocal = !file.startsWith('http') ? true : false;\r\n\r\n        // Add each custom script from resources' files\r\n        injectedJs.push(\r\n          isLocal\r\n            ? {\r\n                content: readFileSync(getAbsolutePath(file), 'utf8')\r\n              }\r\n            : {\r\n                url: file\r\n              }\r\n        );\r\n      }\r\n    }\r\n\r\n    for (const jsResource of injectedJs) {\r\n      try {\r\n        injectedResources.push(await page.addScriptTag(jsResource));\r\n      } catch (error) {\r\n        logWithStack(2, error, `[browser] The JS resource cannot be loaded.`);\r\n      }\r\n    }\r\n    injectedJs.length = 0;\r\n\r\n    // Load CSS\r\n    const injectedCss = [];\r\n    if (resources.css) {\r\n      let cssImports = resources.css.match(/@import\\s*([^;]*);/g);\r\n      if (cssImports) {\r\n        // Handle css section\r\n        for (let cssImportPath of cssImports) {\r\n          if (cssImportPath) {\r\n            cssImportPath = cssImportPath\r\n              .replace('url(', '')\r\n              .replace('@import', '')\r\n              .replace(/\"/g, '')\r\n              .replace(/'/g, '')\r\n              .replace(/;/, '')\r\n              .replace(/\\)/g, '')\r\n              .trim();\r\n\r\n            // Add each custom css from resources\r\n            if (cssImportPath.startsWith('http')) {\r\n              injectedCss.push({\r\n                url: cssImportPath\r\n              });\r\n            } else if (customLogicOptions.allowFileResources) {\r\n              injectedCss.push({\r\n                path: join(__dirname, cssImportPath)\r\n              });\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      // The rest of the CSS section will be content by now\r\n      injectedCss.push({\r\n        content: resources.css.replace(/@import\\s*([^;]*);/g, '') || ' '\r\n      });\r\n\r\n      for (const cssResource of injectedCss) {\r\n        try {\r\n          injectedResources.push(await page.addStyleTag(cssResource));\r\n        } catch (error) {\r\n          logWithStack(\r\n            2,\r\n            error,\r\n            `[browser] The CSS resource cannot be loaded.`\r\n          );\r\n        }\r\n      }\r\n      injectedCss.length = 0;\r\n    }\r\n  }\r\n  return injectedResources;\r\n}\r\n\r\n/**\r\n * Clears out all state set on the page with `addScriptTag` and `addStyleTag`.\r\n * Removes injected resources and resets CSS and script tags on the page.\r\n * Additionally, it destroys previously existing charts.\r\n *\r\n * @async\r\n * @function clearPageResources\r\n *\r\n * @param {Object} page - The Puppeteer page object from which resources will\r\n * be cleared.\r\n * @param {Array.<Object>} injectedResources - Array of injected resources\r\n * to be cleared.\r\n */\r\nexport async function clearPageResources(page, injectedResources) {\r\n  try {\r\n    for (const resource of injectedResources) {\r\n      await resource.dispose();\r\n    }\r\n\r\n    // Destroy old charts after export is done and reset all CSS and script tags\r\n    await page.evaluate(() => {\r\n      // We are not guaranteed that Highcharts is loaded, when doing SVG exports\r\n      if (typeof Highcharts !== 'undefined') {\r\n        // eslint-disable-next-line no-undef\r\n        const oldCharts = Highcharts.charts;\r\n\r\n        // Check in any already existing charts\r\n        if (Array.isArray(oldCharts) && oldCharts.length) {\r\n          // Destroy old charts\r\n          for (const oldChart of oldCharts) {\r\n            oldChart && oldChart.destroy();\r\n            // eslint-disable-next-line no-undef\r\n            Highcharts.charts.shift();\r\n          }\r\n        }\r\n      }\r\n\r\n      // eslint-disable-next-line no-undef\r\n      const [...scriptsToRemove] = document.getElementsByTagName('script');\r\n      // eslint-disable-next-line no-undef\r\n      const [, ...stylesToRemove] = document.getElementsByTagName('style');\r\n      // eslint-disable-next-line no-undef\r\n      const [...linksToRemove] = document.getElementsByTagName('link');\r\n\r\n      // Remove tags\r\n      for (const element of [\r\n        ...scriptsToRemove,\r\n        ...stylesToRemove,\r\n        ...linksToRemove\r\n      ]) {\r\n        element.remove();\r\n      }\r\n    });\r\n  } catch (error) {\r\n    logWithStack(2, error, `[browser] Could not clear page's resources.`);\r\n  }\r\n}\r\n\r\n/**\r\n * Sets the content for a Puppeteer Page using a predefined template\r\n * and additional scripts.\r\n *\r\n * @async\r\n * @function _setPageContent\r\n *\r\n * @param {Object} page - The Puppeteer page object to which the content\r\n * is being set.\r\n */\r\nasync function _setPageContent(page) {\r\n  // Set the initial page content\r\n  await page.setContent(template, { waitUntil: 'domcontentloaded' });\r\n\r\n  // Add all registered Higcharts scripts, quite demanding\r\n  await page.addScriptTag({ path: join(getCachePath(), 'sources.js') });\r\n\r\n  // Set the initial `animObject` for Highcharts\r\n  await page.evaluate(setupHighcharts);\r\n}\r\n\r\n/**\r\n * Set events (like `pageerror` and `console`) for a Puppeteer Page in order\r\n * to catch and display errors and console logs from the window context.\r\n *\r\n * @function _setPageEvents\r\n *\r\n * @param {Object} page - The Puppeteer page object to which the listeners\r\n * are being set.\r\n */\r\nfunction _setPageEvents(page) {\r\n  // Get `debug` options\r\n  const { debug } = getOptions();\r\n\r\n  // Set the `pageerror` listener\r\n  page.on('pageerror', async () => {\r\n    // It would seem like this may fire at the same time or shortly before\r\n    // a page is closed.\r\n    if (page.isClosed()) {\r\n      return;\r\n    }\r\n  });\r\n\r\n  // Set the `console` listener, if needed\r\n  if (debug.enable && debug.listenToConsole) {\r\n    page.on('console', (message) => {\r\n      console.log(`[debug] ${message.text()}`);\r\n    });\r\n  }\r\n}\r\n\r\nexport default {\r\n  getBrowser,\r\n  createBrowser,\r\n  closeBrowser,\r\n  newPage,\r\n  clearPage,\r\n  addPageResources,\r\n  clearPageResources\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * The CSS to be used on the exported page.\r\n *\r\n * @returns {string} The CSS configuration.\r\n */\r\nexport default () => `\r\n\r\nhtml, body {\r\n  margin: 0;\r\n  padding: 0;\r\n  box-sizing: border-box;\r\n}\r\n\r\n#table-div, #sliders, #datatable, #controls, .ld-row {\r\n  display: none;\r\n  height: 0;\r\n}\r\n\r\n#chart-container {\r\n  box-sizing: border-box;\r\n  margin: 0;\r\n  overflow: auto;\r\n  font-size: 0;\r\n}\r\n\r\n#chart-container > figure, div {\r\n  margin-top: 0 !important;\r\n  margin-bottom: 0 !important;\r\n}\r\n\r\n`;\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\nimport cssTemplate from './css.js';\r\n\r\n/**\r\n * The SVG template to use when loading SVG content to be exported.\r\n *\r\n * @param {string} svg - The SVG input content to be exported.\r\n *\r\n * @returns {string} The SVG template.\r\n */\r\nexport default (svg) => `\r\n<!DOCTYPE html>\r\n<html lang='en-US'>\r\n  <head>\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\">\r\n    <title>Highcharts Export</title>\r\n  </head>\r\n  <style>\r\n    ${cssTemplate()}\r\n  </style>\r\n  <body>\r\n    <div id=\"chart-container\">\r\n      ${svg}\r\n    </div>\r\n  </body>\r\n</html>\r\n\r\n`;\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview This module handles chart export functionality using Puppeteer.\r\n * It supports exporting charts as SVG, PNG, JPEG, and PDF formats. The module\r\n * manages page resources, sets up the export environment, and processes chart\r\n * configurations or SVG inputs for rendering. Exports to a chart from a page\r\n * using Puppeteer.\r\n */\r\n\r\nimport { addPageResources, clearPageResources } from './browser.js';\r\nimport { createChart } from './highcharts.js';\r\nimport { log } from './logger.js';\r\n\r\nimport svgTemplate from '../templates/svgExport/svgExport.js';\r\n\r\nimport ExportError from './errors/ExportError.js';\r\n\r\n/**\r\n * Exports to a chart from a page using Puppeteer.\r\n *\r\n * @async\r\n * @function puppeteerExport\r\n *\r\n * @param {Object} page - Puppeteer page object.\r\n * @param {Object} exportOptions - The configuration object containing `export`\r\n * options.\r\n * @param {Object} customLogicOptions - The configuration object containing\r\n * `customLogic` options.\r\n *\r\n * @returns {Promise<(string|Buffer|ExportError)>} A Promise that resolves\r\n * to the exported data or rejecting with an `ExportError`.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if export to an unsupported\r\n * output format occurs.\r\n */\r\nexport async function puppeteerExport(page, exportOptions, customLogicOptions) {\r\n  // Injected resources array (additional JS and CSS)\r\n  const injectedResources = [];\r\n\r\n  try {\r\n    let isSVG = false;\r\n\r\n    // Decide on the export method\r\n    if (exportOptions.svg) {\r\n      log(4, '[export] Treating as SVG input.');\r\n\r\n      // If the `type` is also SVG, return the input\r\n      if (exportOptions.type === 'svg') {\r\n        return exportOptions.svg;\r\n      }\r\n\r\n      // Mark as SVG export for the later size corrections\r\n      isSVG = true;\r\n\r\n      // SVG export\r\n      await page.setContent(svgTemplate(exportOptions.svg), {\r\n        waitUntil: 'domcontentloaded'\r\n      });\r\n    } else {\r\n      log(4, '[export] Treating as JSON config.');\r\n\r\n      // Options export\r\n      await page.evaluate(createChart, exportOptions, customLogicOptions);\r\n    }\r\n\r\n    // Keeps track of all resources added on the page with addXXXTag. etc\r\n    // It's VITAL that all added resources ends up here so we can clear things\r\n    // out when doing a new export in the same page!\r\n    injectedResources.push(\r\n      ...(await addPageResources(page, customLogicOptions))\r\n    );\r\n\r\n    // Get the real chart size and set the zoom accordingly\r\n    const size = isSVG\r\n      ? await page.evaluate((scale) => {\r\n          const svgElement = document.querySelector(\r\n            '#chart-container svg:first-of-type'\r\n          );\r\n\r\n          // Get the values correctly scaled\r\n          const chartHeight = svgElement.height.baseVal.value * scale;\r\n          const chartWidth = svgElement.width.baseVal.value * scale;\r\n\r\n          // In case of SVG the zoom must be set directly for body as scale\r\n          // eslint-disable-next-line no-undef\r\n          document.body.style.zoom = scale;\r\n\r\n          // Set the margin to 0px\r\n          // eslint-disable-next-line no-undef\r\n          document.body.style.margin = '0px';\r\n\r\n          return {\r\n            chartHeight,\r\n            chartWidth\r\n          };\r\n        }, parseFloat(exportOptions.scale))\r\n      : await page.evaluate(() => {\r\n          // eslint-disable-next-line no-undef\r\n          const { chartHeight, chartWidth } = window.Highcharts.charts[0];\r\n\r\n          // No need for such scale manipulation in case of other types\r\n          // of exports. Reset the zoom for other exports than to SVGs\r\n          // eslint-disable-next-line no-undef\r\n          document.body.style.zoom = 1;\r\n\r\n          return {\r\n            chartHeight,\r\n            chartWidth\r\n          };\r\n        });\r\n\r\n    // Get the clip region for the page\r\n    const { x, y } = await _getClipRegion(page);\r\n\r\n    // Set final `height` for viewport\r\n    const viewportHeight = Math.abs(\r\n      Math.ceil(size.chartHeight || exportOptions.height)\r\n    );\r\n\r\n    // Set final `width` for viewport\r\n    const viewportWidth = Math.abs(\r\n      Math.ceil(size.chartWidth || exportOptions.width)\r\n    );\r\n\r\n    // Set the final viewport now that we have the real height\r\n    await page.setViewport({\r\n      height: viewportHeight,\r\n      width: viewportWidth,\r\n      deviceScaleFactor: isSVG ? 1 : parseFloat(exportOptions.scale)\r\n    });\r\n\r\n    let result;\r\n    // Rasterization process\r\n    switch (exportOptions.type) {\r\n      case 'svg':\r\n        result = await _createSVG(page);\r\n        break;\r\n      case 'png':\r\n      case 'jpeg':\r\n        result = await _createImage(\r\n          page,\r\n          exportOptions.type,\r\n          {\r\n            width: viewportWidth,\r\n            height: viewportHeight,\r\n            x,\r\n            y\r\n          },\r\n          exportOptions.rasterizationTimeout\r\n        );\r\n        break;\r\n      case 'pdf':\r\n        result = await _createPDF(\r\n          page,\r\n          viewportHeight,\r\n          viewportWidth,\r\n          exportOptions.rasterizationTimeout\r\n        );\r\n        break;\r\n      default:\r\n        throw new ExportError(\r\n          `[export] Unsupported output format: ${exportOptions.type}.`,\r\n          400\r\n        );\r\n    }\r\n\r\n    // Clear previously injected JS and CSS resources\r\n    await clearPageResources(page, injectedResources);\r\n    return result;\r\n  } catch (error) {\r\n    await clearPageResources(page, injectedResources);\r\n    return error;\r\n  }\r\n}\r\n\r\n/**\r\n * Retrieves the clipping region coordinates of the specified page element\r\n * with the 'chart-container' id.\r\n *\r\n * @async\r\n * @function _getClipRegion\r\n *\r\n * @param {Object} page - Puppeteer page object.\r\n *\r\n * @returns {Promise<Object>} A Promise that resolves to an object containing\r\n * `x`, `y`, `width`, and `height` properties.\r\n */\r\nasync function _getClipRegion(page) {\r\n  return page.$eval('#chart-container', (element) => {\r\n    const { x, y, width, height } = element.getBoundingClientRect();\r\n    return {\r\n      x,\r\n      y,\r\n      width,\r\n      height: Math.trunc(height > 1 ? height : 500)\r\n    };\r\n  });\r\n}\r\n\r\n/**\r\n * Creates an SVG by evaluating the `outerHTML` of the first 'svg' element\r\n * inside an element with the id 'container'.\r\n *\r\n * @async\r\n * @function _createSVG\r\n *\r\n * @param {Object} page - Puppeteer page object.\r\n *\r\n * @returns {Promise<string>} A Promise that resolves to the SVG string.\r\n */\r\nasync function _createSVG(page) {\r\n  return page.$eval(\r\n    '#container svg:first-of-type',\r\n    (element) => element.outerHTML\r\n  );\r\n}\r\n\r\n/**\r\n * Creates an image using Puppeteer's page `screenshot` functionality with\r\n * specified options.\r\n *\r\n * @async\r\n * @function _createImage\r\n *\r\n * @param {Object} page - Puppeteer page object.\r\n * @param {string} type - Image type.\r\n * @param {Object} clip - Clipping region coordinates.\r\n * @param {number} rasterizationTimeout - Timeout for rasterization\r\n * in milliseconds.\r\n *\r\n * @returns {Promise<Buffer>} A Promise that resolves to the image buffer\r\n * or rejecting with an `ExportError` for timeout.\r\n */\r\nasync function _createImage(page, type, clip, rasterizationTimeout) {\r\n  return Promise.race([\r\n    page.screenshot({\r\n      type,\r\n      clip,\r\n      encoding: 'base64',\r\n      fullPage: false,\r\n      optimizeForSpeed: true,\r\n      captureBeyondViewport: true,\r\n      ...(type !== 'png' ? { quality: 80 } : {}),\r\n      // Always render on a transparent page if the expected type format is PNG\r\n      omitBackground: type == 'png' // #447, #463\r\n    }),\r\n    new Promise((_resolve, reject) =>\r\n      setTimeout(\r\n        () => reject(new ExportError('Rasterization timeout', 408)),\r\n        rasterizationTimeout || 1500\r\n      )\r\n    )\r\n  ]);\r\n}\r\n\r\n/**\r\n * Creates a PDF using Puppeteer's page `pdf` functionality with specified\r\n * options.\r\n *\r\n * @async\r\n * @function _createPDF\r\n *\r\n * @param {Object} page - Puppeteer page object.\r\n * @param {number} height - PDF height.\r\n * @param {number} width - PDF width.\r\n * @param {number} rasterizationTimeout - Timeout for rasterization\r\n * in milliseconds.\r\n *\r\n * @returns {Promise<Buffer>} A Promise that resolves to the PDF buffer.\r\n */\r\nasync function _createPDF(page, height, width, rasterizationTimeout) {\r\n  await page.emulateMediaType('screen');\r\n  return page.pdf({\r\n    // This will remove an extra empty page in PDF exports\r\n    height: height + 1,\r\n    width,\r\n    encoding: 'base64',\r\n    timeout: rasterizationTimeout || 1500\r\n  });\r\n}\r\n\r\nexport default {\r\n  puppeteerExport\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview This module provides a worker pool implementation for managing\r\n * the browser instance and pages, specifically designed for use with\r\n * the Highcharts Export Server. It optimizes resources usage and performance\r\n * by maintaining a pool of workers that can handle concurrent export tasks\r\n * using Puppeteer.\r\n */\r\n\r\nimport { Pool } from 'tarn';\r\nimport { v4 as uuid } from 'uuid';\r\n\r\nimport { createBrowser, closeBrowser, newPage, clearPage } from './browser.js';\r\nimport { puppeteerExport } from './export.js';\r\nimport { log, logWithStack } from './logger.js';\r\nimport { getNewDateTime, measureTime } from './utils.js';\r\n\r\nimport ExportError from './errors/ExportError.js';\r\n\r\n// The pool instance\r\nlet pool = null;\r\n\r\n// Pool statistics\r\nconst poolStats = {\r\n  exportsAttempted: 0,\r\n  exportsPerformed: 0,\r\n  exportsDropped: 0,\r\n  exportsFromSvg: 0,\r\n  exportsFromOptions: 0,\r\n  exportsFromSvgAttempts: 0,\r\n  exportsFromOptionsAttempts: 0,\r\n  timeSpent: 0,\r\n  timeSpentAverage: 0\r\n};\r\n\r\n/**\r\n * Initializes the export pool with the provided configuration, creating\r\n * a browser instance and setting up worker resources.\r\n *\r\n * @async\r\n * @function initPool\r\n *\r\n * @param {Object} poolOptions - The configuration object containing `pool`\r\n * options.\r\n * @param {Array.<string>} puppeteerArgs - Additional arguments for Puppeteer\r\n * launch.\r\n *\r\n * @returns {Promise<void>} A Promise that resolves to ending the function\r\n * execution when an already initialized pool of resources is found.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if could not create the pool\r\n * of workers.\r\n */\r\nexport async function initPool(poolOptions, puppeteerArgs) {\r\n  // Create a browser instance with the puppeteer arguments\r\n  await createBrowser(puppeteerArgs);\r\n\r\n  try {\r\n    log(\r\n      3,\r\n      `[pool] Initializing pool with workers: min ${poolOptions.minWorkers}, max ${poolOptions.maxWorkers}.`\r\n    );\r\n\r\n    if (pool) {\r\n      log(\r\n        4,\r\n        '[pool] Already initialized, please kill it before creating a new one.'\r\n      );\r\n      return;\r\n    }\r\n\r\n    // Keep an eye on a correct min and max workers number\r\n    if (poolOptions.minWorkers > poolOptions.maxWorkers) {\r\n      poolOptions.minWorkers = poolOptions.maxWorkers;\r\n    }\r\n\r\n    // Create a pool along with a minimal number of resources\r\n    pool = new Pool({\r\n      // Get the `create`, `validate`, and `destroy` functions\r\n      ..._factory(poolOptions),\r\n      min: poolOptions.minWorkers,\r\n      max: poolOptions.maxWorkers,\r\n      acquireTimeoutMillis: poolOptions.acquireTimeout,\r\n      createTimeoutMillis: poolOptions.createTimeout,\r\n      destroyTimeoutMillis: poolOptions.destroyTimeout,\r\n      idleTimeoutMillis: poolOptions.idleTimeout,\r\n      createRetryIntervalMillis: poolOptions.createRetryInterval,\r\n      reapIntervalMillis: poolOptions.reaperInterval,\r\n      propagateCreateError: false\r\n    });\r\n\r\n    // Set events\r\n    pool.on('release', async (resource) => {\r\n      // Clear page\r\n      const clearStatus = await clearPage(resource, false);\r\n      log(\r\n        4,\r\n        `[pool] Pool resource [${resource.id}] - Releasing a worker. Clear page status: ${clearStatus}.`\r\n      );\r\n    });\r\n\r\n    pool.on('destroySuccess', (_eventId, resource) => {\r\n      log(\r\n        4,\r\n        `[pool] Pool resource [${resource.id}] - Destroyed a worker successfully.`\r\n      );\r\n      resource.page = null;\r\n    });\r\n\r\n    const initialResources = [];\r\n    // Create an initial number of resources\r\n    for (let i = 0; i < poolOptions.minWorkers; i++) {\r\n      try {\r\n        const resource = await pool.acquire().promise;\r\n        initialResources.push(resource);\r\n      } catch (error) {\r\n        logWithStack(2, error, '[pool] Could not create an initial resource.');\r\n      }\r\n    }\r\n\r\n    // Release the initial number of resources back to the pool\r\n    initialResources.forEach((resource) => {\r\n      pool.release(resource);\r\n    });\r\n\r\n    log(\r\n      3,\r\n      `[pool] The pool is ready${initialResources.length ? ` with ${initialResources.length} initial resources waiting.` : '.'}`\r\n    );\r\n  } catch (error) {\r\n    throw new ExportError(\r\n      '[pool] Could not configure and create the pool of workers.',\r\n      500\r\n    ).setError(error);\r\n  }\r\n}\r\n\r\n/**\r\n * Terminates all workers in the pool, destroys the pool, and closes the browser\r\n * instance.\r\n *\r\n * @async\r\n * @function killPool\r\n *\r\n * @returns {Promise<void>} A Promise that resolves once all workers are\r\n * terminated, the pool is destroyed, and the browser is successfully closed.\r\n */\r\nexport async function killPool() {\r\n  log(3, '[pool] Killing pool with all workers and closing browser.');\r\n\r\n  // If still alive, destroy the pool of pages before closing a browser\r\n  if (pool) {\r\n    // Free up not released workers\r\n    for (const worker of pool.used) {\r\n      pool.release(worker.resource);\r\n    }\r\n\r\n    // Destroy the pool if it is still available\r\n    if (!pool.destroyed) {\r\n      await pool.destroy();\r\n      log(4, '[pool] Destroyed the pool of resources.');\r\n    }\r\n    pool = null;\r\n  }\r\n\r\n  // Close the browser instance\r\n  await closeBrowser();\r\n}\r\n\r\n/**\r\n * Processes the export work using a worker from the pool. Acquires a worker\r\n * handle from the pool, performs the export using puppeteer, and releases\r\n * the worker handle back to the pool.\r\n *\r\n * @async\r\n * @function postWork\r\n *\r\n * @param {Object} options - The configuration object containing complete set\r\n * of options.\r\n *\r\n * @returns {Promise<Object>} A Promise that resolves to the export result\r\n * and options.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if an error occurs during\r\n * the export process.\r\n */\r\nexport async function postWork(options) {\r\n  let workerHandle;\r\n\r\n  try {\r\n    log(4, '[pool] Work received, starting to process.');\r\n\r\n    // An export attempt counted\r\n    ++poolStats.exportsAttempted;\r\n\r\n    // Display the pool information if needed\r\n    if (options.pool.benchmarking) {\r\n      getPoolInfo();\r\n    }\r\n\r\n    // Throw an error in case of lacking the pool instance\r\n    if (!pool) {\r\n      throw new ExportError(\r\n        '[pool] Work received, but pool has not been started.',\r\n        500\r\n      );\r\n    }\r\n\r\n    // The acquire counter\r\n    const acquireCounter = measureTime();\r\n\r\n    // Try to acquire the worker along with the id, works count and page\r\n    try {\r\n      log(4, '[pool] Acquiring a worker handle.');\r\n\r\n      // Acquire a pool resource\r\n      workerHandle = await pool.acquire().promise;\r\n\r\n      // Check the page acquire time\r\n      if (options.server.benchmarking) {\r\n        log(\r\n          5,\r\n          `[benchmark] ${options.requestId ? `Request [${options.requestId}] - ` : ''}`,\r\n          `Acquiring a worker handle took ${acquireCounter()}ms.`\r\n        );\r\n      }\r\n    } catch (error) {\r\n      throw new ExportError(\r\n        `[pool] ${\r\n          options.requestId ? `Request [${options.requestId}] - ` : ''\r\n        }Error encountered when acquiring an available entry: ${acquireCounter()}ms.`,\r\n        400\r\n      ).setError(error);\r\n    }\r\n    log(4, '[pool] Acquired a worker handle.');\r\n\r\n    if (!workerHandle.page) {\r\n      // Set the `workLimit` to exceeded in order to recreate the resource\r\n      workerHandle.workCount = options.pool.workLimit + 1;\r\n      throw new ExportError(\r\n        '[pool] Resolved worker page is invalid: the pool setup is wonky.',\r\n        400\r\n      );\r\n    }\r\n\r\n    // Save the start time\r\n    const workStart = getNewDateTime();\r\n\r\n    log(\r\n      4,\r\n      `[pool] Pool resource [${workerHandle.id}] - Starting work on this pool entry.`\r\n    );\r\n\r\n    // Start measuring export time\r\n    const exportCounter = measureTime();\r\n\r\n    // Perform an export on a puppeteer level\r\n    const result = await puppeteerExport(\r\n      workerHandle.page,\r\n      options.export,\r\n      options.customLogic\r\n    );\r\n\r\n    // Check if it's an error\r\n    if (result instanceof Error) {\r\n      // NOTE:\r\n      // If there's a rasterization timeout, we want need to flush the page.\r\n      // This is because the page may be in a state where it's waiting for\r\n      // the screenshot to finish even though the timeout has occured.\r\n      // Which of course causes a lot of issues with the event system,\r\n      // and page consistency.\r\n      //\r\n      // NOTE:\r\n      // Only page.screenshot will throw this, timeouts for PDF's are\r\n      // handled by the page.pdf function itself.\r\n      //\r\n      // ...yes, this is ugly.\r\n      if (result.message === 'Rasterization timeout') {\r\n        // Set the `workLimit` to exceeded in order to recreate the resource\r\n        workerHandle.workCount = options.pool.workLimit + 1;\r\n        workerHandle.page = null;\r\n      }\r\n\r\n      if (\r\n        result.name === 'TimeoutError' ||\r\n        result.message === 'Rasterization timeout'\r\n      ) {\r\n        throw new ExportError(\r\n          `[pool] ${\r\n            options.requestId ? `Request [${options.requestId}] - ` : ''\r\n          }Rasterization timeout: your chart may be too complex or large, and failed to render within the allotted time.`\r\n        ).setError(result);\r\n      } else {\r\n        throw new ExportError(\r\n          `[pool] ${\r\n            options.requestId ? `Request [${options.requestId}] - ` : ''\r\n          }Error encountered during export: ${exportCounter()}ms.`\r\n        ).setError(result);\r\n      }\r\n    }\r\n\r\n    // Check the Puppeteer export time\r\n    if (options.server.benchmarking) {\r\n      log(\r\n        5,\r\n        `[benchmark] ${options.requestId ? `Request [${options.requestId}] - ` : ''}`,\r\n        `Exporting a chart sucessfully took ${exportCounter()}ms.`\r\n      );\r\n    }\r\n\r\n    // Release the resource back to the pool\r\n    pool.release(workerHandle);\r\n\r\n    // Used for statistics in averageTime and processedWorkCount, which\r\n    // in turn is used by the /health route.\r\n    const workEnd = getNewDateTime();\r\n    const exportTime = workEnd - workStart;\r\n\r\n    poolStats.timeSpent += exportTime;\r\n    poolStats.timeSpentAverage =\r\n      poolStats.timeSpent / ++poolStats.exportsPerformed;\r\n\r\n    log(4, `[pool] Work completed in ${exportTime}ms.`);\r\n\r\n    // Otherwise return the result\r\n    return {\r\n      result,\r\n      options\r\n    };\r\n  } catch (error) {\r\n    ++poolStats.exportsDropped;\r\n\r\n    if (workerHandle) {\r\n      pool.release(workerHandle);\r\n    }\r\n\r\n    throw error;\r\n  }\r\n}\r\n\r\n/**\r\n * Retrieves the current pool instance.\r\n *\r\n * @function getPool\r\n *\r\n * @returns {(Object|null)} The current pool instance if initialized, or null\r\n * if the pool has not been created.\r\n */\r\nexport function getPool() {\r\n  return pool;\r\n}\r\n\r\n/**\r\n * Gets the statistic of a pool instace about exports.\r\n *\r\n * @function getPoolStats\r\n *\r\n * @returns {Object} The current pool statistics.\r\n */\r\nexport function getPoolStats() {\r\n  return poolStats;\r\n}\r\n\r\n/**\r\n * Retrieves pool information in JSON format, including minimum and maximum\r\n * workers, available workers, workers in use, and pending acquire requests.\r\n *\r\n * @function getPoolInfoJSON\r\n *\r\n * @returns {Object} Pool information in JSON format.\r\n */\r\nexport function getPoolInfoJSON() {\r\n  return {\r\n    min: pool.min,\r\n    max: pool.max,\r\n    used: pool.numUsed(),\r\n    available: pool.numFree(),\r\n    allCreated: pool.numUsed() + pool.numFree(),\r\n    pendingAcquires: pool.numPendingAcquires(),\r\n    pendingCreates: pool.numPendingCreates(),\r\n    pendingValidations: pool.numPendingValidations(),\r\n    pendingDestroys: pool.pendingDestroys.length,\r\n    absoluteAll:\r\n      pool.numUsed() +\r\n      pool.numFree() +\r\n      pool.numPendingAcquires() +\r\n      pool.numPendingCreates() +\r\n      pool.numPendingValidations() +\r\n      pool.pendingDestroys.length\r\n  };\r\n}\r\n\r\n/**\r\n * Logs information about the current state of the pool, including the minimum\r\n * and maximum workers, available workers, workers in use, and pending acquire\r\n * requests.\r\n *\r\n * @function getPoolInfo\r\n */\r\nexport function getPoolInfo() {\r\n  const {\r\n    min,\r\n    max,\r\n    used,\r\n    available,\r\n    allCreated,\r\n    pendingAcquires,\r\n    pendingCreates,\r\n    pendingValidations,\r\n    pendingDestroys,\r\n    absoluteAll\r\n  } = getPoolInfoJSON();\r\n\r\n  log(5, `[pool] The minimum number of resources allowed by pool: ${min}.`);\r\n  log(5, `[pool] The maximum number of resources allowed by pool: ${max}.`);\r\n  log(5, `[pool] The number of used resources: ${used}.`);\r\n  log(5, `[pool] The number of free resources: ${available}.`);\r\n  log(\r\n    5,\r\n    `[pool] The number of all created (used and free) resources: ${allCreated}.`\r\n  );\r\n  log(\r\n    5,\r\n    `[pool] The number of resources waiting to be acquired: ${pendingAcquires}.`\r\n  );\r\n  log(\r\n    5,\r\n    `[pool] The number of resources waiting to be created: ${pendingCreates}.`\r\n  );\r\n  log(\r\n    5,\r\n    `[pool] The number of resources waiting to be validated: ${pendingValidations}.`\r\n  );\r\n  log(\r\n    5,\r\n    `[pool] The number of resources waiting to be destroyed: ${pendingDestroys}.`\r\n  );\r\n  log(5, `[pool] The number of all resources: ${absoluteAll}.`);\r\n}\r\n\r\n/**\r\n * Factory function that returns an object with `create`, `validate`,\r\n * and `destroy` functions for the pool instance.\r\n *\r\n * @function _factory\r\n *\r\n * @param {Object} poolOptions - The configuration object containing `pool`\r\n * options.\r\n */\r\nfunction _factory(poolOptions) {\r\n  return {\r\n    /**\r\n     * Creates a new worker page for the export pool.\r\n     *\r\n     * @async\r\n     * @function create\r\n     *\r\n     * @returns {Promise<Object>} A Promise that resolves to an object\r\n     * containing the worker ID, a reference to the browser page, and initial\r\n     * work count.\r\n     *\r\n     * @throws {ExportError} Throws an `ExportError` if there is an error during\r\n     * the creation of the new page.\r\n     */\r\n    create: async () => {\r\n      // Init the resource with unique id and work count\r\n      const poolResource = {\r\n        id: uuid(),\r\n        // Try to distribute the initial work count\r\n        workCount: Math.round(Math.random() * (poolOptions.workLimit / 2))\r\n      };\r\n\r\n      try {\r\n        // Start measuring a page creation time\r\n        const startDate = getNewDateTime();\r\n\r\n        // Create a new page\r\n        await newPage(poolResource);\r\n\r\n        // Measure the time of full creation and configuration of a page\r\n        log(\r\n          3,\r\n          `[pool] Pool resource [${poolResource.id}] - Successfully created a worker, took ${\r\n            getNewDateTime() - startDate\r\n          }ms.`\r\n        );\r\n\r\n        // Return ready pool resource\r\n        return poolResource;\r\n      } catch (error) {\r\n        log(\r\n          3,\r\n          `[pool] Pool resource [${poolResource.id}] - Error encountered when creating a new page.`\r\n        );\r\n        throw error;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Validates a worker page in the export pool, checking if it has exceeded\r\n     * the work limit.\r\n     *\r\n     * @async\r\n     * @function validate\r\n     *\r\n     * @param {Object} poolResource - The handle to the worker, containing\r\n     * the worker's ID, a reference to the browser page, and work count.\r\n     *\r\n     * @returns {Promise<boolean>} A Promise that resolves to true if the worker\r\n     * is valid and within the work limit; otherwise, to false.\r\n     */\r\n    validate: async (poolResource) => {\r\n      // NOTE:\r\n      // In certain cases acquiring throws a TargetCloseError, which may\r\n      // be caused by two things:\r\n      // - The page is closed and attempted to be reused.\r\n      // - Lost contact with the browser.\r\n      //\r\n      // What we're seeing in logs is that successive exports typically\r\n      // succeeds, and the server recovers, indicating that it's likely\r\n      // the first case. This is an attempt at allievating the issue by\r\n      // simply not validating the worker if the page is null or closed.\r\n      //\r\n      // The actual result from when this happened, was that a worker would\r\n      // be completely locked, stopping it from being acquired until\r\n      // its work count reached the limit.\r\n\r\n      // Check if the `page` is valid\r\n      if (!poolResource.page) {\r\n        log(\r\n          3,\r\n          `[pool] Pool resource [${poolResource.id}] - Validation failed (no valid page is found).`\r\n        );\r\n        return false;\r\n      }\r\n\r\n      // Check if the `page` is closed\r\n      if (poolResource.page.isClosed()) {\r\n        log(\r\n          3,\r\n          `[pool] Pool resource [${poolResource.id}] - Validation failed (page is closed or invalid).`\r\n        );\r\n        return false;\r\n      }\r\n\r\n      // Check if the `mainFrame` is detached\r\n      if (poolResource.page.mainFrame().detached) {\r\n        log(\r\n          3,\r\n          `[pool] Pool resource [${poolResource.id}] - Validation failed (page's frame is detached).`\r\n        );\r\n        return false;\r\n      }\r\n\r\n      // Check if the `workLimit` is exceeded\r\n      if (\r\n        poolOptions.workLimit &&\r\n        ++poolResource.workCount > poolOptions.workLimit\r\n      ) {\r\n        log(\r\n          3,\r\n          `[pool] Pool resource [${poolResource.id}] - Validation failed (exceeded the ${poolOptions.workLimit} works per resource limit).`\r\n        );\r\n        return false;\r\n      }\r\n\r\n      // The `poolResource` is validated\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * Destroys a worker entry in the export pool, closing its associated page.\r\n     *\r\n     * @async\r\n     * @function destroy\r\n     *\r\n     * @param {Object} poolResource - The handle to the worker, containing\r\n     * the worker's ID, a reference to the browser page, and work count.\r\n     */\r\n    destroy: async (poolResource) => {\r\n      log(\r\n        3,\r\n        `[pool] Pool resource [${poolResource.id}] - Destroying a worker.`\r\n      );\r\n\r\n      if (poolResource.page && !poolResource.page.isClosed()) {\r\n        try {\r\n          // Remove all attached event listeners from the resource\r\n          poolResource.page.removeAllListeners('pageerror');\r\n          poolResource.page.removeAllListeners('console');\r\n          poolResource.page.removeAllListeners('framedetached');\r\n\r\n          // We need to wait around for this\r\n          await poolResource.page.close();\r\n        } catch (error) {\r\n          log(\r\n            3,\r\n            `[pool] Pool resource [${poolResource.id}] - Page could not be closed upon destroying.`\r\n          );\r\n          throw error;\r\n        }\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nexport default {\r\n  initPool,\r\n  killPool,\r\n  postWork,\r\n  getPool,\r\n  getPoolStats,\r\n  getPoolInfo,\r\n  getPoolInfoJSON\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Used to sanitize the strings coming from the exporting module\r\n * to prevent XSS attacks (with the DOMPurify library).\r\n */\r\n\r\nimport DOMPurify from 'dompurify';\r\nimport { JSDOM } from 'jsdom';\r\n\r\n/**\r\n * Sanitizes a given HTML string by removing <script> tags. This function uses\r\n * a regular expression to find and remove all occurrences of <script></script>\r\n * tags and any content within them.\r\n *\r\n * @function sanitize\r\n *\r\n * @param {string} input - The HTML string to be sanitized.\r\n *\r\n * @returns {string} The sanitized HTML string.\r\n */\r\nexport function sanitize(input) {\r\n  // Get the virtual DOM\r\n  const window = new JSDOM('').window;\r\n\r\n  // Create a purifying instance\r\n  const purify = DOMPurify(window);\r\n\r\n  // Return sanitized input\r\n  return purify.sanitize(input, { ADD_TAGS: ['foreignObject'] });\r\n}\r\n\r\nexport default {\r\n  sanitize\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview This module provides functions to prepare for the exporting charts\r\n * into various image output formats such as JPEG, PNG, PDF, and SVGs.\r\n * It supports single and batch export operations and allows customization\r\n * through options passed from configurations or APIs.\r\n */\r\n\r\nimport { readFileSync, writeFileSync } from 'fs';\r\n\r\nimport { getOptions, isAllowedConfig, mergeOptions } from './config.js';\r\nimport { log, logWithStack, logZodIssues } from './logger.js';\r\nimport { getPoolStats, killPool, postWork } from './pool.js';\r\nimport { sanitize } from './sanitize.js';\r\nimport {\r\n  deepCopy,\r\n  fixConstr,\r\n  fixOutfile,\r\n  fixType,\r\n  getAbsolutePath,\r\n  getBase64,\r\n  isObject,\r\n  roundNumber,\r\n  wrapAround\r\n} from './utils.js';\r\nimport { strictValidate, validateOption } from './validation.js';\r\n\r\nimport ExportError from './errors/ExportError.js';\r\n\r\n// The global flag for the code execution permission\r\nlet allowCodeExecution = false;\r\n\r\n/**\r\n * Starts a single export process based on the specified options and saves\r\n * the resulting image to the provided output file.\r\n *\r\n * @async\r\n * @function singleExport\r\n *\r\n * @param {Object} options - The `options` object, which should include settings\r\n * from the `export` and `customLogic` sections. It can be a partial or complete\r\n * set of options from these sections. The object must contain at least one\r\n * of the following `export` properties: `infile`, `instr`, `options`, or `svg`\r\n * to generate a valid image.\r\n *\r\n * @returns {Promise<void>} A Promise that resolves once the single export\r\n * process is completed.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if an error occurs during\r\n * the single export process.\r\n */\r\nexport async function singleExport(options) {\r\n  // Check if the export makes sense\r\n  if (options && options.export) {\r\n    // Perform an export\r\n    await startExport(\r\n      { export: options.export, customLogic: options.customLogic },\r\n      async (error, data) => {\r\n        // Exit process when error exists\r\n        if (error) {\r\n          throw error;\r\n        }\r\n\r\n        // Get the `b64`, `outfile`, and `type` for a chart\r\n        const { b64, outfile, type } = data.options.export;\r\n\r\n        // Save the result\r\n        try {\r\n          if (b64) {\r\n            // As a Base64 string to a txt file\r\n            writeFileSync(\r\n              `${outfile.split('.').shift() || 'chart'}.txt`,\r\n              getBase64(data.result, type)\r\n            );\r\n          } else {\r\n            // As a correct image format\r\n            writeFileSync(\r\n              outfile || `chart.${type}`,\r\n              type !== 'svg' ? Buffer.from(data.result, 'base64') : data.result\r\n            );\r\n          }\r\n        } catch (error) {\r\n          throw new ExportError(\r\n            '[chart] Error while saving a chart.',\r\n            500\r\n          ).setError(error);\r\n        }\r\n\r\n        // Kill pool and close browser after finishing single export\r\n        await killPool();\r\n      }\r\n    );\r\n  } else {\r\n    throw new ExportError(\r\n      '[chart] No expected `export` options were found. Please provide one of the following options: `infile`, `instr`, `options`, or `svg` to generate a valid image.',\r\n      400\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Starts a batch export process for multiple charts based on information\r\n * provided in the `batch` option. The `batch` is a string in the following\r\n * format: \"infile1.json=outfile1.png;infile2.json=outfile2.png;...\". Results\r\n * are saved to the specified output files.\r\n *\r\n * @async\r\n * @function batchExport\r\n *\r\n * @param {Object} options - The `options` object, which should include settings\r\n * from the `export` and `customLogic` sections. It can be a partial or complete\r\n * set of options from these sections. It must contain the `batch` option from\r\n * the `export` section to generate valid images.\r\n *\r\n * @returns {Promise<void>} A Promise that resolves once the batch export\r\n * processes are completed.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if an error occurs during\r\n * any of the batch export process.\r\n */\r\nexport async function batchExport(options) {\r\n  // Check if the export makes sense\r\n  if (options && options.export && options.export.batch) {\r\n    // An array for collecting batch exports\r\n    const batchFunctions = [];\r\n\r\n    // Split and pair the `batch` arguments\r\n    for (let pair of options.export.batch.split(';') || []) {\r\n      pair = pair.split('=');\r\n      if (pair.length === 2) {\r\n        batchFunctions.push(\r\n          startExport(\r\n            {\r\n              export: {\r\n                ...options.export,\r\n                infile: pair[0],\r\n                outfile: pair[1]\r\n              },\r\n              customLogic: options.customLogic\r\n            },\r\n            (error, data) => {\r\n              // Exit process when error exists\r\n              if (error) {\r\n                throw error;\r\n              }\r\n\r\n              // Get the `b64`, `outfile`, and `type` for a chart\r\n              const { b64, outfile, type } = data.options.export;\r\n\r\n              // Save the result\r\n              try {\r\n                if (b64) {\r\n                  // As a Base64 string to a txt file\r\n                  writeFileSync(\r\n                    `${outfile.split('.').shift() || 'chart'}.txt`,\r\n                    getBase64(data.result, type)\r\n                  );\r\n                } else {\r\n                  // As a correct image format\r\n                  writeFileSync(\r\n                    outfile,\r\n                    type !== 'svg'\r\n                      ? Buffer.from(data.result, 'base64')\r\n                      : data.result\r\n                  );\r\n                }\r\n              } catch (error) {\r\n                throw new ExportError(\r\n                  '[chart] Error while saving a chart.',\r\n                  500\r\n                ).setError(error);\r\n              }\r\n            }\r\n          )\r\n        );\r\n      } else {\r\n        log(2, '[chart] No correct pair found for the batch export.');\r\n      }\r\n    }\r\n\r\n    // Await all exports are done\r\n    const batchResults = await Promise.allSettled(batchFunctions);\r\n\r\n    // Kill pool and close browser after finishing batch export\r\n    await killPool();\r\n\r\n    // Log errors if found\r\n    batchResults.forEach((result, index) => {\r\n      // Log the error with stack about the specific batch export\r\n      if (result.reason) {\r\n        logWithStack(\r\n          1,\r\n          result.reason,\r\n          `[chart] Batch export number ${index + 1} could not be correctly completed.`\r\n        );\r\n      }\r\n    });\r\n  } else {\r\n    throw new ExportError(\r\n      '[chart] No expected `export` options were found. Please provide the `batch` option to generate valid images.',\r\n      400\r\n    );\r\n  }\r\n}\r\n\r\n/**\r\n * Starts an export process. The `exportingOptions` parameter is an object that\r\n * should include settings from the `export` and `customLogic` sections. It can\r\n * be a partial or complete set of options from these sections. If partial\r\n * options are provided, missing values will be merged with the current global\r\n * options.\r\n *\r\n * The `endCallback` function is invoked upon the completion of the export,\r\n * either successfully or with an error. The `error` object is provided\r\n * as the first argument, and the `data` object is the second, containing\r\n * the Base64 representation of the chart in the `result` property\r\n * and the complete set of options in the `options` property.\r\n *\r\n * @async\r\n * @function startExport\r\n *\r\n * @param {Object} exportingOptions - The `exportingOptions` object, which\r\n * should include settings from the `export` and `customLogic` sections. It can\r\n * be a partial or complete set of options from these sections. If the provided\r\n * options are partial, missing values will be merged with the current global\r\n * options.\r\n * @param {Function} endCallback - The callback function to be invoked upon\r\n * finalizing the export process or upon encountering an error. The first\r\n * argument is the `error` object, and the second argument is the `data` object,\r\n * which includes the Base64 representation of the chart in the `result`\r\n * property and the full set of options in the `options` property.\r\n *\r\n * @returns {Promise<void>} This function does not return a value directly.\r\n * Instead, it communicates results via the `endCallback`.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if there is a problem with\r\n * processing input of any type. The error is passed into the `endCallback`\r\n * function and processed there.\r\n */\r\nexport async function startExport(exportingOptions, endCallback) {\r\n  try {\r\n    // Check if provided options is an object\r\n    if (!isObject(exportingOptions)) {\r\n      throw new ExportError(\r\n        '[chart] Incorrect value of the provided `exportingOptions`. Needs to be an object.',\r\n        400\r\n      );\r\n    }\r\n\r\n    // Merge additional options to the copy of the instance options\r\n    const options = mergeOptions(deepCopy(getOptions()), {\r\n      export: exportingOptions.export,\r\n      customLogic: exportingOptions.customLogic\r\n    });\r\n\r\n    // Get the `export` options\r\n    const exportOptions = options.export;\r\n\r\n    // Starting exporting process message\r\n    log(4, '[chart] Starting the exporting process.');\r\n\r\n    // Export using options from the file as an input\r\n    if (exportOptions.infile !== null) {\r\n      log(4, '[chart] Attempting to export from a file input.');\r\n\r\n      let fileContent;\r\n      try {\r\n        // Try to read the file to get the string representation\r\n        fileContent = readFileSync(\r\n          getAbsolutePath(exportOptions.infile),\r\n          'utf8'\r\n        );\r\n      } catch (error) {\r\n        throw new ExportError(\r\n          '[chart] Error loading content from a file input.',\r\n          400\r\n        ).setError(error);\r\n      }\r\n\r\n      // Check the file's extension\r\n      if (exportOptions.infile.endsWith('.svg')) {\r\n        try {\r\n          // Set to the `svg` option\r\n          exportOptions.svg = validateOption('svg', fileContent, false);\r\n        } catch (error) {\r\n          logZodIssues(\r\n            1,\r\n            error.issues,\r\n            '[config] The `svg` option validation error'\r\n          );\r\n          throw error;\r\n        }\r\n      } else if (exportOptions.infile.endsWith('.json')) {\r\n        try {\r\n          // Set to the `instr` option\r\n          exportOptions.instr = validateOption('instr', fileContent, false);\r\n        } catch (error) {\r\n          logZodIssues(\r\n            1,\r\n            error.issues,\r\n            '[config] The `instr` option validation error'\r\n          );\r\n          throw error;\r\n        }\r\n      } else {\r\n        throw new ExportError(\r\n          '[chart] Incorrect value of the `infile` option.',\r\n          400\r\n        );\r\n      }\r\n    }\r\n\r\n    // Export using SVG as an input\r\n    if (exportOptions.svg !== null) {\r\n      log(4, '[chart] Attempting to export from an SVG input.');\r\n\r\n      // SVG exports attempts counter\r\n      ++getPoolStats().exportsFromSvgAttempts;\r\n\r\n      // Export from an SVG string\r\n      const result = await _exportFromSvg(\r\n        sanitize(exportOptions.svg), // #209\r\n        options\r\n      );\r\n\r\n      // SVG exports counter\r\n      ++getPoolStats().exportsFromSvg;\r\n\r\n      // Pass SVG export result to the end callback\r\n      return endCallback(null, result);\r\n    }\r\n\r\n    // Export using options as an input\r\n    if (exportOptions.instr !== null || exportOptions.options !== null) {\r\n      log(4, '[chart] Attempting to export from options input.');\r\n\r\n      // Options exports attempts counter\r\n      ++getPoolStats().exportsFromOptionsAttempts;\r\n\r\n      // Export from options\r\n      const result = await _exportFromOptions(\r\n        exportOptions.instr || exportOptions.options,\r\n        options\r\n      );\r\n\r\n      // Options exports counter\r\n      ++getPoolStats().exportsFromOptions;\r\n\r\n      // Pass options export result to the end callback\r\n      return endCallback(null, result);\r\n    }\r\n\r\n    // No input specified, pass an error message to the callback\r\n    return endCallback(\r\n      new ExportError(\r\n        `[chart] No valid input specified. Check if at least one of the following parameters is correctly set: 'infile', 'instr', 'options', or 'svg'.`,\r\n        400\r\n      )\r\n    );\r\n  } catch (error) {\r\n    return endCallback(error);\r\n  }\r\n}\r\n\r\n/**\r\n * Retrieves and returns the current status of the code execution permission.\r\n *\r\n * @function getAllowCodeExecution\r\n *\r\n * @returns {boolean} The value of the global `allowCodeExecution` option.\r\n */\r\nexport function getAllowCodeExecution() {\r\n  return allowCodeExecution;\r\n}\r\n\r\n/**\r\n * Sets the code execution permission based on the provided boolean value.\r\n *\r\n * @function setAllowCodeExecution\r\n *\r\n * @param {boolean} value - The boolean value to be assigned to the global\r\n * `allowCodeExecution` option.\r\n */\r\nexport function setAllowCodeExecution(value) {\r\n  allowCodeExecution = value;\r\n}\r\n\r\n/**\r\n * Exports from an SVG based input with the provided options.\r\n *\r\n * @async\r\n * @function _exportFromSvg\r\n *\r\n * @param {string} inputToExport - The SVG based input to be exported.\r\n * @param {Object} options - The configuration object containing complete set\r\n * of options.\r\n *\r\n * @returns {Promise<unknown>} A Promise that resolves to a result of the export\r\n * process.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if there is not a correct SVG\r\n * input.\r\n */\r\nasync function _exportFromSvg(inputToExport, options) {\r\n  // Check if it is SVG\r\n  if (\r\n    typeof inputToExport === 'string' &&\r\n    (inputToExport.indexOf('<svg') >= 0 || inputToExport.indexOf('<?xml') >= 0)\r\n  ) {\r\n    log(4, '[chart] Parsing input as SVG.');\r\n\r\n    // Set the export input as SVG\r\n    options.export.svg = inputToExport;\r\n\r\n    // Reset the rest of the export input options\r\n    options.export.instr = null;\r\n    options.export.options = null;\r\n\r\n    // Call the function with an SVG string as an export input\r\n    return _prepareExport(options);\r\n  } else {\r\n    throw new ExportError('[chart] Not a correct SVG input.', 400);\r\n  }\r\n}\r\n\r\n/**\r\n * Exports from an options based input with the provided options.\r\n *\r\n * @async\r\n * @function _exportFromOptions\r\n *\r\n * @param {string} inputToExport - The options based input to be exported.\r\n * @param {Object} options - The configuration object containing complete set\r\n * of options.\r\n *\r\n * @returns {Promise<unknown>} A Promise that resolves to a result of the export\r\n * process.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if there is not a correct\r\n * chart options input.\r\n */\r\nasync function _exportFromOptions(inputToExport, options) {\r\n  log(4, '[chart] Parsing input from options.');\r\n\r\n  // Try to check, validate and parse to stringified options\r\n  const stringifiedOptions = isAllowedConfig(\r\n    inputToExport,\r\n    true,\r\n    options.customLogic.allowCodeExecution\r\n  );\r\n\r\n  // Check if a correct stringified options\r\n  if (\r\n    stringifiedOptions === null ||\r\n    typeof stringifiedOptions !== 'string' ||\r\n    !stringifiedOptions.startsWith('{') ||\r\n    !stringifiedOptions.endsWith('}')\r\n  ) {\r\n    throw new ExportError(\r\n      '[chart] Invalid configuration provided - Only options configurations and SVG are allowed for this server. If this is your server, JavaScript custom code can be enabled by starting the server with the `allowCodeExecution` options set to true.',\r\n      403\r\n    );\r\n  }\r\n\r\n  // Set the export input as a stringified chart options\r\n  options.export.instr = stringifiedOptions;\r\n\r\n  // Reset the rest of the export input options\r\n  options.export.svg = null;\r\n\r\n  // Call the function with a stringified chart options\r\n  return _prepareExport(options);\r\n}\r\n\r\n/**\r\n * Function for finalizing options and configurations before export.\r\n *\r\n * @async\r\n * @function _prepareExport\r\n *\r\n * @param {Object} options - The configuration object containing complete set\r\n * of options.\r\n *\r\n * @returns {Promise<unknown>} A Promise that resolves to a result of the export\r\n * process.\r\n */\r\nasync function _prepareExport(options) {\r\n  const { export: exportOptions, customLogic: customLogicOptions } = options;\r\n\r\n  // Prepare the `type` option\r\n  exportOptions.type = fixType(exportOptions.type, exportOptions.outfile);\r\n\r\n  // Prepare the `outfile` option\r\n  exportOptions.outfile = fixOutfile(exportOptions.type, exportOptions.outfile);\r\n\r\n  // Prepare the `constr` option\r\n  exportOptions.constr = fixConstr(exportOptions.constr);\r\n\r\n  // Notify about the custom logic usage status\r\n  log(\r\n    3,\r\n    `[chart] The custom logic is ${customLogicOptions.allowCodeExecution ? 'allowed' : 'disallowed'}.`\r\n  );\r\n\r\n  // Prepare the custom logic options (`customCode`, `callback`, `resources`)\r\n  _handleCustomLogic(customLogicOptions, customLogicOptions.allowCodeExecution);\r\n\r\n  // Prepare the `globalOptions` and `themeOptions` options\r\n  _handleGlobalAndTheme(\r\n    exportOptions,\r\n    customLogicOptions.allowFileResources,\r\n    customLogicOptions.allowCodeExecution\r\n  );\r\n\r\n  // Prepare the `height`, `width`, and `scale` options\r\n  options.export = {\r\n    ...exportOptions,\r\n    ..._findChartSize(exportOptions)\r\n  };\r\n\r\n  // The last strict validation of options right before exporting process\r\n  try {\r\n    // Validate final options\r\n    options = strictValidate(options);\r\n  } catch (error) {\r\n    logZodIssues(1, error.issues, '[config] Final options validation error');\r\n  }\r\n\r\n  // Post the work to the pool\r\n  return postWork(options);\r\n}\r\n\r\n/**\r\n * Calculates the `height`, `width` and `scale` for chart exports based\r\n * on the provided export options.\r\n *\r\n * The function prioritizes values in the following order:\r\n * 1. The `height`, `width`, `scale` from the `exportOptions`.\r\n * 2. Options from the chart configuration (from `exporting` and `chart`).\r\n * 3. Options from the global options (from `exporting` and `chart`).\r\n * 4. Options from the theme options (from `exporting` and `chart` sections).\r\n * 5. Fallback default values (`height = 400`, `width = 600`, `scale = 1`).\r\n *\r\n * @function _findChartSize\r\n *\r\n * @param {Object} exportOptions - The configuration object containing `export`\r\n * options.\r\n *\r\n * @returns {Object} The object containing calculated `height`, `width`\r\n * and `scale` values for the chart export.\r\n */\r\nfunction _findChartSize(exportOptions) {\r\n  // Check the `options` and `instr` for chart and exporting sections\r\n  const { chart: optionsChart, exporting: optionsExporting } =\r\n    exportOptions.options || isAllowedConfig(exportOptions.instr) || false;\r\n\r\n  // Check the `globalOptions` for chart and exporting sections\r\n  const { chart: globalOptionsChart, exporting: globalOptionsExporting } =\r\n    isAllowedConfig(exportOptions.globalOptions) || false;\r\n\r\n  // Check the `themeOptions` for chart and exporting sections\r\n  const { chart: themeOptionsChart, exporting: themeOptionsExporting } =\r\n    isAllowedConfig(exportOptions.themeOptions) || false;\r\n\r\n  // Find the `scale` value:\r\n  // - It cannot be lower than 0.1\r\n  // - It cannot be higher than 5.0\r\n  // - It must be rounded to 2 decimal places (e.g. 0.23234 -> 0.23)\r\n  const scale = roundNumber(\r\n    Math.max(\r\n      0.1,\r\n      Math.min(\r\n        exportOptions.scale ||\r\n          optionsExporting?.scale ||\r\n          globalOptionsExporting?.scale ||\r\n          themeOptionsExporting?.scale ||\r\n          exportOptions.defaultScale ||\r\n          1,\r\n        5.0\r\n      )\r\n    ),\r\n    2\r\n  );\r\n\r\n  // Find the `height` value\r\n  const height =\r\n    exportOptions.height ||\r\n    optionsExporting?.sourceHeight ||\r\n    optionsChart?.height ||\r\n    globalOptionsExporting?.sourceHeight ||\r\n    globalOptionsChart?.height ||\r\n    themeOptionsExporting?.sourceHeight ||\r\n    themeOptionsChart?.height ||\r\n    exportOptions.defaultHeight ||\r\n    400;\r\n\r\n  // Find the `width` value\r\n  const width =\r\n    exportOptions.width ||\r\n    optionsExporting?.sourceWidth ||\r\n    optionsChart?.width ||\r\n    globalOptionsExporting?.sourceWidth ||\r\n    globalOptionsChart?.width ||\r\n    themeOptionsExporting?.sourceWidth ||\r\n    themeOptionsChart?.width ||\r\n    exportOptions.defaultWidth ||\r\n    600;\r\n\r\n  // Gather `height`, `width` and `scale` information in one object\r\n  const size = { height, width, scale };\r\n\r\n  // Get rid of potential `px` and `%`\r\n  for (let [param, value] of Object.entries(size)) {\r\n    size[param] =\r\n      typeof value === 'string' ? +value.replace(/px|%/gi, '') : value;\r\n  }\r\n\r\n  // Return the size object\r\n  return size;\r\n}\r\n\r\n/**\r\n * Handles the execution of custom logic options, including loading `resources`,\r\n * `customCode`, and `callback`. If code execution is allowed, it processes\r\n * the custom logic options accordingly. If code execution is not allowed,\r\n * it disables the usage of resources, custom code and callback.\r\n *\r\n * @function _handleCustomLogic\r\n *\r\n * @param {Object} customLogicOptions - The configuration object containing\r\n * `customLogic` options.\r\n * @param {boolean} allowCodeExecution - A flag indicating whether code\r\n * execution is allowed.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if code execution\r\n * is not allowed but custom logic options are still provided.\r\n */\r\nfunction _handleCustomLogic(customLogicOptions, allowCodeExecution) {\r\n  // In case of allowing code execution\r\n  if (allowCodeExecution) {\r\n    // Process the `resources` option\r\n    if (typeof customLogicOptions.resources === 'string') {\r\n      // Custom stringified resources\r\n      customLogicOptions.resources = _handleResources(\r\n        customLogicOptions.resources,\r\n        customLogicOptions.allowFileResources,\r\n        true\r\n      );\r\n    } else if (!customLogicOptions.resources) {\r\n      try {\r\n        // Load the default one\r\n        customLogicOptions.resources = _handleResources(\r\n          readFileSync(getAbsolutePath('resources.json'), 'utf8'),\r\n          customLogicOptions.allowFileResources,\r\n          true\r\n        );\r\n      } catch (error) {\r\n        log(2, '[chart] Unable to load the default `resources.json` file.');\r\n      }\r\n    }\r\n\r\n    // Process the `customCode` option\r\n    try {\r\n      // Try to load custom code and wrap around it in a self invoking function\r\n      customLogicOptions.customCode = wrapAround(\r\n        customLogicOptions.customCode,\r\n        customLogicOptions.allowFileResources\r\n      );\r\n    } catch (error) {\r\n      logWithStack(2, error, '[chart] The `customCode` cannot be loaded.');\r\n\r\n      // In case of an error, set the option with null\r\n      customLogicOptions.customCode = null;\r\n    }\r\n\r\n    // Process the `callback` option\r\n    try {\r\n      // Try to load callback function\r\n      customLogicOptions.callback = wrapAround(\r\n        customLogicOptions.callback,\r\n        customLogicOptions.allowFileResources,\r\n        true\r\n      );\r\n    } catch (error) {\r\n      logWithStack(2, error, '[chart] The `callback` cannot be loaded.');\r\n\r\n      // In case of an error, set the option with null\r\n      customLogicOptions.callback = null;\r\n    }\r\n\r\n    // Check if there is the `customCode` present\r\n    if ([null, undefined].includes(customLogicOptions.customCode)) {\r\n      log(3, '[chart] No value for the `customCode` option found.');\r\n    }\r\n\r\n    // Check if there is the `callback` present\r\n    if ([null, undefined].includes(customLogicOptions.callback)) {\r\n      log(3, '[chart] No value for the `callback` option found.');\r\n    }\r\n\r\n    // Check if there is the `resources` present\r\n    if ([null, undefined].includes(customLogicOptions.resources)) {\r\n      log(3, '[chart] No value for the `resources` option found.');\r\n    }\r\n  } else {\r\n    // If the `allowCodeExecution` flag is set to false, we should refuse\r\n    // the usage of the `callback`, `resources`, and `customCode` options.\r\n    // Additionally, the worker will refuse to run arbitrary JavaScript.\r\n    if (\r\n      customLogicOptions.callback ||\r\n      customLogicOptions.resources ||\r\n      customLogicOptions.customCode\r\n    ) {\r\n      // Reset all custom code options\r\n      customLogicOptions.callback = null;\r\n      customLogicOptions.resources = null;\r\n      customLogicOptions.customCode = null;\r\n\r\n      // Send a message saying that the exporter does not support these settings\r\n      throw new ExportError(\r\n        `[chart] The 'callback', 'resources', and 'customCode' options have been disabled for this server.`,\r\n        403\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Handles and validates resources from the `resources` option for export.\r\n *\r\n * @function _handleResources\r\n *\r\n * @param {(Object|string|null)} [resources=null] - The resources to be handled.\r\n * Can be either a JSON object, stringified JSON, a path to a JSON file,\r\n * or null. The default value is `null`.\r\n * @param {boolean} allowFileResources - A flag indicating whether loading\r\n * resources from files is allowed.\r\n * @param {boolean} allowCodeExecution - A flag indicating whether code\r\n * execution is allowed.\r\n *\r\n * @returns {(Object|null)} The handled resources or null if no valid resources\r\n * are found.\r\n */\r\nfunction _handleResources(\r\n  resources = null,\r\n  allowFileResources,\r\n  allowCodeExecution\r\n) {\r\n  // List of allowed sections in the resources JSON\r\n  const allowedProps = ['js', 'css', 'files'];\r\n\r\n  let handledResources = resources;\r\n  let correctResources = false;\r\n\r\n  // Try to load resources from a file\r\n  if (allowFileResources && resources.endsWith('.json')) {\r\n    try {\r\n      handledResources = isAllowedConfig(\r\n        readFileSync(getAbsolutePath(resources), 'utf8'),\r\n        false,\r\n        allowCodeExecution\r\n      );\r\n    } catch {\r\n      return null;\r\n    }\r\n  } else {\r\n    // Try to get JSON\r\n    handledResources = isAllowedConfig(resources, false, allowCodeExecution);\r\n\r\n    // Get rid of the files section\r\n    if (handledResources && !allowFileResources) {\r\n      delete handledResources.files;\r\n    }\r\n  }\r\n\r\n  // Filter from unnecessary properties\r\n  for (const propName in handledResources) {\r\n    if (!allowedProps.includes(propName)) {\r\n      delete handledResources[propName];\r\n    } else if (!correctResources) {\r\n      correctResources = true;\r\n    }\r\n  }\r\n\r\n  // Check if at least one of allowed properties is present\r\n  if (!correctResources) {\r\n    return null;\r\n  }\r\n\r\n  // Handle files section\r\n  if (handledResources.files) {\r\n    handledResources.files = handledResources.files.map((item) => item.trim());\r\n    if (!handledResources.files || handledResources.files.length <= 0) {\r\n      delete handledResources.files;\r\n    }\r\n  }\r\n\r\n  // Return resources\r\n  return handledResources;\r\n}\r\n\r\n/**\r\n * Handles the loading and validation of the `globalOptions` and `themeOptions`\r\n * in the export options. If the option is a string and references a JSON file\r\n * (when the `allowFileResources` is true), it reads and parses the file.\r\n * Otherwise, it attempts to parse the string or object as JSON. If any errors\r\n * occur during this process, the option is set to null. If there is an error\r\n * loading or parsing the `globalOptions` or `themeOptions`, the error is logged\r\n * and the option is set to null.\r\n *\r\n * @function _handleGlobalAndTheme\r\n *\r\n * @param {Object} exportOptions - The configuration object containing `export`\r\n * options.\r\n * @param {boolean} allowFileResources - A flag indicating whether loading\r\n * resources from files is allowed.\r\n * @param {boolean} allowCodeExecution - A flag indicating whether code\r\n * execution is allowed.\r\n */\r\nfunction _handleGlobalAndTheme(\r\n  exportOptions,\r\n  allowFileResources,\r\n  allowCodeExecution\r\n) {\r\n  // Check the `globalOptions` and `themeOptions` options\r\n  ['globalOptions', 'themeOptions'].forEach((optionsName) => {\r\n    try {\r\n      // Check if the option exists\r\n      if (exportOptions[optionsName]) {\r\n        // Check if it is a string and a file name with the `.json` extension\r\n        if (\r\n          allowFileResources &&\r\n          typeof exportOptions[optionsName] === 'string' &&\r\n          exportOptions[optionsName].endsWith('.json')\r\n        ) {\r\n          // Check if the file content can be a config, and save it as a string\r\n          exportOptions[optionsName] = isAllowedConfig(\r\n            readFileSync(getAbsolutePath(exportOptions[optionsName]), 'utf8'),\r\n            true,\r\n            allowCodeExecution\r\n          );\r\n        } else {\r\n          // Check if the value can be a config, and save it as a string\r\n          exportOptions[optionsName] = isAllowedConfig(\r\n            exportOptions[optionsName],\r\n            true,\r\n            allowCodeExecution\r\n          );\r\n        }\r\n      }\r\n    } catch (error) {\r\n      logWithStack(\r\n        2,\r\n        error,\r\n        `[chart] The \\`${optionsName}\\` cannot be loaded.`\r\n      );\r\n\r\n      // In case of an error, set the option with null\r\n      exportOptions[optionsName] = null;\r\n    }\r\n  });\r\n\r\n  // Check if there is the `globalOptions` present\r\n  if ([null, undefined].includes(exportOptions.globalOptions)) {\r\n    log(3, '[chart] No value for the `globalOptions` option found.');\r\n  }\r\n\r\n  // Check if there is the `themeOptions` present\r\n  if ([null, undefined].includes(exportOptions.themeOptions)) {\r\n    log(3, '[chart] No value for the `themeOptions` option found.');\r\n  }\r\n}\r\n\r\nexport default {\r\n  singleExport,\r\n  batchExport,\r\n  startExport,\r\n  getAllowCodeExecution,\r\n  setAllowCodeExecution\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview This module provides utility functions for managing intervals\r\n * and timeouts in a centralized manner. It maintains a registry of all active\r\n * timers and allows for their efficient cleanup when needed. This can be useful\r\n * in applications where proper resource management and clean shutdown of timers\r\n * are critical to avoid memory leaks or unintended behavior.\r\n */\r\n\r\nimport { log } from './logger.js';\r\n\r\n// Array that contains ids of all ongoing intervals and timeouts\r\nconst timerIds = [];\r\n\r\n/**\r\n * Adds id of the `setInterval` or `setTimeout` and to the `timerIds` array.\r\n *\r\n * @function addTimer\r\n *\r\n * @param {NodeJS.Timeout} id - Id of an interval or a timeout.\r\n */\r\nexport function addTimer(id) {\r\n  timerIds.push(id);\r\n}\r\n\r\n/**\r\n * Clears all of ongoing intervals and timeouts by ids gathered\r\n * in the `timerIds` array.\r\n *\r\n * @function clearAllTimers\r\n */\r\nexport function clearAllTimers() {\r\n  log(4, `[timer] Clearing all registered intervals and timeouts.`);\r\n  for (const id of timerIds) {\r\n    clearInterval(id);\r\n    clearTimeout(id);\r\n  }\r\n}\r\n\r\nexport default {\r\n  addTimer,\r\n  clearAllTimers\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Provides middleware functions for logging errors with stack traces\r\n * and handling error responses in an Express application.\r\n */\r\n\r\nimport { getOptions } from '../../config.js';\r\nimport { logWithStack } from '../../logger.js';\r\n\r\n/**\r\n * Middleware for logging errors with stack trace and handling error response.\r\n *\r\n * @function logErrorMiddleware\r\n *\r\n * @param {Error} error - The error object.\r\n * @param {Express.Request} request - The Express request object.\r\n * @param {Express.Response} response - The Express response object.\r\n * @param {Function} next - The next middleware function.\r\n *\r\n * @returns {undefined} The call to the next middleware function with\r\n * the passed error.\r\n */\r\nfunction logErrorMiddleware(error, request, response, next) {\r\n  // Display the error with stack in a correct format\r\n  logWithStack(1, error);\r\n\r\n  // Delete the stack for the environment other than the development\r\n  if (getOptions().other.nodeEnv !== 'development') {\r\n    delete error.stack;\r\n  }\r\n\r\n  // Call the `returnErrorMiddleware` middleware\r\n  return next(error);\r\n}\r\n\r\n/**\r\n * Middleware for returning error response.\r\n *\r\n * @function returnErrorMiddleware\r\n *\r\n * @param {Error} error - The error object.\r\n * @param {Express.Request} request - The Express request object.\r\n * @param {Express.Response} response - The Express response object.\r\n * @param {Function} next - The next middleware function.\r\n */\r\nfunction returnErrorMiddleware(error, request, response, next) {\r\n  // Gather all requied information for the response\r\n  const { message, stack } = error;\r\n\r\n  // Use the error's status code or the default 400\r\n  const statusCode = error.statusCode || 400;\r\n\r\n  // Set and return response\r\n  response.status(statusCode).json({ statusCode, message, stack });\r\n}\r\n\r\n/**\r\n * Adds the error middlewares to the passed express app instance.\r\n *\r\n * @param {Express} app - The Express app instance.\r\n */\r\nexport default function errorMiddleware(app) {\r\n  // Add log error middleware\r\n  app.use(logErrorMiddleware);\r\n\r\n  // Add set status and return error middleware\r\n  app.use(returnErrorMiddleware);\r\n}\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Provides middleware functions for configuring and enabling rate\r\n * limiting in an Express application.\r\n */\r\n\r\nimport rateLimit from 'express-rate-limit';\r\n\r\nimport { log } from '../../logger.js';\r\n\r\nimport ExportError from '../../errors/ExportError.js';\r\n\r\n/**\r\n * Middleware for enabling rate limiting on the specified Express app.\r\n *\r\n * @param {Express} app - The Express app instance.\r\n *\r\n * @param {Object} rateLimitingOptions - The configuration object containing\r\n * `rateLimiting` options.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if could not configure and set\r\n * the rate limiting options.\r\n */\r\nexport default function rateLimitingMiddleware(app, rateLimitingOptions) {\r\n  try {\r\n    // Check if the rate limiting is enabled\r\n    if (rateLimitingOptions.enable) {\r\n      const message =\r\n        'Too many requests, you have been rate limited. Please try again later.';\r\n\r\n      // Options for the rate limiter\r\n      const rateOptions = {\r\n        window: rateLimitingOptions.window || 1,\r\n        maxRequests: rateLimitingOptions.maxRequests || 30,\r\n        delay: rateLimitingOptions.delay || 0,\r\n        trustProxy: rateLimitingOptions.trustProxy || false,\r\n        skipKey: rateLimitingOptions.skipKey || null,\r\n        skipToken: rateLimitingOptions.skipToken || null\r\n      };\r\n\r\n      // Set if behind a proxy\r\n      if (rateOptions.trustProxy) {\r\n        app.enable('trust proxy');\r\n      }\r\n\r\n      // Create a limiter\r\n      const limiter = rateLimit({\r\n        // Time frame for which requests are checked and remembered\r\n        windowMs: rateOptions.window * 60 * 1000,\r\n        // Limit each IP to 100 requests per `windowMs`\r\n        limit: rateOptions.maxRequests,\r\n        // Disable delaying, full speed until the max limit is reached\r\n        delayMs: rateOptions.delay,\r\n        handler: (request, response) => {\r\n          response.format({\r\n            json: () => {\r\n              response.status(429).send({ message });\r\n            },\r\n            default: () => {\r\n              response.status(429).send(message);\r\n            }\r\n          });\r\n        },\r\n        skip: (request) => {\r\n          // Allow bypassing the limiter if a valid key/token has been sent\r\n          if (\r\n            rateOptions.skipKey !== null &&\r\n            rateOptions.skipToken !== null &&\r\n            request.query.key === rateOptions.skipKey &&\r\n            request.query.access_token === rateOptions.skipToken\r\n          ) {\r\n            log(4, '[rate limiting] Skipping rate limiter.');\r\n            return true;\r\n          }\r\n          return false;\r\n        }\r\n      });\r\n\r\n      // Use a limiter as a middleware\r\n      app.use(limiter);\r\n\r\n      log(\r\n        3,\r\n        `[rate limiting] Enabled rate limiting with ${rateOptions.maxRequests} requests per ${rateOptions.window} minute for each IP, trusting proxy: ${rateOptions.trustProxy}.`\r\n      );\r\n    }\r\n  } catch (error) {\r\n    throw new ExportError(\r\n      '[rate limiting] Could not configure and set the rate limiting options.',\r\n      500\r\n    ).setError(error);\r\n  }\r\n}\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Provides middleware functions for validating incoming HTTP requests\r\n * in an Express application. This module ensures that requests contain\r\n * appropriate content types and valid request bodies, including proper JSON\r\n * structures and chart data for exports. It checks for potential issues such\r\n * as missing or malformed data, private range URLs in SVG payloads, and allows\r\n * for flexible options validation. The middleware logs detailed information\r\n * and handles errors related to incorrect payloads, chart data, and private URL\r\n * usage.\r\n */\r\n\r\nimport { v4 as uuid } from 'uuid';\r\n\r\nimport { getAllowCodeExecution } from '../../chart.js';\r\nimport { isAllowedConfig } from '../../config.js';\r\nimport { log, logZodIssues } from '../../logger.js';\r\nimport {\r\n  fixConstr,\r\n  fixType,\r\n  isObjectEmpty,\r\n  isPrivateRangeUrlFound\r\n} from '../../utils.js';\r\nimport { looseValidate } from '../../validation.js';\r\n\r\nimport ExportError from '../../errors/ExportError.js';\r\n\r\n/**\r\n * Middleware for validating the content-type header.\r\n *\r\n * @function contentTypeMiddleware\r\n *\r\n * @param {Express.Request} request - The Express request object.\r\n * @param {Express.Response} response - The Express response object.\r\n * @param {Function} next - The next middleware function.\r\n *\r\n * @returns {undefined} The call to the next middleware function.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if the content-type\r\n * is not correct.\r\n */\r\nfunction contentTypeMiddleware(request, response, next) {\r\n  try {\r\n    // Get the content type header\r\n    const contentType = request.headers['content-type'] || '';\r\n\r\n    // Allow only JSON, URL-encoded and form data without files types of data\r\n    if (\r\n      !contentType.includes('application/json') &&\r\n      !contentType.includes('application/x-www-form-urlencoded') &&\r\n      !contentType.includes('multipart/form-data')\r\n    ) {\r\n      throw new ExportError(\r\n        '[validation] Content-Type must be application/json, application/x-www-form-urlencoded, or multipart/form-data.',\r\n        415\r\n      );\r\n    }\r\n\r\n    // Call the `requestBodyMiddleware` middleware\r\n    return next();\r\n  } catch (error) {\r\n    return next(error);\r\n  }\r\n}\r\n\r\n/**\r\n * Middleware for validating the request's body.\r\n *\r\n * @function requestBodyMiddleware\r\n *\r\n * @param {Express.Request} request - The Express request object.\r\n * @param {Express.Response} response - The Express response object.\r\n * @param {Function} next - The next middleware function.\r\n *\r\n * @returns {undefined} The call to the next middleware function.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if the body is not correct.\r\n * @throws {ExportError} Throws an `ExportError` if the chart data from the body\r\n * is not correct.\r\n * @throws {ExportError} Throws an `ExportError` in case of the private range\r\n * url error.\r\n */\r\nfunction requestBodyMiddleware(request, response, next) {\r\n  try {\r\n    // Get the request body\r\n    const body = request.body;\r\n\r\n    // Create a unique ID for a request\r\n    const requestId = uuid();\r\n\r\n    // Throw an error if there is no correct body\r\n    if (!body || isObjectEmpty(body)) {\r\n      log(\r\n        2,\r\n        `[validation] Request [${requestId}] - The request from ${\r\n          request.headers['x-forwarded-for'] || request.connection.remoteAddress\r\n        } was incorrect. Received payload is empty.`\r\n      );\r\n\r\n      throw new ExportError(\r\n        `[validation] Request [${requestId}] - The request body is required. Please ensure that your Content-Type header is correct. Accepted types are 'application/json' and 'multipart/form-data'.`,\r\n        400\r\n      );\r\n    }\r\n\r\n    // Get the `allowCodeExecution` option for the server\r\n    const allowCodeExecution = getAllowCodeExecution();\r\n\r\n    // Find a correct chart options\r\n    const instr = isAllowedConfig(\r\n      // Use one of the below\r\n      body.instr || body.options || body.infile || body.data,\r\n      // Stringify options\r\n      true,\r\n      // Allow or disallow functions\r\n      allowCodeExecution\r\n    );\r\n\r\n    // Throw an error if there is no correct chart data\r\n    if (instr === null && !body.svg) {\r\n      log(\r\n        2,\r\n        `[validation] Request [${requestId}] - The request from ${\r\n          request.headers['x-forwarded-for'] || request.connection.remoteAddress\r\n        } was incorrect. Received payload is missing correct chart data for export: ${JSON.stringify(body)}.`\r\n      );\r\n\r\n      throw new ExportError(\r\n        `Request [${requestId}] - [validation] No correct chart data found. Ensure that you are using either application/json or multipart/form-data headers. If sending JSON, make sure the chart data is in the 'infile', 'options', or 'data' attribute. If sending SVG, ensure it is in the 'svg' attribute.`,\r\n        400\r\n      );\r\n    }\r\n\r\n    // Throw an error if test of xlink:href elements from payload's SVG fails\r\n    if (body.svg && isPrivateRangeUrlFound(body.svg)) {\r\n      throw new ExportError(\r\n        `Request [${requestId}] - [validation] SVG potentially contain at least one forbidden URL in 'xlink:href' element. Please review the SVG content and ensure that all referenced URLs comply with security policies.`,\r\n        400\r\n      );\r\n    }\r\n\r\n    try {\r\n      // Validate options from the body and store parsed structure in the request\r\n      request.validatedOptions = looseValidate({\r\n        // Set the created ID as a `_requestId` property in the validated options\r\n        _requestId: requestId,\r\n        export: {\r\n          instr,\r\n          svg: body.svg,\r\n          outfile:\r\n            body.outfile ||\r\n            `${request.params.filename || 'chart'}.${fixType(body.type)}`,\r\n          type: fixType(body.type, body.outfile),\r\n          constr: fixConstr(body.constr),\r\n          b64: body.b64,\r\n          noDownload: body.noDownload,\r\n          height: body.height,\r\n          width: body.width,\r\n          scale: body.scale,\r\n          globalOptions: isAllowedConfig(\r\n            body.globalOptions,\r\n            true,\r\n            allowCodeExecution\r\n          ),\r\n          themeOptions: isAllowedConfig(\r\n            body.themeOptions,\r\n            true,\r\n            allowCodeExecution\r\n          )\r\n        },\r\n        customLogic: {\r\n          allowCodeExecution,\r\n          allowFileResources: false,\r\n          customCode: body.customCode,\r\n          callback: body.callback,\r\n          resources: isAllowedConfig(body.resources, true, allowCodeExecution)\r\n        }\r\n      });\r\n    } catch (error) {\r\n      logZodIssues(\r\n        1,\r\n        error.issues,\r\n        '[config] Request options validation error'\r\n      );\r\n\r\n      throw new ExportError(\r\n        'The provided options are not correct. Please check if your data is of the correct types.',\r\n        400\r\n      );\r\n    }\r\n\r\n    // Call the next middleware\r\n    return next();\r\n  } catch (error) {\r\n    return next(error);\r\n  }\r\n}\r\n\r\n/**\r\n * Adds the validation middlewares to the passed express app instance.\r\n *\r\n * @param {Express} app - The Express app instance.\r\n */\r\nexport default function validationMiddleware(app) {\r\n  // Add content type validation middleware\r\n  app.post(['/', '/:filename'], contentTypeMiddleware);\r\n\r\n  // Add request body request validation middleware\r\n  app.post(['/', '/:filename'], requestBodyMiddleware);\r\n}\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Defines the export routes and logic for handling chart export\r\n * requests in an Express server. This module processes incoming requests\r\n * to export charts in various formats (e.g. JPEG, PNG, PDF, SVG). It integrates\r\n * with Highcharts' core functionalities and supports both immediate download\r\n * responses and Base64-encoded content returns. The code also features\r\n * benchmarking for performance monitoring.\r\n */\r\n\r\nimport { startExport } from '../../chart.js';\r\nimport { log } from '../../logger.js';\r\nimport { getBase64, measureTime } from '../../utils.js';\r\n\r\nimport ExportError from '../../errors/ExportError.js';\r\n\r\n// Reversed MIME types\r\nconst reversedMime = {\r\n  png: 'image/png',\r\n  jpeg: 'image/jpeg',\r\n  gif: 'image/gif',\r\n  pdf: 'application/pdf',\r\n  svg: 'image/svg+xml'\r\n};\r\n\r\n/**\r\n * Handles the export requests from the client.\r\n *\r\n * @async\r\n * @function requestExport\r\n *\r\n * @param {Express.Request} request - The Express request object.\r\n * @param {Express.Response} response - The Express response object.\r\n * @param {Function} next - The next middleware function.\r\n *\r\n * @returns {Promise<void>} A Promise that resolves once the export process\r\n * is complete.\r\n */\r\nasync function requestExport(request, response, next) {\r\n  try {\r\n    // Start counting time for a request\r\n    const requestCounter = measureTime();\r\n\r\n    // In case the connection is closed, force to abort further actions\r\n    let connectionAborted = false;\r\n    request.socket.on('close', (hadErrors) => {\r\n      if (hadErrors) {\r\n        connectionAborted = true;\r\n      }\r\n    });\r\n\r\n    // Get the options previously validated in the validation middleware\r\n    const requestOptions = request.validatedOptions;\r\n\r\n    // Get the request id\r\n    const requestId = requestOptions.requestId;\r\n\r\n    // Info about an incoming request with correct data\r\n    log(4, `[export] Request [${requestId}] - Got an incoming HTTP request.`);\r\n\r\n    // Start the export process\r\n    await startExport(requestOptions, (error, data) => {\r\n      // Remove the close event from the socket\r\n      request.socket.removeAllListeners('close');\r\n\r\n      // If the connection was closed, do nothing\r\n      if (connectionAborted) {\r\n        log(\r\n          3,\r\n          `[export] Request [${requestId}] - The client closed the connection before the chart finished processing.`\r\n        );\r\n        return;\r\n      }\r\n\r\n      // If error, log it and send it to the error middleware\r\n      if (error) {\r\n        throw error;\r\n      }\r\n\r\n      // If data is missing, log the message and send it to the error middleware\r\n      if (!data || !data.result) {\r\n        log(\r\n          2,\r\n          `[export] Request [${requestId}] - Request from ${\r\n            request.headers['x-forwarded-for'] ||\r\n            request.connection.remoteAddress\r\n          } was incorrect. Received result is ${data.result}.`\r\n        );\r\n\r\n        throw new ExportError(\r\n          `[export] Request [${requestId}] - Unexpected return of the export result from the chart generation. Please check your request data.`,\r\n          400\r\n        );\r\n      }\r\n\r\n      // Return the result in an appropriate format\r\n      if (data.result) {\r\n        log(\r\n          3,\r\n          `[export] Request [${requestId}] - The whole exporting process took ${requestCounter()}ms.`\r\n        );\r\n\r\n        // Get the `type`, `b64`, `noDownload`, and `outfile` from options\r\n        const { type, b64, noDownload, outfile } = data.options.export;\r\n\r\n        // If only Base64 is required, return it\r\n        if (b64) {\r\n          return response.send(getBase64(data.result, type));\r\n        }\r\n\r\n        // Set correct content type\r\n        response.header('Content-Type', reversedMime[type] || 'image/png');\r\n\r\n        // Decide whether to download or not chart file\r\n        if (!noDownload) {\r\n          response.attachment(outfile);\r\n        }\r\n\r\n        // If SVG, return plain content, otherwise a b64 string from a buffer\r\n        return type === 'svg'\r\n          ? response.send(data.result)\r\n          : response.send(Buffer.from(data.result, 'base64'));\r\n      }\r\n    });\r\n  } catch (error) {\r\n    return next(error);\r\n  }\r\n}\r\n\r\n/**\r\n * Adds the `export` routes.\r\n *\r\n * @function exportRoutes\r\n *\r\n * @param {Express} app - The Express app instance.\r\n */\r\nexport default function exportRoutes(app) {\r\n  /**\r\n   * Adds the POST '/' - A route for handling POST requests at the root\r\n   * endpoint.\r\n   */\r\n  app.post('/', requestExport);\r\n\r\n  /**\r\n   * Adds the POST '/:filename' - A route for handling POST requests with\r\n   * a specified filename parameter.\r\n   */\r\n  app.post('/:filename', requestExport);\r\n}\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Defines an Express route for server health monitoring, including\r\n * uptime, success rates, and other server statistics.\r\n */\r\n\r\nimport { readFileSync } from 'fs';\r\nimport { join } from 'path';\r\n\r\nimport { getHighchartsVersion } from '../../cache.js';\r\nimport { log } from '../../logger.js';\r\nimport { getPoolStats, getPoolInfoJSON } from '../../pool.js';\r\nimport { addTimer } from '../../timer.js';\r\nimport { __dirname, getNewDateTime } from '../../utils.js';\r\n\r\n// Set the start date of the server\r\nconst serverStartTime = new Date();\r\n\r\n// Get the `package.json` content\r\nconst packageFile = JSON.parse(\r\n  readFileSync(join(__dirname, 'package.json'), 'utf8')\r\n);\r\n\r\n// An array for success rate ratios\r\nconst successRates = [];\r\n\r\n// Record every minute\r\nconst recordInterval = 60 * 1000;\r\n\r\n// 30 minutes\r\nconst windowSize = 30;\r\n\r\n/**\r\n * Calculates moving average indicator based on the data from the `successRates`\r\n * array.\r\n *\r\n * @function _calculateMovingAverage\r\n *\r\n * @returns {number} A moving average for success ratio of the server exports.\r\n */\r\nfunction _calculateMovingAverage() {\r\n  return successRates.reduce((a, b) => a + b, 0) / successRates.length;\r\n}\r\n\r\n/**\r\n * Starts the interval responsible for calculating current success rate ratio\r\n * and collects records to the `successRates` array.\r\n *\r\n * @function _startSuccessRate\r\n *\r\n * @returns {NodeJS.Timeout} Id of an interval.\r\n */\r\nfunction _startSuccessRate() {\r\n  return setInterval(() => {\r\n    const stats = getPoolStats();\r\n    const successRatio =\r\n      stats.exportsAttempted === 0\r\n        ? 1\r\n        : (stats.exportsPerformed / stats.exportsAttempted) * 100;\r\n\r\n    successRates.push(successRatio);\r\n    if (successRates.length > windowSize) {\r\n      successRates.shift();\r\n    }\r\n  }, recordInterval);\r\n}\r\n\r\n/**\r\n * Adds the `health` routes.\r\n *\r\n * @function healthRoutes\r\n *\r\n * @param {Express} app - The Express app instance.\r\n */\r\nexport default function healthRoutes(app) {\r\n  // Start processing success rate ratio interval and save its id to the array\r\n  // for the graceful clearing on shutdown with injected `addTimer` funtion\r\n  addTimer(_startSuccessRate());\r\n\r\n  /**\r\n   * Adds the GET '/health' - A route for getting the basic stats of the server.\r\n   */\r\n  app.get('/health', (request, response, next) => {\r\n    try {\r\n      log(4, '[health] Returning server health.');\r\n\r\n      const stats = getPoolStats();\r\n      const period = successRates.length;\r\n      const movingAverage = _calculateMovingAverage();\r\n\r\n      // Send the server's statistics\r\n      response.send({\r\n        // Status and times\r\n        status: 'OK',\r\n        bootTime: serverStartTime,\r\n        uptime: `${Math.floor((getNewDateTime() - serverStartTime.getTime()) / 1000 / 60)} minutes`,\r\n\r\n        // Versions\r\n        serverVersion: packageFile.version,\r\n        highchartsVersion: getHighchartsVersion(),\r\n\r\n        // Exports\r\n        averageExportTime: stats.timeSpentAverage,\r\n        attemptedExports: stats.exportsAttempted,\r\n        performedExports: stats.exportsPerformed,\r\n        failedExports: stats.exportsDropped,\r\n        sucessRatio: (stats.exportsPerformed / stats.exportsAttempted) * 100,\r\n\r\n        // Pool\r\n        pool: getPoolInfoJSON(),\r\n\r\n        // Moving average\r\n        period,\r\n        movingAverage,\r\n        message:\r\n          isNaN(movingAverage) || !successRates.length\r\n            ? 'Too early to report. No exports made yet. Please check back soon.'\r\n            : `Last ${period} minutes had a success rate of ${movingAverage.toFixed(2)}%.`,\r\n\r\n        // SVG and JSON exports\r\n        svgExports: stats.exportsFromSvg,\r\n        jsonExports: stats.exportsFromOptions,\r\n        svgExportsAttempts: stats.exportsFromSvgAttempts,\r\n        jsonExportsAttempts: stats.exportsFromOptionsAttempts\r\n      });\r\n    } catch (error) {\r\n      return next(error);\r\n    }\r\n  });\r\n}\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Defines an Express route for serving the UI for the export server\r\n * when enabled.\r\n */\r\n\r\nimport { join } from 'path';\r\n\r\nimport { getOptions } from '../../config.js';\r\nimport { log } from '../../logger.js';\r\nimport { __dirname } from '../../utils.js';\r\n\r\n/**\r\n * Adds the `ui` routes.\r\n *\r\n * @function uiRoutes\r\n *\r\n * @param {Express} app - The Express app instance.\r\n */\r\nexport default function uiRoutes(app) {\r\n  /**\r\n   * Adds the GET '/' - A route for a UI when enabled on the export server.\r\n   */\r\n  app.get(getOptions().ui.route || '/', (request, response, next) => {\r\n    try {\r\n      log(4, '[ui] Returning UI for the export.');\r\n\r\n      response.sendFile(join(__dirname, 'public', 'index.html'), {\r\n        acceptRanges: false\r\n      });\r\n    } catch (error) {\r\n      return next(error);\r\n    }\r\n  });\r\n}\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Defines an Express route for updating the Highcharts version\r\n * on the server, with authentication and validation.\r\n */\r\n\r\nimport { updateHighchartsVersion, getHighchartsVersion } from '../../cache.js';\r\nimport { log } from '../../logger.js';\r\nimport { envs } from '../../validation.js';\r\n\r\nimport ExportError from '../../errors/ExportError.js';\r\n\r\n/**\r\n * Adds the `version_change` routes.\r\n *\r\n * @function versionChangeRoutes\r\n *\r\n * @param {Express} app - The Express app instance.\r\n */\r\nexport default function versionChangeRoutes(app) {\r\n  /**\r\n   * Adds the POST '/version_change/:newVersion' - A route for changing\r\n   * the Highcharts version on the server.\r\n   */\r\n  app.post('/version_change/:newVersion', async (request, response, next) => {\r\n    try {\r\n      log(4, '[version] Changing Highcharts version.');\r\n\r\n      // Get the token directly from envs\r\n      const adminToken = envs.HIGHCHARTS_ADMIN_TOKEN;\r\n\r\n      // Check the existence of the token\r\n      if (!adminToken || !adminToken.length) {\r\n        throw new ExportError(\r\n          '[version] The server is not configured to perform run-time version changes: HIGHCHARTS_ADMIN_TOKEN is not set.',\r\n          401\r\n        );\r\n      }\r\n\r\n      // Get the token from the hc-auth header\r\n      const token = request.get('hc-auth');\r\n\r\n      // Check if the hc-auth header contain a correct token\r\n      if (!token || token !== adminToken) {\r\n        throw new ExportError(\r\n          '[version] Invalid or missing token: Set the token in the hc-auth header.',\r\n          401\r\n        );\r\n      }\r\n\r\n      // Compare versions\r\n      let newVersion = request.params.newVersion;\r\n      if (newVersion) {\r\n        try {\r\n          // Update version\r\n          await updateHighchartsVersion(newVersion);\r\n        } catch (error) {\r\n          throw new ExportError(\r\n            `[version] Version change: ${error.message}`,\r\n            400\r\n          ).setError(error);\r\n        }\r\n\r\n        // Success\r\n        response.status(200).send({\r\n          statusCode: 200,\r\n          highchartsVersion: getHighchartsVersion(),\r\n          message: `Successfully updated Highcharts to version: ${newVersion}.`\r\n        });\r\n      } else {\r\n        // No version specified\r\n        throw new ExportError('[version] No new version supplied.', 400);\r\n      }\r\n    } catch (error) {\r\n      return next(error);\r\n    }\r\n  });\r\n}\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview A module that sets up and manages HTTP and HTTPS servers\r\n * for the Highcharts Export Server. It handles server initialization,\r\n * configuration, error handling, middleware setup, route definition, and rate\r\n * limiting. The module exports functions to start, stop, and manage server\r\n * instances, as well as utility functions for defining routes and attaching\r\n * middlewares.\r\n */\r\n\r\nimport { readFile } from 'fs/promises';\r\nimport { join } from 'path';\r\n\r\nimport cors from 'cors';\r\nimport express from 'express';\r\nimport http from 'http';\r\nimport https from 'https';\r\nimport multer from 'multer';\r\n\r\nimport { updateOptions } from '../config.js';\r\nimport { log, logWithStack } from '../logger.js';\r\nimport { __dirname, getAbsolutePath } from '../utils.js';\r\n\r\nimport errorMiddleware from './middlewares/error.js';\r\nimport rateLimitingMiddleware from './middlewares/rateLimiting.js';\r\nimport validationMiddleware from './middlewares/validation.js';\r\n\r\nimport exportRoutes from './routes/export.js';\r\nimport healthRoutes from './routes/health.js';\r\nimport uiRoutes from './routes/ui.js';\r\nimport versionChangeRoutes from './routes/versionChange.js';\r\n\r\nimport ExportError from '../errors/ExportError.js';\r\n\r\n// Array of an active servers\r\nconst activeServers = new Map();\r\n\r\n// Create express app\r\nconst app = express();\r\n\r\n/**\r\n * Starts an HTTP and/or HTTPS server based on the provided configuration.\r\n * The `serverOptions` object contains server-related properties (refer\r\n * to the `server` section in the `lib/schemas/config.js` file for details).\r\n *\r\n * @async\r\n * @function startServer\r\n *\r\n * @param {Object} serverOptions - The configuration object containing `server`\r\n * options. This object may include a partial or complete set of the `server`\r\n * options. If the options are partial, missing values will default\r\n * to the current global configuration.\r\n *\r\n * @returns {Promise<void>} A Promise that resolves when the server is either\r\n * not enabled or no valid Express app is found, signaling the end of the\r\n * function's execution.\r\n *\r\n * @throws {ExportError} Throws an `ExportError` if the server cannot\r\n * be configured and started.\r\n */\r\nexport async function startServer(serverOptions) {\r\n  try {\r\n    // Update the instance options object\r\n    const options = updateOptions({\r\n      server: serverOptions\r\n    });\r\n\r\n    // Use validated options\r\n    serverOptions = options.server;\r\n\r\n    // Stop if not enabled\r\n    if (!serverOptions.enable || !app) {\r\n      throw new ExportError(\r\n        '[server] Server cannot be started (not enabled or no correct Express app found).',\r\n        500\r\n      );\r\n    }\r\n\r\n    // Too big limits lead to timeouts in the export process when\r\n    // the rasterization timeout is set too low\r\n    const uploadLimitBytes = serverOptions.uploadLimit * 1024 * 1024;\r\n\r\n    // Memory storage for multer package\r\n    const storage = multer.memoryStorage();\r\n\r\n    // Enable parsing of form data (files) with multer package\r\n    const upload = multer({\r\n      storage,\r\n      limits: {\r\n        fieldSize: uploadLimitBytes\r\n      }\r\n    });\r\n\r\n    // Disable the X-Powered-By header\r\n    app.disable('x-powered-by');\r\n\r\n    // Enable CORS support\r\n    app.use(\r\n      cors({\r\n        methods: ['POST', 'GET', 'OPTIONS']\r\n      })\r\n    );\r\n\r\n    // Getting a lot of `RangeNotSatisfiableError` exceptions (even though this\r\n    // is a deprecated options, let's try to set it to false)\r\n    app.use((request, response, next) => {\r\n      response.set('Accept-Ranges', 'none');\r\n      next();\r\n    });\r\n\r\n    // Enable body parser for JSON data\r\n    app.use(\r\n      express.json({\r\n        limit: uploadLimitBytes\r\n      })\r\n    );\r\n\r\n    // Enable body parser for URL-encoded form data\r\n    app.use(\r\n      express.urlencoded({\r\n        extended: true,\r\n        limit: uploadLimitBytes\r\n      })\r\n    );\r\n\r\n    // Use only non-file multipart form fields\r\n    app.use(upload.none());\r\n\r\n    // Set up static folder's route\r\n    app.use(express.static(join(__dirname, 'public')));\r\n\r\n    // Listen HTTP server\r\n    if (!serverOptions.ssl.force) {\r\n      // Main server instance (HTTP)\r\n      const httpServer = http.createServer(app);\r\n\r\n      // Attach error handlers and listen to the server\r\n      _attachServerErrorHandlers(httpServer);\r\n\r\n      // Listen\r\n      httpServer.listen(serverOptions.port, serverOptions.host, () => {\r\n        // Save the reference to HTTP server\r\n        activeServers.set(serverOptions.port, httpServer);\r\n\r\n        log(\r\n          3,\r\n          `[server] Started HTTP server on ${serverOptions.host}:${serverOptions.port}.`\r\n        );\r\n      });\r\n    }\r\n\r\n    // Listen HTTPS server\r\n    if (serverOptions.ssl.enable) {\r\n      // Set up an SSL server also\r\n      let key, cert;\r\n\r\n      try {\r\n        // Get the SSL key\r\n        key = await readFile(\r\n          join(getAbsolutePath(serverOptions.ssl.certPath), 'server.key'),\r\n          'utf8'\r\n        );\r\n\r\n        // Get the SSL certificate\r\n        cert = await readFile(\r\n          join(getAbsolutePath(serverOptions.ssl.certPath), 'server.crt'),\r\n          'utf8'\r\n        );\r\n      } catch (error) {\r\n        log(\r\n          2,\r\n          `[server] Unable to load key/certificate from the '${serverOptions.ssl.certPath}' path. Could not run secured layer server.`\r\n        );\r\n      }\r\n\r\n      if (key && cert) {\r\n        // Main server instance (HTTPS)\r\n        const httpsServer = https.createServer({ key, cert }, app);\r\n\r\n        // Attach error handlers and listen to the server\r\n        _attachServerErrorHandlers(httpsServer);\r\n\r\n        // Listen\r\n        httpsServer.listen(serverOptions.ssl.port, serverOptions.host, () => {\r\n          // Save the reference to HTTPS server\r\n          activeServers.set(serverOptions.ssl.port, httpsServer);\r\n\r\n          log(\r\n            3,\r\n            `[server] Started HTTPS server on ${serverOptions.host}:${serverOptions.ssl.port}.`\r\n          );\r\n        });\r\n      }\r\n    }\r\n\r\n    // Set up the rate limiter\r\n    rateLimitingMiddleware(app, serverOptions.rateLimiting);\r\n\r\n    // Set up the validation handler\r\n    validationMiddleware(app);\r\n\r\n    // Set up routes\r\n    exportRoutes(app);\r\n    healthRoutes(app);\r\n    uiRoutes(app);\r\n    versionChangeRoutes(app);\r\n\r\n    // Set up the centralized error handler\r\n    errorMiddleware(app);\r\n  } catch (error) {\r\n    throw new ExportError(\r\n      '[server] Could not configure and start the server.',\r\n      500\r\n    ).setError(error);\r\n  }\r\n}\r\n\r\n/**\r\n * Closes all servers associated with Express app instance.\r\n *\r\n * @function closeServers\r\n */\r\nexport function closeServers() {\r\n  // Check if there are servers working\r\n  if (activeServers.size > 0) {\r\n    log(4, `[server] Closing all servers.`);\r\n\r\n    // Close each one of servers\r\n    for (const [port, server] of activeServers) {\r\n      server.close(() => {\r\n        activeServers.delete(port);\r\n        log(4, `[server] Closed server on port: ${port}.`);\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Get all servers associated with Express app instance.\r\n *\r\n * @function getServers\r\n *\r\n * @returns {Array.<Object>} Servers associated with Express app instance.\r\n */\r\nexport function getServers() {\r\n  return activeServers;\r\n}\r\n\r\n/**\r\n * Get the Express instance.\r\n *\r\n * @function getExpress\r\n *\r\n * @returns {Express} The Express instance.\r\n */\r\nexport function getExpress() {\r\n  return express;\r\n}\r\n\r\n/**\r\n * Get the Express app instance.\r\n *\r\n * @function getApp\r\n *\r\n * @returns {Express} The Express app instance.\r\n */\r\nexport function getApp() {\r\n  return app;\r\n}\r\n\r\n/**\r\n * Enable rate limiting for the server.\r\n *\r\n * @function enableRateLimiting\r\n *\r\n * @param {Object} rateLimitingOptions - The configuration object containing\r\n * `rateLimiting` options. This object may include a partial or complete set\r\n * of the `rateLimiting` options. If the options are partial, missing values\r\n * will default to the current global configuration.\r\n */\r\nexport function enableRateLimiting(rateLimitingOptions) {\r\n  // Update the instance options object\r\n  const options = updateOptions({\r\n    server: {\r\n      rateLimiting: rateLimitingOptions\r\n    }\r\n  });\r\n\r\n  // Set the rate limiting options\r\n  rateLimitingMiddleware(app, options.server.rateLimitingOptions);\r\n}\r\n\r\n/**\r\n * Apply middleware(s) to a specific path.\r\n *\r\n * @function use\r\n *\r\n * @param {string} path - The path to which the middleware(s) should be applied.\r\n * @param {...Function} middlewares - The middleware function(s) to be applied.\r\n */\r\nexport function use(path, ...middlewares) {\r\n  app.use(path, ...middlewares);\r\n}\r\n\r\n/**\r\n * Set up a route with GET method and apply middleware(s).\r\n *\r\n * @function get\r\n *\r\n * @param {string} path - The path to which the middleware(s) should be applied.\r\n * @param {...Function} middlewares - The middleware function(s) to be applied.\r\n */\r\nexport function get(path, ...middlewares) {\r\n  app.get(path, ...middlewares);\r\n}\r\n\r\n/**\r\n * Set up a route with POST method and apply middleware(s).\r\n *\r\n * @function post\r\n *\r\n * @param {string} path - The path to which the middleware(s) should be applied.\r\n * @param {...Function} middlewares - The middleware function(s) to be applied.\r\n */\r\nexport function post(path, ...middlewares) {\r\n  app.post(path, ...middlewares);\r\n}\r\n\r\n/**\r\n * Attach error handlers to the server.\r\n *\r\n * @function _attachServerErrorHandlers\r\n *\r\n * @param {(http.Server|https.Server)} server - The HTTP/HTTPS server instance.\r\n */\r\nfunction _attachServerErrorHandlers(server) {\r\n  server.on('clientError', (error, socket) => {\r\n    logWithStack(\r\n      1,\r\n      error,\r\n      `[server] Client error: ${error.message}, destroying socket.`\r\n    );\r\n    socket.destroy();\r\n  });\r\n\r\n  server.on('error', (error) => {\r\n    logWithStack(1, error, `[server] Server error: ${error.message}`);\r\n  });\r\n\r\n  server.on('connection', (socket) => {\r\n    socket.on('error', (error) => {\r\n      logWithStack(1, error, `[server] Socket error: ${error.message}`);\r\n    });\r\n  });\r\n}\r\n\r\nexport default {\r\n  startServer,\r\n  closeServers,\r\n  getServers,\r\n  getExpress,\r\n  getApp,\r\n  enableRateLimiting,\r\n  use,\r\n  get,\r\n  post\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Handles graceful shutdown of the Highcharts Export Server, ensuring\r\n * proper cleanup of resources such as browser, pages, servers, and timers.\r\n */\r\n\r\nimport { killPool } from './pool.js';\r\nimport { clearAllTimers } from './timer.js';\r\n\r\nimport { closeServers } from './server/server.js';\r\n\r\n/**\r\n * Performs cleanup operations to ensure a graceful shutdown of the process.\r\n * This includes clearing all registered timeouts/intervals, closing active\r\n * servers, terminating resources (pages) of the pool, pool itself, and closing\r\n * the browser.\r\n *\r\n * @function shutdownCleanUp\r\n *\r\n * @param {number} [exitCode=0] - The exit code to use with `process.exit()`.\r\n * The default value is `0`.\r\n */\r\nexport async function shutdownCleanUp(exitCode = 0) {\r\n  // Await freeing all resources\r\n  await Promise.allSettled([\r\n    // Clear all ongoing intervals\r\n    clearAllTimers(),\r\n\r\n    // Get available server instances (HTTP/HTTPS) and close them\r\n    closeServers(),\r\n\r\n    // Close an active pool along with its workers and the browser instance\r\n    killPool()\r\n  ]);\r\n\r\n  // Exit process with a correct code\r\n  process.exit(exitCode);\r\n}\r\n\r\nexport default {\r\n  shutdownCleanUp\r\n};\r\n","/*******************************************************************************\r\n\r\nHighcharts Export Server\r\n\r\nCopyright (c) 2016-2025, Highsoft\r\n\r\nLicenced under the MIT licence.\r\n\r\nAdditionally a valid Highcharts license is required for use.\r\n\r\nSee LICENSE file in root for details.\r\n\r\n*******************************************************************************/\r\n\r\n/**\r\n * @overview Core module for initializing and managing the Highcharts Export\r\n * Server. Provides functionalities for configuring exports, setting up server\r\n * operations, logging, scripts caching, resource pooling, and graceful process\r\n * cleanup.\r\n */\r\n\r\nimport 'colors';\r\n\r\nimport { checkAndUpdateCache } from './cache.js';\r\nimport {\r\n  singleExport,\r\n  batchExport,\r\n  startExport,\r\n  setAllowCodeExecution\r\n} from './chart.js';\r\nimport {\r\n  getOptions,\r\n  updateOptions,\r\n  setGlobalOptions,\r\n  mapToNewOptions\r\n} from './config.js';\r\nimport {\r\n  log,\r\n  logWithStack,\r\n  logZodIssues,\r\n  initLogging,\r\n  enableConsoleLogging,\r\n  enableFileLogging,\r\n  setLogLevel\r\n} from './logger.js';\r\nimport { initPool, killPool } from './pool.js';\r\nimport { shutdownCleanUp } from './resourceRelease.js';\r\n\r\nimport server from './server/server.js';\r\n\r\n/**\r\n * Initializes the export process. Tasks such as configuring logging, checking\r\n * the cache and sources, and initializing the resource pool occur during this\r\n * stage.\r\n *\r\n * This function must be called before attempting to export charts or set\r\n * up a server.\r\n *\r\n * @async\r\n * @function initExport\r\n *\r\n * @param {Object} [initOptions={}] - The `initOptions` object, which may\r\n * be a partial or complete set of options. If the options are partial, missing\r\n * values will default to the current global configuration. The default value\r\n * is an empty object.\r\n */\r\nexport async function initExport(initOptions = {}) {\r\n  // Init and update the instance options object\r\n  const options = updateOptions(initOptions, true);\r\n\r\n  // Set the `allowCodeExecution` per export module scope\r\n  setAllowCodeExecution(options.customLogic.allowCodeExecution);\r\n\r\n  // Init the logging\r\n  initLogging(options.logging);\r\n\r\n  // Attach process' exit listeners\r\n  if (options.other.listenToProcessExits) {\r\n    _attachProcessExitListeners();\r\n  }\r\n\r\n  // Check if cache needs to be updated\r\n  await checkAndUpdateCache(options.highcharts, options.server.proxy);\r\n\r\n  // Init the pool\r\n  await initPool(options.pool, options.puppeteer.args);\r\n}\r\n\r\n/**\r\n * Attaches exit listeners to the process, ensuring proper cleanup of resources\r\n * and termination on exit signals. Handles 'exit', 'SIGINT', 'SIGTERM'\r\n * and 'uncaughtException' events.\r\n *\r\n * @function _attachProcessExitListeners\r\n */\r\nfunction _attachProcessExitListeners() {\r\n  log(3, '[process] Attaching exit listeners to the process.');\r\n\r\n  // Handler for the 'exit'\r\n  process.on('exit', (code) => {\r\n    log(4, `[process] Process exited with code ${code}.`);\r\n  });\r\n\r\n  // Handler for the 'SIGINT'\r\n  process.on('SIGINT', async (name, code) => {\r\n    log(4, `[process] The ${name} event with code: ${code}.`);\r\n    await shutdownCleanUp();\r\n  });\r\n\r\n  // Handler for the 'SIGTERM'\r\n  process.on('SIGTERM', async (name, code) => {\r\n    log(4, `[process] The ${name} event with code: ${code}.`);\r\n    await shutdownCleanUp();\r\n  });\r\n\r\n  // Handler for the 'SIGHUP'\r\n  process.on('SIGHUP', async (name, code) => {\r\n    log(4, `[process] The ${name} event with code: ${code}.`);\r\n    await shutdownCleanUp();\r\n  });\r\n\r\n  // Handler for the 'uncaughtException'\r\n  process.on('uncaughtException', async (error, name) => {\r\n    logWithStack(1, error, `[process] The ${name} error.`);\r\n    await shutdownCleanUp(1);\r\n  });\r\n}\r\n\r\nexport default {\r\n  // Server\r\n  ...server,\r\n\r\n  // Options\r\n  getOptions,\r\n  setGlobalOptions,\r\n  mapToNewOptions,\r\n\r\n  // Exporting\r\n  initExport,\r\n  singleExport,\r\n  batchExport,\r\n  startExport,\r\n\r\n  // Release\r\n  killPool,\r\n  shutdownCleanUp,\r\n\r\n  // Logs\r\n  log,\r\n  logWithStack,\r\n  logZodIssues,\r\n  setLogLevel: function (level) {\r\n    // Update the instance options object\r\n    const options = updateOptions({\r\n      logging: {\r\n        level\r\n      }\r\n    });\r\n\r\n    // Call the function\r\n    setLogLevel(options.logging.level);\r\n  },\r\n  enableConsoleLogging: function (toConsole) {\r\n    // Update the instance options object\r\n    const options = updateOptions({\r\n      logging: {\r\n        toConsole\r\n      }\r\n    });\r\n\r\n    // Call the function\r\n    enableConsoleLogging(options.logging.toConsole);\r\n  },\r\n  enableFileLogging: function (dest, file, toFile) {\r\n    // Update the instance options object\r\n    const options = updateOptions({\r\n      logging: {\r\n        dest,\r\n        file,\r\n        toFile\r\n      }\r\n    });\r\n\r\n    // Call the function\r\n    enableFileLogging(\r\n      options.logging.dest,\r\n      options.logging.file,\r\n      options.logging.toFile\r\n    );\r\n  }\r\n};\r\n"],"names":["__dirname","fileURLToPath","URL","url","deepCopy","objArr","objArrCopy","Array","isArray","key","Object","prototype","hasOwnProperty","call","fixConstr","constr","fixedConstr","toLowerCase","replace","includes","fixOutfile","type","outfile","getAbsolutePath","split","shift","fixType","mimeTypes","formats","values","outType","pop","find","t","path","isAbsolute","join","getBase64","input","Buffer","from","toString","getNewDate","Date","trim","getNewDateTime","getTime","isObject","item","isObjectEmpty","keys","length","isPrivateRangeUrlFound","some","pattern","test","measureTime","start","process","hrtime","bigint","Number","roundNumber","value","precision","multiplier","Math","pow","round","wrapAround","customCode","allowFileResources","isCallback","endsWith","readFileSync","startsWith","colors","logging","toConsole","toFile","pathCreated","pathToLog","levelsDesc","title","color","log","args","newLevel","texts","level","prefix","_logToFile","console","apply","undefined","concat","logWithStack","error","customMessage","mainMessage","message","stackMessage","stack","push","logZodIssues","issues","map","issue","initLogging","loggingOptions","dest","file","setLogLevel","enableConsoleLogging","enableFileLogging","isInteger","existsSync","mkdirSync","appendFile","defaultConfig","puppeteer","types","envLink","cliName","description","promptOptions","separator","highcharts","version","cdnUrl","forceFetch","cachePath","coreScripts","instructions","moduleScripts","indicatorScripts","customScripts","export","infile","instr","options","svg","batch","hint","choices","b64","noDownload","height","width","scale","defaultHeight","defaultWidth","defaultScale","min","max","globalOptions","themeOptions","rasterizationTimeout","customLogic","allowCodeExecution","callback","resources","loadConfig","legacyName","createConfig","server","enable","host","port","uploadLimit","benchmarking","proxy","timeout","rateLimiting","maxRequests","window","delay","trustProxy","skipKey","skipToken","ssl","force","certPath","pool","minWorkers","maxWorkers","workLimit","acquireTimeout","createTimeout","destroyTimeout","idleTimeout","createRetryInterval","reaperInterval","ui","route","other","nodeEnv","listenToProcessExits","noLogo","hardResetPage","browserShellMode","debug","headless","devtools","listenToConsole","dumpio","slowMo","debuggingPort","nestedProps","_createNestedProps","absoluteProps","_createAbsoluteProps","config","propChain","forEach","entry","substring","dotenv","z","setErrorMap","_customErrorMap","v","boolean","strictCheck","union","enum","transform","nullable","string","refine","params","errorMessage","stringArray","filterCallback","arraySchema","array","stringSchema","slice","transformCallback","filter","positiveNum","number","positive","isNaN","nonNegativeNum","nonnegative","prefixes","chartConfig","indexOf","object","passthrough","additionalOptions","adminToken","gte","lte","this","objectSchema","js","css","files","partial","stringSchema1","stringSchema2","enableServer","serverBenchmarking","proxyHost","proxyPort","proxyTimeout","enableRateLimiting","enableSsl","sslForce","sslPort","sslCertPath","poolBenchmarking","resourcesInterval","logLevel","int","logFile","logDest","logToConsole","logToFile","enableUi","uiRoute","enableDebug","requestId","uuid","PuppeteerSchema","HighchartsSchema","ExportSchema","CustomLogicSchema","ProxySchema","RateLimitingSchema","SslSchema","ServerSchema","optional","PoolSchema","LoggingSchema","UiSchema","OtherSchema","DebugSchema","StrictConfigSchema","LooseConfigSchema","EnvSchema","PUPPETEER_ARGS","HIGHCHARTS_VERSION","HIGHCHARTS_CDN_URL","HIGHCHARTS_FORCE_FETCH","HIGHCHARTS_CACHE_PATH","HIGHCHARTS_ADMIN_TOKEN","HIGHCHARTS_CORE_SCRIPTS","HIGHCHARTS_MODULE_SCRIPTS","HIGHCHARTS_INDICATOR_SCRIPTS","HIGHCHARTS_CUSTOM_SCRIPTS","EXPORT_INFILE","EXPORT_INSTR","EXPORT_OPTIONS","EXPORT_SVG","EXPORT_BATCH","EXPORT_OUTFILE","EXPORT_TYPE","EXPORT_CONSTR","EXPORT_B64","EXPORT_NO_DOWNLOAD","EXPORT_HEIGHT","EXPORT_WIDTH","EXPORT_SCALE","EXPORT_DEFAULT_HEIGHT","EXPORT_DEFAULT_WIDTH","EXPORT_DEFAULT_SCALE","EXPORT_GLOBAL_OPTIONS","EXPORT_THEME_OPTIONS","EXPORT_RASTERIZATION_TIMEOUT","CUSTOM_LOGIC_ALLOW_CODE_EXECUTION","CUSTOM_LOGIC_ALLOW_FILE_RESOURCES","CUSTOM_LOGIC_CUSTOM_CODE","CUSTOM_LOGIC_CALLBACK","CUSTOM_LOGIC_RESOURCES","CUSTOM_LOGIC_LOAD_CONFIG","CUSTOM_LOGIC_CREATE_CONFIG","SERVER_ENABLE","SERVER_HOST","SERVER_PORT","SERVER_UPLOAD_LIMIT","SERVER_BENCHMARKING","SERVER_PROXY_HOST","SERVER_PROXY_PORT","SERVER_PROXY_TIMEOUT","SERVER_RATE_LIMITING_ENABLE","SERVER_RATE_LIMITING_MAX_REQUESTS","SERVER_RATE_LIMITING_WINDOW","SERVER_RATE_LIMITING_DELAY","SERVER_RATE_LIMITING_TRUST_PROXY","SERVER_RATE_LIMITING_SKIP_KEY","SERVER_RATE_LIMITING_SKIP_TOKEN","SERVER_SSL_ENABLE","SERVER_SSL_FORCE","SERVER_SSL_PORT","SERVER_SSL_CERT_PATH","POOL_MIN_WORKERS","POOL_MAX_WORKERS","POOL_WORK_LIMIT","POOL_ACQUIRE_TIMEOUT","POOL_CREATE_TIMEOUT","POOL_DESTROY_TIMEOUT","POOL_IDLE_TIMEOUT","POOL_CREATE_RETRY_INTERVAL","POOL_REAPER_INTERVAL","POOL_BENCHMARKING","LOGGING_LEVEL","LOGGING_FILE","LOGGING_DEST","LOGGING_TO_CONSOLE","LOGGING_TO_FILE","UI_ENABLE","UI_ROUTE","OTHER_NODE_ENV","OTHER_LISTEN_TO_PROCESS_EXITS","OTHER_NO_LOGO","OTHER_HARD_RESET_PAGE","OTHER_BROWSER_SHELL_MODE","DEBUG_ENABLE","DEBUG_HEADLESS","DEBUG_DEVTOOLS","DEBUG_LISTEN_TO_CONSOLE","DEBUG_DUMPIO","DEBUG_SLOW_MO","DEBUG_DEBUGGING_PORT","envs","parse","env","strictValidate","configOptions","looseValidate","validateOption","name","option","context","propertyName","propertyInfo","code","ZodIssueCode","invalid_type","received","ZodParsedType","defaultError","custom","data","invalid_union","unionErrors","index","_initGlobalOptions","instanceOptions","getOptions","getInstance","setGlobalOptions","customOptions","cliArgs","cliOptions","_loadConfigFile","_pairArgumentValue","_updateGlobalOptions","updateOptions","newInstance","mergeOptions","originalOptions","newOptions","entries","mapToNewOptions","oldOptions","propertiesChain","reduce","obj","prop","isAllowedConfig","allowFunctions","objectConfig","eval","JSON","stringifiedOptions","_optionsStringify","parsedOptions","_","envVal","configOpt","cliOpt","customOpt","configVal","cliVal","customVal","stringifyFunctions","stringify","replaceAll","Error","customLogicOptions","configIndex","findIndex","arg","i","async","fetch","requestOptions","Promise","resolve","reject","_getProtocolModule","get","response","responseData","on","chunk","text","https","http","ExportError","constructor","statusCode","super","setStatus","setError","cache","activeManifest","sources","hcVersion","checkAndUpdateCache","highchartsOptions","serverProxyOptions","fetchedModules","getCachePath","manifestPath","sourcePath","recursive","_updateCache","requestUpdate","manifest","modules","moduleMap","m","numberOfModules","moduleName","extractVersion","_saveConfigToManifest","getHighchartsVersion","updateHighchartsVersion","newVersion","cacheSources","extractModuleName","scriptPath","_fetchAndProcessScript","script","shouldThrowError","newManifest","writeFileSync","_fetchScripts","proxyAgent","HttpsProxyAgent","agent","allFetchPromises","all","c","setupHighcharts","Highcharts","animObject","duration","createChart","exportOptions","setOptions","merge","wrap","setOptionsObj","isRenderComplete","Chart","proceed","userOptions","cb","exporting","enabled","plotOptions","series","label","tooltip","animation","onHighchartsRender","addEvent","Series","chart","Function","finalOptions","finalCallback","defaultOptions","template","browser","createBrowser","puppeteerArgs","enabledDebug","debugOptions","launchOptions","userDataDir","handleSIGINT","handleSIGTERM","handleSIGHUP","waitForInitialPage","defaultViewport","tryCount","open","launch","setTimeout","closeBrowser","connected","close","newPage","poolResource","page","setCacheEnabled","_setPageContent","_setPageEvents","isClosed","clearPage","hardReset","goto","waitUntil","evaluate","document","body","innerHTML","id","workCount","addPageResources","injectedResources","injectedJs","content","isLocal","jsResource","addScriptTag","injectedCss","cssImports","match","cssImportPath","cssResource","addStyleTag","clearPageResources","resource","dispose","oldCharts","charts","oldChart","destroy","scriptsToRemove","getElementsByTagName","stylesToRemove","linksToRemove","element","remove","setContent","cssTemplate","svgTemplate","puppeteerExport","isSVG","size","svgElement","querySelector","chartHeight","baseVal","chartWidth","style","zoom","margin","parseFloat","x","y","_getClipRegion","viewportHeight","abs","ceil","viewportWidth","result","setViewport","deviceScaleFactor","_createSVG","_createImage","_createPDF","$eval","getBoundingClientRect","trunc","outerHTML","clip","race","screenshot","encoding","fullPage","optimizeForSpeed","captureBeyondViewport","quality","omitBackground","_resolve","emulateMediaType","pdf","poolStats","exportsAttempted","exportsPerformed","exportsDropped","exportsFromSvg","exportsFromOptions","exportsFromSvgAttempts","exportsFromOptionsAttempts","timeSpent","timeSpentAverage","initPool","poolOptions","Pool","_factory","acquireTimeoutMillis","createTimeoutMillis","destroyTimeoutMillis","idleTimeoutMillis","createRetryIntervalMillis","reapIntervalMillis","propagateCreateError","clearStatus","_eventId","initialResources","acquire","promise","release","killPool","worker","used","destroyed","postWork","workerHandle","getPoolInfo","acquireCounter","workStart","exportCounter","exportTime","getPoolStats","getPoolInfoJSON","numUsed","available","numFree","allCreated","pendingAcquires","numPendingAcquires","pendingCreates","numPendingCreates","pendingValidations","numPendingValidations","pendingDestroys","absoluteAll","create","random","startDate","validate","mainFrame","detached","removeAllListeners","sanitize","JSDOM","DOMPurify","ADD_TAGS","singleExport","startExport","batchExport","batchFunctions","pair","batchResults","allSettled","reason","exportingOptions","endCallback","fileContent","_exportFromSvg","_exportFromOptions","getAllowCodeExecution","setAllowCodeExecution","inputToExport","_prepareExport","_handleCustomLogic","_handleGlobalAndTheme","_findChartSize","optionsChart","optionsExporting","globalOptionsChart","globalOptionsExporting","themeOptionsChart","themeOptionsExporting","sourceHeight","sourceWidth","param","_handleResources","allowedProps","handledResources","correctResources","propName","optionsName","timerIds","addTimer","clearAllTimers","clearInterval","clearTimeout","logErrorMiddleware","request","next","returnErrorMiddleware","status","json","errorMiddleware","app","use","rateLimitingMiddleware","rateLimitingOptions","rateOptions","limiter","rateLimit","windowMs","limit","delayMs","handler","format","send","default","skip","query","access_token","contentTypeMiddleware","contentType","headers","requestBodyMiddleware","connection","remoteAddress","validatedOptions","_requestId","filename","validationMiddleware","post","reversedMime","png","jpeg","gif","requestExport","requestCounter","connectionAborted","socket","hadErrors","header","attachment","exportRoutes","serverStartTime","packageFile","successRates","recordInterval","windowSize","_calculateMovingAverage","a","b","_startSuccessRate","setInterval","stats","successRatio","healthRoutes","period","movingAverage","bootTime","uptime","floor","serverVersion","highchartsVersion","averageExportTime","attemptedExports","performedExports","failedExports","sucessRatio","toFixed","svgExports","jsonExports","svgExportsAttempts","jsonExportsAttempts","uiRoutes","sendFile","acceptRanges","versionChangeRoutes","token","activeServers","Map","express","startServer","serverOptions","uploadLimitBytes","storage","multer","memoryStorage","upload","limits","fieldSize","disable","cors","methods","set","urlencoded","extended","none","static","httpServer","createServer","_attachServerErrorHandlers","listen","cert","readFile","httpsServer","closeServers","delete","getServers","getExpress","getApp","middlewares","shutdownCleanUp","exitCode","exit","initExport","initOptions","_attachProcessExitListeners"],"mappings":"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A,OACA,aACA,mBACA,eACA,cACA,UACA,UACA,cACA,WACA,UACA,YACA,cACA,YACA,sBACA,SACA,SACA,WACA,aACA,YACA,eACA,yBACA,SACA,eACA,YACA,kBACA,SACA,cACA,mBACA,eACA,kBACA,cACA,eAEA,cACA,WACA,eACA,WACA,SACA,OACA,WACA,YACA,SACA,qBACA,aACA,WACA,WACA,WACA,WACA,eACA,UACA,kBACA,oBACA,aACA,UACA,cACA,YACA,YAEF0D,MAAO,CAAC,YACRC,QAAS,4BACTE,YAAa,qCACbC,cAAe,CACbxG,KAAM,cACNgH,aAAc,0DAGlBE,iBAAkB,CAChBxE,MAAO,CAAC,kBACR0D,MAAO,CAAC,YACRC,QAAS,+BACTE,YAAa,wCACbC,cAAe,CACbxG,KAAM,cACNgH,aAAc,0DAGlBG,cAAe,CACbzE,MAAO,CACL,wEACA,kGAEF0D,MAAO,CAAC,YACRC,QAAS,4BACTE,YAAa,qDACbC,cAAe,CACbxG,KAAM,OACNyG,UAAW,OAIjBW,OAAQ,CACNC,OAAQ,CACN3E,MAAO,KACP0D,MAAO,CAAC,SAAU,QAClBC,QAAS,gBACTE,YACE,+DACFC,cAAe,CACbxG,KAAM,SAGVsH,MAAO,CACL5E,MAAO,KACP0D,MAAO,CAAC,SAAU,SAAU,QAC5BC,QAAS,eACTE,YACE,mEACFC,cAAe,CACbxG,KAAM,SAGVuH,QAAS,CACP7E,MAAO,KACP0D,MAAO,CAAC,SAAU,SAAU,QAC5BC,QAAS,iBACTE,YAAa,+BACbC,cAAe,CACbxG,KAAM,SAGVwH,IAAK,CACH9E,MAAO,KACP0D,MAAO,CAAC,SAAU,QAClBC,QAAS,aACTE,YAAa,mDACbC,cAAe,CACbxG,KAAM,SAGVyH,MAAO,CACL/E,MAAO,KACP0D,MAAO,CAAC,SAAU,QAClBC,QAAS,eACTE,YACE,gEACFC,cAAe,CACbxG,KAAM,SAGVC,QAAS,CACPyC,MAAO,KACP0D,MAAO,CAAC,SAAU,QAClBC,QAAS,iBACTE,YACE,qFACFC,cAAe,CACbxG,KAAM,SAGVA,KAAM,CACJ0C,MAAO,MACP0D,MAAO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"}